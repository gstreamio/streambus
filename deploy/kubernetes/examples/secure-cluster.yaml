apiVersion: streambus.io/v1alpha1
kind: StreamBusCluster
metadata:
  name: streambus-secure
  namespace: default
spec:
  # Security-focused cluster with TLS and authentication
  replicas: 3

  image:
    repository: streambus/broker
    tag: v0.6.0
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 500m
      memory: 1Gi
    limits:
      cpu: 2000m
      memory: 4Gi

  storage:
    class: encrypted-ssd
    size: 50Gi
    raftSize: 20Gi

  config:
    logLevel: info
    port: 9092
    httpPort: 8081
    grpcPort: 9093

  security:
    tls:
      enabled: true
      certSecretName: streambus-tls-certs
      # Optional: Custom CA
      caSecretName: streambus-ca-cert
      # Require client certificates
      clientAuthRequired: true
    authentication:
      enabled: true
      method: mtls
      # Additional auth methods
      allowedMethods:
        - mtls
        - jwt
    authorization:
      enabled: true
      # Fine-grained ACLs
      defaultPolicy: deny

  multiTenancy:
    enabled: true
    isolation:
      # Network isolation between tenants
      networkPolicies: true
    defaultQuotas:
      maxTopics: 50
      maxConnections: 500
      maxBandwidthMBps: 50

  observability:
    metrics:
      enabled: true
      serviceMonitor: true
    tracing:
      enabled: true
      endpoint: "tempo.observability.svc:4317"
      samplingRate: 1.0  # Full sampling for security auditing
    logging:
      level: info
      format: json
      # Security audit logging
      auditLog:
        enabled: true
        level: detailed

  # Security-focused pod settings
  podAnnotations:
    seccomp.security.alpha.kubernetes.io/pod: runtime/default
    container.apparmor.security.beta.kubernetes.io/manager: runtime/default

  podLabels:
    security-level: high
    compliance: pci-dss
