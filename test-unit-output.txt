Running unit tests...
go test -v -short -race -coverprofile=coverage.txt -covermode=atomic ./...
	github.com/gstreamio/streambus/cmd/broker		coverage: 0.0% of statements
	github.com/gstreamio/streambus/cmd/cli		coverage: 0.0% of statements
	github.com/gstreamio/streambus/cmd/mirror-maker		coverage: 0.0% of statements
	github.com/gstreamio/streambus/deploy/kubernetes/operator		coverage: 0.0% of statements
	github.com/gstreamio/streambus/deploy/kubernetes/operator/api/v1alpha1		coverage: 0.0% of statements
	github.com/gstreamio/streambus/deploy/kubernetes/operator/controllers		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/consumer		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/consumer-group		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/metadata		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/observability		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/producer		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/schema-registry		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/secure-client		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/security		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/tracing		coverage: 0.0% of statements
	github.com/gstreamio/streambus/examples/transactions		coverage: 0.0% of statements
=== RUN   TestHandleClusterInfo
--- PASS: TestHandleClusterInfo (0.00s)
=== RUN   TestHandleClusterInfo_MethodNotAllowed
--- PASS: TestHandleClusterInfo_MethodNotAllowed (0.00s)
=== RUN   TestHandleBrokerList
--- PASS: TestHandleBrokerList (0.00s)
=== RUN   TestHandleBrokerList_MethodNotAllowed
--- PASS: TestHandleBrokerList_MethodNotAllowed (0.00s)
=== RUN   TestHandleBrokerDetail
--- PASS: TestHandleBrokerDetail (0.00s)
=== RUN   TestHandleBrokerDetail_NotFound
--- PASS: TestHandleBrokerDetail_NotFound (0.00s)
=== RUN   TestHandleBrokerDetail_InvalidID
--- PASS: TestHandleBrokerDetail_InvalidID (0.00s)
=== RUN   TestHandleBrokerDetail_MethodNotAllowed
--- PASS: TestHandleBrokerDetail_MethodNotAllowed (0.00s)
=== RUN   TestHandleTopics_List
2025/11/22 14:23:02 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:02.39059 -0500 EST
2025/11/22 14:23:02 [FSM] Operation succeeded: type=create_topic, new version=1
2025/11/22 14:23:02 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:02.390876 -0500 EST
2025/11/22 14:23:02 [FSM] Operation succeeded: type=create_topic, new version=2
--- PASS: TestHandleTopics_List (0.00s)
=== RUN   TestHandleTopics_Create
2025/11/22 14:23:02 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:02.391398 -0500 EST
2025/11/22 14:23:02 [FSM] Operation succeeded: type=create_topic, new version=1
--- PASS: TestHandleTopics_Create (0.00s)
=== RUN   TestHandleTopics_Create_InvalidJSON
--- PASS: TestHandleTopics_Create_InvalidJSON (0.00s)
=== RUN   TestHandleTopics_Create_EmptyName
--- PASS: TestHandleTopics_Create_EmptyName (0.00s)
=== RUN   TestHandleTopics_MethodNotAllowed
--- PASS: TestHandleTopics_MethodNotAllowed (0.00s)
=== RUN   TestGetTopic
2025/11/22 14:23:02 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:02.391819 -0500 EST
2025/11/22 14:23:02 [FSM] Operation succeeded: type=create_topic, new version=1
--- PASS: TestGetTopic (0.00s)
=== RUN   TestGetTopic_NotFound
--- PASS: TestGetTopic_NotFound (0.00s)
=== RUN   TestDeleteTopic
2025/11/22 14:23:02 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:02.392307 -0500 EST
2025/11/22 14:23:02 [FSM] Operation succeeded: type=create_topic, new version=1
2025/11/22 14:23:02 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392431 -0500 EST
2025/11/22 14:23:02 [FSM] Operation succeeded: type=delete_topic, new version=2
--- PASS: TestDeleteTopic (0.00s)
=== RUN   TestDeleteTopic_NotFound
2025/11/22 14:23:02 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:02 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:02 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:02 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:02 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:02 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:02 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:02 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:03 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:03 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:03 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:03 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:05 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:05 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:08 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:08 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
2025/11/22 14:23:11 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:02.392548 -0500 EST
2025/11/22 14:23:11 [FSM] Operation failed: type=delete_topic, error=topic nonexistent does not exist
--- PASS: TestDeleteTopic_NotFound (10.00s)
=== RUN   TestHandleTopicOperations_MethodNotAllowed
--- PASS: TestHandleTopicOperations_MethodNotAllowed (0.00s)
=== RUN   TestHandleTopicPartitions
2025/11/22 14:23:12 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:12.394003 -0500 EST
2025/11/22 14:23:12 [FSM] Operation succeeded: type=create_topic, new version=1
--- PASS: TestHandleTopicPartitions (0.00s)
=== RUN   TestHandleTopicPartitions_NotFound
--- PASS: TestHandleTopicPartitions_NotFound (0.00s)
=== RUN   TestHandleTopicPartitions_MethodNotAllowed
2025/11/22 14:23:12 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:12.394345 -0500 EST
2025/11/22 14:23:12 [FSM] Operation succeeded: type=create_topic, new version=1
--- PASS: TestHandleTopicPartitions_MethodNotAllowed (0.00s)
=== RUN   TestHandleTopicMessages_MethodNotAllowed
2025/11/22 14:23:12 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:12.394507 -0500 EST
2025/11/22 14:23:12 [FSM] Operation succeeded: type=create_topic, new version=1
--- PASS: TestHandleTopicMessages_MethodNotAllowed (0.00s)
=== RUN   TestHandleConsumerGroups_NilCoordinator
--- PASS: TestHandleConsumerGroups_NilCoordinator (0.00s)
=== RUN   TestHandleConsumerGroups_MethodNotAllowed
--- PASS: TestHandleConsumerGroups_MethodNotAllowed (0.00s)
=== RUN   TestGetConsumerGroup_NilCoordinator
--- PASS: TestGetConsumerGroup_NilCoordinator (0.00s)
=== RUN   TestGetConsumerGroup_MissingGroupID
--- PASS: TestGetConsumerGroup_MissingGroupID (0.00s)
=== RUN   TestHandleConsumerGroupLag_NilCoordinator
--- PASS: TestHandleConsumerGroupLag_NilCoordinator (0.00s)
=== RUN   TestHandleConsumerGroupLag_MethodNotAllowed
--- PASS: TestHandleConsumerGroupLag_MethodNotAllowed (0.00s)
=== RUN   TestHandleConsumerGroupOperations_MethodNotAllowed
--- PASS: TestHandleConsumerGroupOperations_MethodNotAllowed (0.00s)
=== RUN   TestHandleReplicationLinks_List
--- PASS: TestHandleReplicationLinks_List (0.00s)
=== RUN   TestHandleReplicationLinks_Create
--- PASS: TestHandleReplicationLinks_Create (0.00s)
=== RUN   TestHandleReplicationLinks_MethodNotAllowed
--- PASS: TestHandleReplicationLinks_MethodNotAllowed (0.00s)
=== RUN   TestGetReplicationLink
--- PASS: TestGetReplicationLink (0.00s)
=== RUN   TestUpdateReplicationLink
--- PASS: TestUpdateReplicationLink (0.00s)
=== RUN   TestDeleteReplicationLink
--- PASS: TestDeleteReplicationLink (0.00s)
=== RUN   TestReplicationLinkOperations_MissingLinkID
--- PASS: TestReplicationLinkOperations_MissingLinkID (0.00s)
=== RUN   TestReplicationLinkOperations_MethodNotAllowed
--- PASS: TestReplicationLinkOperations_MethodNotAllowed (0.00s)
=== RUN   TestStartReplicationLink
--- PASS: TestStartReplicationLink (0.00s)
=== RUN   TestStopReplicationLink
--- PASS: TestStopReplicationLink (0.00s)
=== RUN   TestPauseReplicationLink
--- PASS: TestPauseReplicationLink (0.00s)
=== RUN   TestResumeReplicationLink
--- PASS: TestResumeReplicationLink (0.00s)
=== RUN   TestGetReplicationLinkMetrics
--- PASS: TestGetReplicationLinkMetrics (0.00s)
=== RUN   TestGetReplicationLinkHealth
--- PASS: TestGetReplicationLinkHealth (0.00s)
=== RUN   TestFailoverReplicationLink
--- PASS: TestFailoverReplicationLink (0.00s)
=== RUN   TestReplicationLinkOperations_UnknownOperation
--- PASS: TestReplicationLinkOperations_UnknownOperation (0.00s)
=== RUN   TestBroker_SecurityManager
--- PASS: TestBroker_SecurityManager (0.00s)
=== RUN   TestBroker_SecurityManager_Nil
--- PASS: TestBroker_SecurityManager_Nil (0.00s)
=== RUN   TestBroker_TenancyManager
--- PASS: TestBroker_TenancyManager (0.00s)
=== RUN   TestBroker_TenancyManager_Nil
--- PASS: TestBroker_TenancyManager_Nil (0.00s)
=== RUN   TestBroker_Status
=== RUN   TestBroker_Status/StatusStopped
=== RUN   TestBroker_Status/StatusStarting
=== RUN   TestBroker_Status/StatusRunning
=== RUN   TestBroker_Status/StatusStopping
--- PASS: TestBroker_Status (0.00s)
    --- PASS: TestBroker_Status/StatusStopped (0.00s)
    --- PASS: TestBroker_Status/StatusStarting (0.00s)
    --- PASS: TestBroker_Status/StatusRunning (0.00s)
    --- PASS: TestBroker_Status/StatusStopping (0.00s)
=== RUN   TestBroker_Status_ConcurrentAccess
--- PASS: TestBroker_Status_ConcurrentAccess (0.00s)
=== RUN   TestBroker_WaitForShutdown
--- PASS: TestBroker_WaitForShutdown (0.05s)
=== RUN   TestBroker_WaitForShutdown_AlreadyCancelled
--- PASS: TestBroker_WaitForShutdown_AlreadyCancelled (0.00s)
=== RUN   TestBroker_Stop_NotRunning
--- PASS: TestBroker_Stop_NotRunning (0.00s)
=== RUN   TestBroker_Stop_AlreadyStopping
--- PASS: TestBroker_Stop_AlreadyStopping (0.00s)
=== RUN   TestValidateConfig_InvalidBrokerID
--- PASS: TestValidateConfig_InvalidBrokerID (0.00s)
=== RUN   TestValidateConfig_MissingHost
--- PASS: TestValidateConfig_MissingHost (0.00s)
=== RUN   TestValidateConfig_InvalidPort
--- PASS: TestValidateConfig_InvalidPort (0.00s)
=== RUN   TestValidateConfig_MissingDataDir
--- PASS: TestValidateConfig_MissingDataDir (0.00s)
=== RUN   TestValidateConfig_MissingRaftDataDir
--- PASS: TestValidateConfig_MissingRaftDataDir (0.00s)
=== RUN   TestValidateConfig_MissingRaftPeers
--- PASS: TestValidateConfig_MissingRaftPeers (0.00s)
=== RUN   TestValidateConfig_Valid
--- PASS: TestValidateConfig_Valid (0.00s)
=== RUN   TestNew_NilConfig
--- PASS: TestNew_NilConfig (0.00s)
=== RUN   TestNew_InvalidConfig
--- PASS: TestNew_InvalidConfig (0.00s)
=== RUN   TestBrokerStatus_String
=== RUN   TestBrokerStatus_String/StatusStopped
=== RUN   TestBrokerStatus_String/StatusStarting
=== RUN   TestBrokerStatus_String/StatusRunning
=== RUN   TestBrokerStatus_String/StatusStopping
--- PASS: TestBrokerStatus_String (0.00s)
    --- PASS: TestBrokerStatus_String/StatusStopped (0.00s)
    --- PASS: TestBrokerStatus_String/StatusStarting (0.00s)
    --- PASS: TestBrokerStatus_String/StatusRunning (0.00s)
    --- PASS: TestBrokerStatus_String/StatusStopping (0.00s)
=== RUN   TestConvertUint64SliceToInt32
=== RUN   TestConvertUint64SliceToInt32/empty_slice
=== RUN   TestConvertUint64SliceToInt32/single_element
=== RUN   TestConvertUint64SliceToInt32/multiple_elements
=== RUN   TestConvertUint64SliceToInt32/large_numbers
=== RUN   TestConvertUint64SliceToInt32/zero_values
--- PASS: TestConvertUint64SliceToInt32 (0.00s)
    --- PASS: TestConvertUint64SliceToInt32/empty_slice (0.00s)
    --- PASS: TestConvertUint64SliceToInt32/single_element (0.00s)
    --- PASS: TestConvertUint64SliceToInt32/multiple_elements (0.00s)
    --- PASS: TestConvertUint64SliceToInt32/large_numbers (0.00s)
    --- PASS: TestConvertUint64SliceToInt32/zero_values (0.00s)
=== RUN   TestConvertUint64SliceToInt32_Nil
--- PASS: TestConvertUint64SliceToInt32_Nil (0.00s)
=== RUN   TestBroker_UpdateTenantStorageUsage_NoTenancyManager
--- PASS: TestBroker_UpdateTenantStorageUsage_NoTenancyManager (0.00s)
=== RUN   TestBroker_UpdateTenantStorageUsage_WithTenants
{"timestamp":"2025-11-22T14:23:12.447993-05:00","level":"DEBUG","message":"Tracking storage for tenant","fields":{"tenant_id":"test-tenant"},"component":"test"}
--- PASS: TestBroker_UpdateTenantStorageUsage_WithTenants (0.00s)
=== RUN   TestBroker_UpdateTenantStorageUsage_EmptyTenantsList
--- PASS: TestBroker_UpdateTenantStorageUsage_EmptyTenantsList (0.00s)
=== RUN   TestBroker_IsReady
--- PASS: TestBroker_IsReady (0.00s)
=== RUN   TestBroker_IsAlive
--- PASS: TestBroker_IsAlive (0.00s)
=== RUN   TestBroker_IsLeader_NoRaftNode
--- PASS: TestBroker_IsLeader_NoRaftNode (0.00s)
=== RUN   TestMultiTenancyIntegration
    tenancy_integration_test.go:19: Skipping integration test in short mode
--- SKIP: TestMultiTenancyIntegration (0.00s)
=== RUN   TestTenantQuotaEnforcement
=== RUN   TestTenantQuotaEnforcement/EnforceThroughputQuota
=== RUN   TestTenantQuotaEnforcement/EnforceConnectionQuota
=== RUN   TestTenantQuotaEnforcement/EnforceTopicQuota
=== RUN   TestTenantQuotaEnforcement/GetUsageStats
=== RUN   TestTenantQuotaEnforcement/GetUtilization
--- PASS: TestTenantQuotaEnforcement (0.00s)
    --- PASS: TestTenantQuotaEnforcement/EnforceThroughputQuota (0.00s)
    --- PASS: TestTenantQuotaEnforcement/EnforceConnectionQuota (0.00s)
    --- PASS: TestTenantQuotaEnforcement/EnforceTopicQuota (0.00s)
    --- PASS: TestTenantQuotaEnforcement/GetUsageStats (0.00s)
    --- PASS: TestTenantQuotaEnforcement/GetUtilization (0.00s)
PASS
coverage: 34.2% of statements
ok  	github.com/gstreamio/streambus/pkg/broker	11.345s	coverage: 34.2% of statements
=== RUN   TestClient_New
--- PASS: TestClient_New (0.00s)
=== RUN   TestClient_NewWithInvalidConfig
--- PASS: TestClient_NewWithInvalidConfig (0.00s)
=== RUN   TestClient_HealthCheck
{"level":"info","ts":1763839382.884846,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839382.8852239,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839382.987094,"msg":"stopping server"}
{"level":"info","ts":1763839382.987168,"msg":"server stopped"}
--- PASS: TestClient_HealthCheck (0.10s)
=== RUN   TestClient_CreateTopic
{"level":"info","ts":1763839382.9886599,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839382.9887302,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.091213,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839383.091428,"msg":"stopping server"}
{"level":"info","ts":1763839383.091485,"msg":"server stopped"}
--- PASS: TestClient_CreateTopic (0.10s)
=== RUN   TestClient_DeleteTopic
{"level":"info","ts":1763839383.09267,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.092769,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.1958988,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839383.197653,"msg":"stopping server"}
{"level":"info","ts":1763839383.1977532,"msg":"server stopped"}
--- PASS: TestClient_DeleteTopic (0.11s)
=== RUN   TestClient_ListTopics
{"level":"info","ts":1763839383.1990552,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.1992629,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.300956,"msg":"stopping server"}
{"level":"info","ts":1763839383.301012,"msg":"server stopped"}
--- PASS: TestClient_ListTopics (0.10s)
=== RUN   TestClient_Close
--- PASS: TestClient_Close (0.00s)
=== RUN   TestProducer_New
--- PASS: TestProducer_New (0.00s)
=== RUN   TestProducer_Send
{"level":"info","ts":1763839383.302623,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.30269,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.4046772,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839383.405004,"msg":"stopping server"}
{"level":"info","ts":1763839383.4050791,"msg":"server stopped"}
--- PASS: TestProducer_Send (0.10s)
=== RUN   TestProducer_SendToPartition
{"level":"info","ts":1763839383.405914,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.405994,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.5087922,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839383.509666,"msg":"stopping server"}
{"level":"info","ts":1763839383.509741,"msg":"server stopped"}
--- PASS: TestProducer_SendToPartition (0.11s)
=== RUN   TestProducer_SendMessages
{"level":"info","ts":1763839383.5114398,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.511617,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.613446,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839383.6137972,"msg":"stopping server"}
{"level":"info","ts":1763839383.613846,"msg":"server stopped"}
--- PASS: TestProducer_SendMessages (0.10s)
=== RUN   TestProducer_Batching
{"level":"info","ts":1763839383.61457,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.614644,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839383.716531,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839383.91777,"msg":"stopping server"}
{"level":"info","ts":1763839383.9179032,"msg":"server stopped"}
--- PASS: TestProducer_Batching (0.30s)
=== RUN   TestProducer_Flush
{"level":"info","ts":1763839383.918762,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839383.9188612,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.020063,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.0203362,"msg":"stopping server"}
{"level":"info","ts":1763839384.020381,"msg":"server stopped"}
--- PASS: TestProducer_Flush (0.10s)
=== RUN   TestProducer_Close
--- PASS: TestProducer_Close (0.00s)
=== RUN   TestConsumer_New
--- PASS: TestConsumer_New (0.00s)
=== RUN   TestConsumer_Fetch
{"level":"info","ts":1763839384.0214741,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.021548,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.124487,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.1249752,"msg":"stopping server"}
{"level":"info","ts":1763839384.125023,"msg":"server stopped"}
--- PASS: TestConsumer_Fetch (0.10s)
=== RUN   TestConsumer_Seek
--- PASS: TestConsumer_Seek (0.00s)
=== RUN   TestConsumer_SeekToBeginning
--- PASS: TestConsumer_SeekToBeginning (0.00s)
=== RUN   TestConsumer_Close
--- PASS: TestConsumer_Close (0.00s)
=== RUN   TestConsumer_FetchOne
{"level":"info","ts":1763839384.126005,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.126084,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.227981,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.228436,"msg":"stopping server"}
{"level":"info","ts":1763839384.228479,"msg":"server stopped"}
--- PASS: TestConsumer_FetchOne (0.10s)
=== RUN   TestConsumer_FetchOne_NoMessages
{"level":"info","ts":1763839384.229393,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.2294521,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.330444,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.330699,"msg":"stopping server"}
{"level":"info","ts":1763839384.3307378,"msg":"server stopped"}
--- PASS: TestConsumer_FetchOne_NoMessages (0.10s)
=== RUN   TestConsumer_SeekToEnd
{"level":"info","ts":1763839384.331551,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.3316102,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.4326,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.433036,"msg":"stopping server"}
{"level":"info","ts":1763839384.433077,"msg":"server stopped"}
--- PASS: TestConsumer_SeekToEnd (0.10s)
=== RUN   TestConsumer_GetEndOffset
{"level":"info","ts":1763839384.433815,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.433876,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.53617,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.536574,"msg":"stopping server"}
{"level":"info","ts":1763839384.536627,"msg":"server stopped"}
--- PASS: TestConsumer_GetEndOffset (0.10s)
=== RUN   TestConsumer_GetEndOffset_Closed
--- PASS: TestConsumer_GetEndOffset_Closed (0.00s)
=== RUN   TestConsumer_Stats
{"level":"info","ts":1763839384.537698,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.5377889,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.639528,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839384.639963,"msg":"stopping server"}
{"level":"info","ts":1763839384.640011,"msg":"server stopped"}
--- PASS: TestConsumer_Stats (0.10s)
=== RUN   TestConnectionPool_GetAndPut
{"level":"info","ts":1763839384.640747,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.640817,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.7424068,"msg":"stopping server"}
{"level":"info","ts":1763839384.742475,"msg":"server stopped"}
--- PASS: TestConnectionPool_GetAndPut (0.10s)
=== RUN   TestConnectionPool_Stats
{"level":"info","ts":1763839384.743175,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.743248,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.844121,"msg":"stopping server"}
{"level":"info","ts":1763839384.844173,"msg":"server stopped"}
--- PASS: TestConnectionPool_Stats (0.10s)
=== RUN   TestConnectionPool_Close
{"level":"info","ts":1763839384.844861,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839384.844956,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839384.94592,"msg":"stopping server"}
{"level":"info","ts":1763839384.945974,"msg":"server stopped"}
--- PASS: TestConnectionPool_Close (0.10s)
=== RUN   TestGroupConsumer_Create
--- PASS: TestGroupConsumer_Create (0.00s)
=== RUN   TestGroupConsumer_CreateValidation
--- PASS: TestGroupConsumer_CreateValidation (0.00s)
=== RUN   TestGroupConsumer_Subscribe
--- PASS: TestGroupConsumer_Subscribe (0.00s)
=== RUN   TestGroupConsumer_Assignment
--- PASS: TestGroupConsumer_Assignment (0.00s)
=== RUN   TestGroupConsumer_CommitSync
--- PASS: TestGroupConsumer_CommitSync (0.00s)
=== RUN   TestGroupConsumer_Close
--- PASS: TestGroupConsumer_Close (0.00s)
=== RUN   TestGroupConsumer_Stats
--- PASS: TestGroupConsumer_Stats (0.00s)
=== RUN   TestGroupConsumer_RebalanceListener
--- PASS: TestGroupConsumer_RebalanceListener (0.00s)
=== RUN   TestGroupConsumer_HeartbeatSender
--- PASS: TestGroupConsumer_HeartbeatSender (0.30s)
=== RUN   TestNewPartitionConsumer
{"level":"info","ts":1763839385.2486348,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.248738,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.349443,"msg":"stopping server"}
{"level":"info","ts":1763839385.3495219,"msg":"server stopped"}
--- PASS: TestNewPartitionConsumer (0.10s)
=== RUN   TestNewPartitionConsumerWithConfig
{"level":"info","ts":1763839385.350166,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.350264,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.451103,"msg":"stopping server"}
{"level":"info","ts":1763839385.4511812,"msg":"server stopped"}
--- PASS: TestNewPartitionConsumerWithConfig (0.10s)
=== RUN   TestPartitionConsumer_FetchFromPartition
{"level":"info","ts":1763839385.451798,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.451893,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.556063,"msg":"starting recovery","nextOffset":0}
    partition_consumer_test.go:137: Fetched 0 messages
{"level":"info","ts":1763839385.656963,"msg":"stopping server"}
{"level":"info","ts":1763839385.657021,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchFromPartition (0.21s)
=== RUN   TestPartitionConsumer_FetchFromPartition_InvalidPartition
{"level":"info","ts":1763839385.657836,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.657909,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.758095,"msg":"stopping server"}
{"level":"info","ts":1763839385.758167,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchFromPartition_InvalidPartition (0.10s)
=== RUN   TestPartitionConsumer_FetchFromPartition_Closed
{"level":"info","ts":1763839385.762159,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.762305,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.8625972,"msg":"stopping server"}
{"level":"info","ts":1763839385.8626711,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchFromPartition_Closed (0.11s)
=== RUN   TestPartitionConsumer_FetchAll
{"level":"info","ts":1763839385.866536,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.8666189,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.968555,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.968912,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.9738371,"msg":"starting recovery","nextOffset":0}
    partition_consumer_test.go:240: Partition 0: 0 messages
    partition_consumer_test.go:240: Partition 2: 0 messages
    partition_consumer_test.go:240: Partition 1: 0 messages
{"level":"info","ts":1763839386.075542,"msg":"stopping server"}
{"level":"info","ts":1763839386.075598,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchAll (0.22s)
=== RUN   TestPartitionConsumer_FetchAll_Closed
{"level":"info","ts":1763839386.0833411,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.083439,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.1846159,"msg":"stopping server"}
{"level":"info","ts":1763839386.18474,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchAll_Closed (0.10s)
=== RUN   TestPartitionConsumer_FetchRoundRobin
{"level":"info","ts":1763839386.187985,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.1881092,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.294888,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.300247,"msg":"starting recovery","nextOffset":0}
    partition_consumer_test.go:306: Fetched 0 messages in round-robin
{"level":"info","ts":1763839386.4013,"msg":"stopping server"}
{"level":"info","ts":1763839386.4013472,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchRoundRobin (0.22s)
=== RUN   TestPartitionConsumer_FetchRoundRobin_NoPartitions
{"level":"info","ts":1763839386.4101472,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.41026,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.5105238,"msg":"stopping server"}
{"level":"info","ts":1763839386.510587,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchRoundRobin_NoPartitions (0.10s)
=== RUN   TestPartitionConsumer_FetchRoundRobin_Closed
{"level":"info","ts":1763839386.516957,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.5170848,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.617259,"msg":"stopping server"}
{"level":"info","ts":1763839386.617331,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_FetchRoundRobin_Closed (0.11s)
=== RUN   TestPartitionConsumer_SeekPartition
{"level":"info","ts":1763839386.6232169,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.623323,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.723466,"msg":"stopping server"}
{"level":"info","ts":1763839386.7235332,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekPartition (0.11s)
=== RUN   TestPartitionConsumer_SeekPartition_InvalidPartition
{"level":"info","ts":1763839386.727575,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.727676,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.8279989,"msg":"stopping server"}
{"level":"info","ts":1763839386.82807,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekPartition_InvalidPartition (0.10s)
=== RUN   TestPartitionConsumer_SeekPartition_InvalidOffset
{"level":"info","ts":1763839386.8323898,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.832492,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.932826,"msg":"stopping server"}
{"level":"info","ts":1763839386.932891,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekPartition_InvalidOffset (0.11s)
=== RUN   TestPartitionConsumer_SeekPartition_Closed
{"level":"info","ts":1763839386.9366322,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.9367418,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.0369039,"msg":"stopping server"}
{"level":"info","ts":1763839387.036976,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekPartition_Closed (0.10s)
=== RUN   TestPartitionConsumer_SeekAll
{"level":"info","ts":1763839387.039653,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.0397482,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.140287,"msg":"stopping server"}
{"level":"info","ts":1763839387.140364,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekAll (0.10s)
=== RUN   TestPartitionConsumer_SeekAll_InvalidOffset
{"level":"info","ts":1763839387.1491709,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.14928,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.249737,"msg":"stopping server"}
{"level":"info","ts":1763839387.2498171,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekAll_InvalidOffset (0.11s)
=== RUN   TestPartitionConsumer_SeekAll_Closed
{"level":"info","ts":1763839387.252471,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.2525811,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.352919,"msg":"stopping server"}
{"level":"info","ts":1763839387.352999,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_SeekAll_Closed (0.10s)
=== RUN   TestPartitionConsumer_GetOffsets
{"level":"info","ts":1763839387.3565052,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.3569841,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.45718,"msg":"stopping server"}
{"level":"info","ts":1763839387.457261,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_GetOffsets (0.10s)
=== RUN   TestPartitionConsumer_GetPartitionInfo
{"level":"info","ts":1763839387.458119,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.45822,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.5585861,"msg":"stopping server"}
{"level":"info","ts":1763839387.5586739,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_GetPartitionInfo (0.10s)
=== RUN   TestPartitionConsumer_GetPartitionInfo_InvalidPartition
{"level":"info","ts":1763839387.5629609,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.5630798,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.6634948,"msg":"stopping server"}
{"level":"info","ts":1763839387.663575,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_GetPartitionInfo_InvalidPartition (0.10s)
=== RUN   TestPartitionConsumer_PollPartitions
{"level":"info","ts":1763839387.6652951,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839387.665389,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839387.766494,"msg":"starting recovery","nextOffset":0}
    partition_consumer_test.go:696: Polled 0 messages
{"level":"info","ts":1763839388.366942,"msg":"stopping server"}
{"level":"info","ts":1763839388.3670049,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_PollPartitions (0.70s)
=== RUN   TestPartitionConsumer_PollPartitions_Closed
{"level":"info","ts":1763839388.3678348,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.367933,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839388.468205,"msg":"stopping server"}
{"level":"info","ts":1763839388.468284,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_PollPartitions_Closed (0.10s)
=== RUN   TestPartitionConsumer_Close
{"level":"info","ts":1763839388.468972,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.469067,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839388.5694451,"msg":"stopping server"}
{"level":"info","ts":1763839388.569519,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_Close (0.10s)
=== RUN   TestPartitionConsumer_Metrics
{"level":"info","ts":1763839388.571329,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.571438,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839388.6715908,"msg":"stopping server"}
{"level":"info","ts":1763839388.671658,"msg":"server stopped"}
--- PASS: TestPartitionConsumer_Metrics (0.10s)
=== RUN   TestNewConnectionPool
--- PASS: TestNewConnectionPool (0.00s)
=== RUN   TestConnectionPool_GetAndPutDetailed
{"level":"info","ts":1763839388.6723032,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.672394,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839388.77317,"msg":"stopping server"}
{"level":"info","ts":1763839388.7732322,"msg":"server stopped"}
--- PASS: TestConnectionPool_GetAndPutDetailed (0.10s)
=== RUN   TestConnectionPool_GetMultipleConnections
{"level":"info","ts":1763839388.775797,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.775884,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839388.876986,"msg":"stopping server"}
{"level":"info","ts":1763839388.8770602,"msg":"server stopped"}
--- PASS: TestConnectionPool_GetMultipleConnections (0.10s)
=== RUN   TestConnectionPool_Remove
{"level":"info","ts":1763839388.877679,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.877752,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839388.9785228,"msg":"stopping server"}
{"level":"info","ts":1763839388.978583,"msg":"server stopped"}
--- PASS: TestConnectionPool_Remove (0.10s)
=== RUN   TestConnectionPool_CloseDetailed
{"level":"info","ts":1763839388.979251,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839388.979307,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.080311,"msg":"stopping server"}
{"level":"info","ts":1763839389.080373,"msg":"server stopped"}
--- PASS: TestConnectionPool_CloseDetailed (0.10s)
=== RUN   TestConnectionPool_StatsDetailed
{"level":"info","ts":1763839389.0810812,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.081147,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.182008,"msg":"stopping server"}
{"level":"info","ts":1763839389.182074,"msg":"server stopped"}
--- PASS: TestConnectionPool_StatsDetailed (0.10s)
=== RUN   TestConnectionPool_Cleanup
{"level":"info","ts":1763839389.18332,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.183408,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.2841332,"msg":"stopping server"}
{"level":"info","ts":1763839389.2841861,"msg":"server stopped"}
--- PASS: TestConnectionPool_Cleanup (0.10s)
=== RUN   TestConnectionPool_CleanupUnhealthyConnection
{"level":"info","ts":1763839389.28482,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.284888,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.385312,"msg":"stopping server"}
{"level":"info","ts":1763839389.385369,"msg":"server stopped"}
--- PASS: TestConnectionPool_CleanupUnhealthyConnection (0.10s)
=== RUN   TestConnection_MarkUsed
{"level":"info","ts":1763839389.386039,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.386106,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.4967759,"msg":"stopping server"}
{"level":"info","ts":1763839389.496835,"msg":"server stopped"}
--- PASS: TestConnection_MarkUsed (0.11s)
=== RUN   TestConnection_IsHealthy
{"level":"info","ts":1763839389.4974232,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.4975061,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.598055,"msg":"stopping server"}
{"level":"info","ts":1763839389.598114,"msg":"server stopped"}
--- PASS: TestConnection_IsHealthy (0.10s)
=== RUN   TestConnectionPool_BuildTLSConfig
--- PASS: TestConnectionPool_BuildTLSConfig (0.00s)
=== RUN   TestConnectionPool_BuildTLSConfig_InvalidCAFile
--- PASS: TestConnectionPool_BuildTLSConfig_InvalidCAFile (0.00s)
=== RUN   TestConnectionPool_CreateConnection_InvalidBroker
--- PASS: TestConnectionPool_CreateConnection_InvalidBroker (0.00s)
=== RUN   TestConnectionPool_PutNilConnection
--- PASS: TestConnectionPool_PutNilConnection (0.00s)
=== RUN   TestConnection_NextRequestID
{"level":"info","ts":1763839389.6020951,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.602182,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.702739,"msg":"stopping server"}
{"level":"info","ts":1763839389.7028081,"msg":"server stopped"}
--- PASS: TestConnection_NextRequestID (0.10s)
=== RUN   TestConnection_Close
{"level":"info","ts":1763839389.7034292,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.703518,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.804255,"msg":"stopping server"}
{"level":"info","ts":1763839389.804308,"msg":"server stopped"}
--- PASS: TestConnection_Close (0.10s)
=== RUN   TestConnectionPool_MultipleCleanupCycles
{"level":"info","ts":1763839389.804838,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839389.804904,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839389.935877,"msg":"stopping server"}
{"level":"info","ts":1763839389.9359722,"msg":"server stopped"}
--- PASS: TestConnectionPool_MultipleCleanupCycles (0.13s)
=== RUN   TestNewTransactionalConsumer
=== RUN   TestNewTransactionalConsumer/nil_config
=== RUN   TestNewTransactionalConsumer/nil_client
=== RUN   TestNewTransactionalConsumer/no_topics
=== RUN   TestNewTransactionalConsumer/invalid_isolation_level
=== RUN   TestNewTransactionalConsumer/valid_read-committed
=== RUN   TestNewTransactionalConsumer/valid_read-uncommitted
--- PASS: TestNewTransactionalConsumer (0.00s)
    --- PASS: TestNewTransactionalConsumer/nil_config (0.00s)
    --- PASS: TestNewTransactionalConsumer/nil_client (0.00s)
    --- PASS: TestNewTransactionalConsumer/no_topics (0.00s)
    --- PASS: TestNewTransactionalConsumer/invalid_isolation_level (0.00s)
    --- PASS: TestNewTransactionalConsumer/valid_read-committed (0.00s)
    --- PASS: TestNewTransactionalConsumer/valid_read-uncommitted (0.00s)
=== RUN   TestTransactionalConsumer_Poll
    transactional_consumer_test.go:119: poll failed as expected (no broker): fetch failed: failed to decode response: message too large: 1213486160 bytes (max 10485760)
--- PASS: TestTransactionalConsumer_Poll (0.00s)
=== RUN   TestTransactionalConsumer_ReadCommittedFiltering
--- PASS: TestTransactionalConsumer_ReadCommittedFiltering (0.00s)
=== RUN   TestTransactionalConsumer_ReadUncommitted
--- PASS: TestTransactionalConsumer_ReadUncommitted (0.00s)
=== RUN   TestTransactionalConsumer_AbortedTransactions
--- PASS: TestTransactionalConsumer_AbortedTransactions (0.00s)
=== RUN   TestTransactionalConsumer_Commit
--- PASS: TestTransactionalConsumer_Commit (0.00s)
=== RUN   TestTransactionalConsumer_CommitSync
--- PASS: TestTransactionalConsumer_CommitSync (0.00s)
=== RUN   TestTransactionalConsumer_Seek
--- PASS: TestTransactionalConsumer_Seek (0.00s)
=== RUN   TestTransactionalConsumer_Position
--- PASS: TestTransactionalConsumer_Position (0.00s)
=== RUN   TestTransactionalConsumer_Close
--- PASS: TestTransactionalConsumer_Close (0.00s)
=== RUN   TestTransactionalConsumer_Stats
--- PASS: TestTransactionalConsumer_Stats (0.00s)
=== RUN   TestDefaultTransactionalConsumerConfig
--- PASS: TestDefaultTransactionalConsumerConfig (0.00s)
=== RUN   TestTransactionalConsumer_UpdateLastStableOffset
--- PASS: TestTransactionalConsumer_UpdateLastStableOffset (0.00s)
=== RUN   TestTransactionalProducer_Create
--- PASS: TestTransactionalProducer_Create (0.00s)
=== RUN   TestTransactionalProducer_CreateValidation
--- PASS: TestTransactionalProducer_CreateValidation (0.00s)
=== RUN   TestTransactionalProducer_BeginTransaction
--- PASS: TestTransactionalProducer_BeginTransaction (0.00s)
=== RUN   TestTransactionalProducer_SendMessages
--- PASS: TestTransactionalProducer_SendMessages (0.00s)
=== RUN   TestTransactionalProducer_CommitTransaction
--- PASS: TestTransactionalProducer_CommitTransaction (0.00s)
=== RUN   TestTransactionalProducer_AbortTransaction
--- PASS: TestTransactionalProducer_AbortTransaction (0.00s)
=== RUN   TestTransactionalProducer_MultipleTransactions
--- PASS: TestTransactionalProducer_MultipleTransactions (0.00s)
=== RUN   TestTransactionalProducer_SendWithoutTransaction
--- PASS: TestTransactionalProducer_SendWithoutTransaction (0.00s)
=== RUN   TestTransactionalProducer_SendOffsetsToTransaction
--- PASS: TestTransactionalProducer_SendOffsetsToTransaction (0.00s)
=== RUN   TestTransactionalProducer_Close
--- PASS: TestTransactionalProducer_Close (0.00s)
=== RUN   TestTransactionalProducer_Stats
--- PASS: TestTransactionalProducer_Stats (0.00s)
PASS
coverage: 78.5% of statements
ok  	github.com/gstreamio/streambus/pkg/client	8.837s	coverage: 78.5% of statements
=== RUN   TestAssignment_AddReplica
--- PASS: TestAssignment_AddReplica (0.00s)
=== RUN   TestAssignment_IsBalanced
--- PASS: TestAssignment_IsBalanced (0.00s)
=== RUN   TestAssignment_Validate
=== RUN   TestAssignment_Validate/valid_assignment
=== RUN   TestAssignment_Validate/missing_leader
=== RUN   TestAssignment_Validate/leader_not_in_replicas
=== RUN   TestAssignment_Validate/broker_load_mismatch
--- PASS: TestAssignment_Validate (0.00s)
    --- PASS: TestAssignment_Validate/valid_assignment (0.00s)
    --- PASS: TestAssignment_Validate/missing_leader (0.00s)
    --- PASS: TestAssignment_Validate/leader_not_in_replicas (0.00s)
    --- PASS: TestAssignment_Validate/broker_load_mismatch (0.00s)
=== RUN   TestAssignment_GetStats
--- PASS: TestAssignment_GetStats (0.00s)
=== RUN   TestAssignment_Clone
--- PASS: TestAssignment_Clone (0.00s)
=== RUN   TestPartitionKey
--- PASS: TestPartitionKey (0.00s)
=== RUN   TestFilterExcludedBrokers
--- PASS: TestFilterExcludedBrokers (0.00s)
=== RUN   TestSortBrokersByLoad
--- PASS: TestSortBrokersByLoad (0.00s)
=== RUN   TestBrokerMetadata_Address
--- PASS: TestBrokerMetadata_Address (0.00s)
=== RUN   TestBrokerMetadata_IsHealthy
=== RUN   TestBrokerMetadata_IsHealthy/alive
=== RUN   TestBrokerMetadata_IsHealthy/starting
=== RUN   TestBrokerMetadata_IsHealthy/failed
=== RUN   TestBrokerMetadata_IsHealthy/draining
=== RUN   TestBrokerMetadata_IsHealthy/decommissioned
--- PASS: TestBrokerMetadata_IsHealthy (0.00s)
    --- PASS: TestBrokerMetadata_IsHealthy/alive (0.00s)
    --- PASS: TestBrokerMetadata_IsHealthy/starting (0.00s)
    --- PASS: TestBrokerMetadata_IsHealthy/failed (0.00s)
    --- PASS: TestBrokerMetadata_IsHealthy/draining (0.00s)
    --- PASS: TestBrokerMetadata_IsHealthy/decommissioned (0.00s)
=== RUN   TestBrokerMetadata_DiskUtilization
--- PASS: TestBrokerMetadata_DiskUtilization (0.00s)
=== RUN   TestBrokerRegistry_RegisterBroker
--- PASS: TestBrokerRegistry_RegisterBroker (0.00s)
=== RUN   TestBrokerRegistry_DeregisterBroker
--- PASS: TestBrokerRegistry_DeregisterBroker (0.00s)
=== RUN   TestBrokerRegistry_RecordHeartbeat
--- PASS: TestBrokerRegistry_RecordHeartbeat (0.01s)
=== RUN   TestBrokerRegistry_ListBrokers
--- PASS: TestBrokerRegistry_ListBrokers (0.00s)
=== RUN   TestBrokerRegistry_ListActiveBrokers
--- PASS: TestBrokerRegistry_ListActiveBrokers (0.00s)
=== RUN   TestBrokerRegistry_GetBrokerCount
--- PASS: TestBrokerRegistry_GetBrokerCount (0.00s)
=== RUN   TestBrokerRegistry_HealthMonitoring
--- PASS: TestBrokerRegistry_HealthMonitoring (0.20s)
=== RUN   TestBrokerRegistry_Callbacks
--- PASS: TestBrokerRegistry_Callbacks (0.10s)
=== RUN   TestBrokerRegistry_GetBrokerStats
--- PASS: TestBrokerRegistry_GetBrokerStats (0.00s)
=== RUN   TestClusterCoordinator_AssignPartitions
2025/11/22 14:23:02 [ClusterCoordinator] Created assignment: 3 partitions across 3 brokers
--- PASS: TestClusterCoordinator_AssignPartitions (0.00s)
=== RUN   TestClusterCoordinator_TriggerRebalance
2025/11/22 14:23:02 [ClusterCoordinator] Created assignment: 4 partitions across 2 brokers
2025/11/22 14:23:02 [ClusterCoordinator] Starting rebalance...
2025/11/22 14:23:02 [ClusterCoordinator] Rebalance complete in 14.208µs: 4 partitions, 2 brokers, imbalance=0, min=2, max=2
--- PASS: TestClusterCoordinator_TriggerRebalance (0.00s)
=== RUN   TestClusterCoordinator_RebalanceOnBrokerAdd
2025/11/22 14:23:02 [ClusterCoordinator] Started with strategy: Sticky
2025/11/22 14:23:02 [ClusterCoordinator] Created assignment: 2 partitions across 2 brokers
2025/11/22 14:23:02 [ClusterCoordinator] Broker 2 added, triggering rebalance
2025/11/22 14:23:02 [ClusterCoordinator] Broker 1 added, triggering rebalance
2025/11/22 14:23:02 [ClusterCoordinator] Broker 3 added, triggering rebalance
2025/11/22 14:23:02 [ClusterCoordinator] Starting rebalance...
2025/11/22 14:23:02 [ClusterCoordinator] Rebalance failed after broker add: rebalance already in progress
2025/11/22 14:23:02 [ClusterCoordinator] Rebalance failed after broker add: rebalance already in progress
2025/11/22 14:23:02 [ClusterCoordinator] Rebalance complete in 41.75µs: 2 partitions, 2 brokers, imbalance=0, min=1, max=1
--- PASS: TestClusterCoordinator_RebalanceOnBrokerAdd (0.10s)
=== RUN   TestClusterCoordinator_SetRebalanceInterval
--- PASS: TestClusterCoordinator_SetRebalanceInterval (0.00s)
=== RUN   TestClusterCoordinator_SetRebalanceThreshold
--- PASS: TestClusterCoordinator_SetRebalanceThreshold (0.00s)
=== RUN   TestClusterCoordinator_NoActiveBrokers
--- PASS: TestClusterCoordinator_NoActiveBrokers (0.00s)
=== RUN   TestClusterCoordinator_ConcurrentRebalance
2025/11/22 14:23:02 [ClusterCoordinator] Created assignment: 2 partitions across 3 brokers
2025/11/22 14:23:02 [ClusterCoordinator] Starting rebalance...
2025/11/22 14:23:02 [ClusterCoordinator] Rebalance complete in 15.75µs: 2 partitions, 2 brokers, imbalance=0, min=1, max=1
--- PASS: TestClusterCoordinator_ConcurrentRebalance (0.00s)
=== RUN   TestClusterCoordinator_GetRebalanceStats
--- PASS: TestClusterCoordinator_GetRebalanceStats (0.00s)
=== RUN   TestNewHeartbeatService
--- PASS: TestNewHeartbeatService (0.00s)
=== RUN   TestHeartbeatService_SetInterval
--- PASS: TestHeartbeatService_SetInterval (0.00s)
=== RUN   TestHeartbeatService_SetTimeout
--- PASS: TestHeartbeatService_SetTimeout (0.00s)
=== RUN   TestHeartbeatService_StartStop
2025/11/22 14:23:03 [Heartbeat 1] Failed to send heartbeat: heartbeat timeout after 5s
--- PASS: TestHeartbeatService_StartStop (0.15s)
=== RUN   TestHeartbeatService_Metrics
--- PASS: TestHeartbeatService_Metrics (0.00s)
=== RUN   TestHeartbeatService_FailedHeartbeat
--- PASS: TestHeartbeatService_FailedHeartbeat (0.00s)
=== RUN   TestHeartbeatService_HeartbeatLoop
2025/11/22 14:23:03 [Heartbeat 1] Failed to send heartbeat: heartbeat timeout after 5s
--- PASS: TestHeartbeatService_HeartbeatLoop (0.12s)
=== RUN   TestHeartbeatService_ConcurrentAccess
--- PASS: TestHeartbeatService_ConcurrentAccess (0.11s)
=== RUN   TestNewBrokerHealthChecker
--- PASS: TestNewBrokerHealthChecker (0.00s)
=== RUN   TestBrokerHealthChecker_SetHealthCheckFunction
--- PASS: TestBrokerHealthChecker_SetHealthCheckFunction (0.00s)
=== RUN   TestBrokerHealthChecker_StartStop
--- PASS: TestBrokerHealthChecker_StartStop (0.10s)
=== RUN   TestBrokerHealthChecker_CheckAllBrokers
--- PASS: TestBrokerHealthChecker_CheckAllBrokers (0.00s)
=== RUN   TestBrokerHealthChecker_NoHealthCheckFunction
--- PASS: TestBrokerHealthChecker_NoHealthCheckFunction (0.00s)
=== RUN   TestBrokerHealthChecker_PerformHealthCheck
--- PASS: TestBrokerHealthChecker_PerformHealthCheck (0.00s)
=== RUN   TestBrokerHealthChecker_HealthCheckLoop
    heartbeat_test.go:465: Note: Expected at least 4 checks (2 brokers × 2 cycles), got 0
--- PASS: TestBrokerHealthChecker_HealthCheckLoop (0.15s)
=== RUN   TestBrokerHealthChecker_Timeout
--- PASS: TestBrokerHealthChecker_Timeout (0.01s)
=== RUN   TestHeartbeatService_Timeout
--- PASS: TestHeartbeatService_Timeout (0.00s)
=== RUN   TestHeartbeatMetrics_Structure
--- PASS: TestHeartbeatMetrics_Structure (0.00s)
=== RUN   TestRange_BasicAssignment
--- PASS: TestRange_BasicAssignment (0.00s)
=== RUN   TestRange_MultipleTopics
--- PASS: TestRange_MultipleTopics (0.00s)
=== RUN   TestRange_UnevenDistribution
--- PASS: TestRange_UnevenDistribution (0.00s)
=== RUN   TestRange_RackAware
--- PASS: TestRange_RackAware (0.00s)
=== RUN   TestRange_Rebalance
--- PASS: TestRange_Rebalance (0.00s)
=== RUN   TestRange_AlreadyBalanced
--- PASS: TestRange_AlreadyBalanced (0.00s)
=== RUN   TestRoundRobin_BasicAssignment
--- PASS: TestRoundRobin_BasicAssignment (0.00s)
=== RUN   TestRoundRobin_InsufficientBrokers
--- PASS: TestRoundRobin_InsufficientBrokers (0.00s)
=== RUN   TestRoundRobin_ExcludedBrokers
--- PASS: TestRoundRobin_ExcludedBrokers (0.00s)
=== RUN   TestRoundRobin_RackAware
--- PASS: TestRoundRobin_RackAware (0.00s)
=== RUN   TestRoundRobin_Rebalance
--- PASS: TestRoundRobin_Rebalance (0.00s)
=== RUN   TestRoundRobin_NoPartitions
--- PASS: TestRoundRobin_NoPartitions (0.00s)
=== RUN   TestRoundRobin_NoBrokers
--- PASS: TestRoundRobin_NoBrokers (0.00s)
=== RUN   TestRoundRobin_AllBrokersExcluded
--- PASS: TestRoundRobin_AllBrokersExcluded (0.00s)
=== RUN   TestSticky_InitialAssignment
--- PASS: TestSticky_InitialAssignment (0.00s)
=== RUN   TestSticky_MinimalMovement
--- PASS: TestSticky_MinimalMovement (0.00s)
=== RUN   TestSticky_AddBroker
--- PASS: TestSticky_AddBroker (0.00s)
=== RUN   TestSticky_RemoveBroker
--- PASS: TestSticky_RemoveBroker (0.00s)
=== RUN   TestSticky_MultiplePartitionsReassign
--- PASS: TestSticky_MultiplePartitionsReassign (0.00s)
=== RUN   TestSticky_PreserveExistingReplicas
--- PASS: TestSticky_PreserveExistingReplicas (0.00s)
=== RUN   TestSticky_BalancedNoOp
--- PASS: TestSticky_BalancedNoOp (0.00s)
PASS
coverage: 80.5% of statements
ok  	github.com/gstreamio/streambus/pkg/cluster	2.495s	coverage: 80.5% of statements
=== RUN   TestNewBackoff
--- PASS: TestNewBackoff (0.00s)
=== RUN   TestBackoff_Next
=== RUN   TestBackoff_Next/First_attempt
=== RUN   TestBackoff_Next/Second_attempt
=== RUN   TestBackoff_Next/Third_attempt
--- PASS: TestBackoff_Next (0.00s)
    --- PASS: TestBackoff_Next/First_attempt (0.00s)
    --- PASS: TestBackoff_Next/Second_attempt (0.00s)
    --- PASS: TestBackoff_Next/Third_attempt (0.00s)
=== RUN   TestBackoff_NextMaxCap
--- PASS: TestBackoff_NextMaxCap (0.00s)
=== RUN   TestBackoff_Reset
--- PASS: TestBackoff_Reset (0.00s)
=== RUN   TestBackoff_Jitter
--- PASS: TestBackoff_Jitter (0.00s)
=== RUN   TestNewCircuitBreaker
--- PASS: TestNewCircuitBreaker (0.00s)
=== RUN   TestCircuitBreaker_CallClosed
--- PASS: TestCircuitBreaker_CallClosed (0.00s)
=== RUN   TestCircuitBreaker_RecordSuccess
--- PASS: TestCircuitBreaker_RecordSuccess (0.00s)
=== RUN   TestCircuitBreaker_RecordFailure
--- PASS: TestCircuitBreaker_RecordFailure (0.00s)
=== RUN   TestCircuitBreaker_CallOpen
--- PASS: TestCircuitBreaker_CallOpen (0.00s)
=== RUN   TestCircuitBreaker_HalfOpen
--- PASS: TestCircuitBreaker_HalfOpen (0.15s)
=== RUN   TestCircuitBreaker_HalfOpenSuccess
--- PASS: TestCircuitBreaker_HalfOpenSuccess (0.15s)
=== RUN   TestCircuitBreaker_HalfOpenFailure
--- PASS: TestCircuitBreaker_HalfOpenFailure (0.15s)
=== RUN   TestCircuitBreaker_IsOpen
--- PASS: TestCircuitBreaker_IsOpen (0.15s)
=== RUN   TestCircuitBreaker_State
--- PASS: TestCircuitBreaker_State (0.00s)
=== RUN   TestCircuitBreaker_ConcurrentCalls
--- PASS: TestCircuitBreaker_ConcurrentCalls (0.00s)
=== RUN   TestBackoffResetAfterSuccess
--- PASS: TestBackoffResetAfterSuccess (0.00s)
=== RUN   TestCircuitBreakerWithBackoff
--- PASS: TestCircuitBreakerWithBackoff (0.00s)
=== RUN   TestThreeNodeCluster
    cluster_test.go:16: skipping integration test in short mode
--- SKIP: TestThreeNodeCluster (0.00s)
=== RUN   TestLeaderFailover
    cluster_test.go:115: skipping integration test in short mode
--- SKIP: TestLeaderFailover (0.00s)
=== RUN   TestConfigValidation
=== RUN   TestConfigValidation/valid_config
=== RUN   TestConfigValidation/zero_node_ID
=== RUN   TestConfigValidation/empty_data_dir
=== RUN   TestConfigValidation/election_tick_<=_heartbeat_tick
--- PASS: TestConfigValidation (0.00s)
    --- PASS: TestConfigValidation/valid_config (0.00s)
    --- PASS: TestConfigValidation/zero_node_ID (0.00s)
    --- PASS: TestConfigValidation/empty_data_dir (0.00s)
    --- PASS: TestConfigValidation/election_tick_<=_heartbeat_tick (0.00s)
=== RUN   TestDefaultConfig
--- PASS: TestDefaultConfig (0.00s)
=== RUN   TestConfigClone
--- PASS: TestConfigClone (0.00s)
=== RUN   TestDiskStorage
=== RUN   TestDiskStorage/initial_state
=== RUN   TestDiskStorage/first_and_last_index
--- PASS: TestDiskStorage (0.00s)
    --- PASS: TestDiskStorage/initial_state (0.00s)
    --- PASS: TestDiskStorage/first_and_last_index (0.00s)
=== RUN   TestDiskStoragePersistence
--- PASS: TestDiskStoragePersistence (0.01s)
=== RUN   TestStateTypeString
=== RUN   TestStateTypeString/Follower
=== RUN   TestStateTypeString/Candidate
=== RUN   TestStateTypeString/Leader
=== RUN   TestStateTypeString/Unknown
--- PASS: TestStateTypeString (0.00s)
    --- PASS: TestStateTypeString/Follower (0.00s)
    --- PASS: TestStateTypeString/Candidate (0.00s)
    --- PASS: TestStateTypeString/Leader (0.00s)
    --- PASS: TestStateTypeString/Unknown (0.00s)
=== RUN   TestNodeCreation
--- PASS: TestNodeCreation (0.00s)
=== RUN   TestNodeInvalidConfig
--- PASS: TestNodeInvalidConfig (0.00s)
=== RUN   TestSingleNodeCluster
    node_test.go:255: skipping integration test in short mode
--- SKIP: TestSingleNodeCluster (0.00s)
=== RUN   TestNode_Status
raft2025/11/22 14:23:03 INFO: 1 switched to configuration voters=()
raft2025/11/22 14:23:03 INFO: 1 became follower at term 0
raft2025/11/22 14:23:03 INFO: newRaft 1 [peers: [], term: 0, commit: 0, applied: 0, lastindex: 0, lastterm: 0]
raft2025/11/22 14:23:03 INFO: 1 became follower at term 1
raft2025/11/22 14:23:03 INFO: 1 switched to configuration voters=(1)
2025/11/22 14:23:03 [Node 1] Applying 1 committed entries
2025/11/22 14:23:03 [Node 1] Applying entry: index=1, term=1, type=EntryConfChange, dataLen=6
raft2025/11/22 14:23:03 INFO: 1 switched to configuration voters=(1)
2025/11/22 14:23:03 [Node 1] Applied entries up to index 1
--- PASS: TestNode_Status (0.20s)
=== RUN   TestNode_Ready
--- PASS: TestNode_Ready (0.00s)
=== RUN   TestDiskStorage_Snapshot
--- PASS: TestDiskStorage_Snapshot (0.00s)
=== RUN   TestDiskStorage_Compact
--- PASS: TestDiskStorage_Compact (0.01s)
=== RUN   TestRapidProposals
    rapid_proposals_test.go:15: skipping integration test in short mode
--- SKIP: TestRapidProposals (0.00s)
=== RUN   TestBidirectionalTransport_SendReceive
{"level":"info","ts":1763839383.853251,"msg":"connected to raft peer","nodeId":1,"peerId":2,"addr":"localhost:31002"}
--- PASS: TestBidirectionalTransport_SendReceive (0.80s)
=== RUN   TestBidirectionalTransport_Bidirectional
{"level":"info","ts":1763839384.644039,"msg":"connected to raft peer","nodeId":1,"peerId":2,"addr":"localhost:31012"}
--- PASS: TestBidirectionalTransport_Bidirectional (0.89s)
=== RUN   TestBidirectionalTransport_ThreeNodes
{"level":"info","ts":1763839385.6605718,"msg":"connected to raft peer","nodeId":1,"peerId":2,"addr":"localhost:31022"}
{"level":"info","ts":1763839385.768825,"msg":"connected to raft peer","nodeId":1,"peerId":3,"addr":"localhost:31023"}
{"level":"info","ts":1763839386.382705,"msg":"connected to raft peer","nodeId":2,"peerId":3,"addr":"localhost:31023"}
    transport_v2_test.go:229: Node 2 received 1 messages
    transport_v2_test.go:230: Node 3 received 2 messages
--- PASS: TestBidirectionalTransport_ThreeNodes (1.64s)
=== RUN   TestBidirectionalTransport_MultipleMessages
{"level":"info","ts":1763839387.167587,"msg":"connected to raft peer","nodeId":1,"peerId":2,"addr":"localhost:31032"}
    transport_v2_test.go:276: Received 10 messages
--- PASS: TestBidirectionalTransport_MultipleMessages (1.28s)
=== RUN   TestBidirectionalTransport_ConnectionReuse
{"level":"info","ts":1763839388.476492,"msg":"connected to raft peer","nodeId":1,"peerId":2,"addr":"localhost:31042"}
--- PASS: TestBidirectionalTransport_ConnectionReuse (0.51s)
PASS
coverage: 64.2% of statements
ok  	github.com/gstreamio/streambus/pkg/consensus	7.574s	coverage: 64.2% of statements
=== RUN   TestGroupCoordinator_ListGroups
{"timestamp":"2025-11-22T14:23:03.044955-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group-a"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045348-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group-a","member_id":"client-a-1763839383045341000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045392-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group-b"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045417-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group-b","member_id":"client-b-1763839383045412000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045442-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group-c"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045462-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group-c","member_id":"client-c-1763839383045458000"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_ListGroups (0.00s)
=== RUN   TestGroupCoordinator_GetGroup
{"timestamp":"2025-11-22T14:23:03.045578-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045605-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group","member_id":"client-1-1763839383045600000"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_GetGroup (0.00s)
=== RUN   TestGroupCoordinator_GetGroup_ImmutabilityCopy
{"timestamp":"2025-11-22T14:23:03.045705-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.045731-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group","member_id":"client-1-1763839383045727000"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_GetGroup_ImmutabilityCopy (0.00s)
=== RUN   TestGroupCoordinator_GetCommittedOffset
--- PASS: TestGroupCoordinator_GetCommittedOffset (0.00s)
=== RUN   TestGroupCoordinator_GetCommittedOffset_MultiplePartitions
--- PASS: TestGroupCoordinator_GetCommittedOffset_MultiplePartitions (0.00s)
=== RUN   TestGroupCoordinator_ListGroups_ConcurrentSafety
{"timestamp":"2025-11-22T14:23:03.04603-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"concurrent-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.04611-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"concurrent-group","member_id":"client-1-1763839383046100000"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_ListGroups_ConcurrentSafety (0.00s)
=== RUN   TestGroupCoordinator_JoinGroup
{"timestamp":"2025-11-22T14:23:03.046266-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046298-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group","member_id":"client-1-1763839383046293000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046346-05:00","level":"INFO","message":"Group transitioned to Stable","fields":{"generation_id":1,"group_id":"test-group","members":1},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.04639-05:00","level":"INFO","message":"Group rebalancing due to new member","fields":{"generation_id":2,"group_id":"test-group","member_id":"client-2-1763839383046379000"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_JoinGroup (0.00s)
=== RUN   TestGroupCoordinator_SyncGroup
{"timestamp":"2025-11-22T14:23:03.046496-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046521-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group","member_id":"client-1-1763839383046516000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046551-05:00","level":"INFO","message":"Group transitioned to Stable","fields":{"generation_id":1,"group_id":"test-group","members":1},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_SyncGroup (0.00s)
=== RUN   TestGroupCoordinator_Heartbeat
{"timestamp":"2025-11-22T14:23:03.046624-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046652-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group","member_id":"client-1-1763839383046648000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046678-05:00","level":"INFO","message":"Group transitioned to Stable","fields":{"generation_id":1,"group_id":"test-group","members":1},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_Heartbeat (0.00s)
=== RUN   TestGroupCoordinator_LeaveGroup
{"timestamp":"2025-11-22T14:23:03.046754-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"test-group"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046782-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"test-group","member_id":"client-1-1763839383046778000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046807-05:00","level":"INFO","message":"Member left group","fields":{"group_id":"test-group","member_id":"client-1-1763839383046778000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.046827-05:00","level":"INFO","message":"Group is now empty","fields":{"group_id":"test-group"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_LeaveGroup (0.00s)
=== RUN   TestGroupCoordinator_OffsetCommit
--- PASS: TestGroupCoordinator_OffsetCommit (0.00s)
=== RUN   TestGroupCoordinator_ExpiredMembers
--- PASS: TestGroupCoordinator_ExpiredMembers (0.80s)
=== RUN   TestGroupCoordinator_MultipleGroups
{"timestamp":"2025-11-22T14:23:03.849502-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"group-1"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.849932-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"group-1","member_id":"client-1-1763839383849891000"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.850102-05:00","level":"INFO","message":"Created new consumer group","fields":{"group_id":"group-2"},"component":"group-coordinator"}
{"timestamp":"2025-11-22T14:23:03.85021-05:00","level":"INFO","message":"Group transitioning to PreparingRebalance","fields":{"generation_id":1,"group_id":"group-2","member_id":"client-2-1763839383850184000"},"component":"group-coordinator"}
--- PASS: TestGroupCoordinator_MultipleGroups (0.00s)
=== RUN   TestOffsetStorage_MemoryStorage
--- PASS: TestOffsetStorage_MemoryStorage (0.00s)
=== RUN   TestNewOffsetManager
--- PASS: TestNewOffsetManager (0.00s)
=== RUN   TestOffsetManager_CommitOffset
--- PASS: TestOffsetManager_CommitOffset (0.00s)
=== RUN   TestOffsetManager_GetOffset
--- PASS: TestOffsetManager_GetOffset (0.00s)
=== RUN   TestOffsetManager_GetAllOffsets
--- PASS: TestOffsetManager_GetAllOffsets (0.00s)
=== RUN   TestOffsetManager_ResetOffsets
--- PASS: TestOffsetManager_ResetOffsets (0.00s)
=== RUN   TestOffsetManager_ValidateOffset
=== RUN   TestOffsetManager_ValidateOffset/valid_offset
=== RUN   TestOffsetManager_ValidateOffset/offset_at_minimum
=== RUN   TestOffsetManager_ValidateOffset/offset_at_maximum
=== RUN   TestOffsetManager_ValidateOffset/offset_below_minimum
=== RUN   TestOffsetManager_ValidateOffset/offset_above_maximum
=== RUN   TestOffsetManager_ValidateOffset/offset_far_below_minimum
=== RUN   TestOffsetManager_ValidateOffset/offset_far_above_maximum
--- PASS: TestOffsetManager_ValidateOffset (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/valid_offset (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/offset_at_minimum (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/offset_at_maximum (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/offset_below_minimum (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/offset_above_maximum (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/offset_far_below_minimum (0.00s)
    --- PASS: TestOffsetManager_ValidateOffset/offset_far_above_maximum (0.00s)
=== RUN   TestOffsetManager_CommitMultipleGroups
--- PASS: TestOffsetManager_CommitMultipleGroups (0.00s)
=== RUN   TestOffsetManager_OverwriteOffset
--- PASS: TestOffsetManager_OverwriteOffset (0.00s)
=== RUN   TestOffsetManager_ConcurrentCommits
--- PASS: TestOffsetManager_ConcurrentCommits (0.00s)
PASS
coverage: 77.2% of statements
ok  	github.com/gstreamio/streambus/pkg/consumer/group	2.747s	coverage: 77.2% of statements
=== RUN   TestCategory_String
=== RUN   TestCategory_String/retriable
=== RUN   TestCategory_String/transient
=== RUN   TestCategory_String/fatal
=== RUN   TestCategory_String/invalid_input
=== RUN   TestCategory_String/unknown
--- PASS: TestCategory_String (0.00s)
    --- PASS: TestCategory_String/retriable (0.00s)
    --- PASS: TestCategory_String/transient (0.00s)
    --- PASS: TestCategory_String/fatal (0.00s)
    --- PASS: TestCategory_String/invalid_input (0.00s)
    --- PASS: TestCategory_String/unknown (0.00s)
=== RUN   TestNew
--- PASS: TestNew (0.00s)
=== RUN   TestRetriable
--- PASS: TestRetriable (0.00s)
=== RUN   TestTransient
--- PASS: TestTransient (0.00s)
=== RUN   TestFatal
--- PASS: TestFatal (0.00s)
=== RUN   TestInvalidInput
--- PASS: TestInvalidInput (0.00s)
=== RUN   TestError_WithMessage
--- PASS: TestError_WithMessage (0.00s)
=== RUN   TestError_WithCode
--- PASS: TestError_WithCode (0.00s)
=== RUN   TestError_WithMetadata
--- PASS: TestError_WithMetadata (0.00s)
=== RUN   TestError_Error
=== RUN   TestError_Error/basic_error
=== RUN   TestError_Error/error_with_message
--- PASS: TestError_Error (0.00s)
    --- PASS: TestError_Error/basic_error (0.00s)
    --- PASS: TestError_Error/error_with_message (0.00s)
=== RUN   TestError_Unwrap
--- PASS: TestError_Unwrap (0.00s)
=== RUN   TestError_Is
--- PASS: TestError_Is (0.00s)
=== RUN   TestGetCategory
=== RUN   TestGetCategory/nil_error
=== RUN   TestGetCategory/structured_retriable
=== RUN   TestGetCategory/structured_transient
=== RUN   TestGetCategory/structured_fatal
=== RUN   TestGetCategory/structured_invalid_input
=== RUN   TestGetCategory/ErrNotLeader
=== RUN   TestGetCategory/ErrTimeout
=== RUN   TestGetCategory/ErrNotFound
=== RUN   TestGetCategory/unknown_error
--- PASS: TestGetCategory (0.00s)
    --- PASS: TestGetCategory/nil_error (0.00s)
    --- PASS: TestGetCategory/structured_retriable (0.00s)
    --- PASS: TestGetCategory/structured_transient (0.00s)
    --- PASS: TestGetCategory/structured_fatal (0.00s)
    --- PASS: TestGetCategory/structured_invalid_input (0.00s)
    --- PASS: TestGetCategory/ErrNotLeader (0.00s)
    --- PASS: TestGetCategory/ErrTimeout (0.00s)
    --- PASS: TestGetCategory/ErrNotFound (0.00s)
    --- PASS: TestGetCategory/unknown_error (0.00s)
=== RUN   TestIsRetriable
--- PASS: TestIsRetriable (0.00s)
=== RUN   TestIsTransient
--- PASS: TestIsTransient (0.00s)
=== RUN   TestIsFatal
--- PASS: TestIsFatal (0.00s)
=== RUN   TestIsInvalidInput
--- PASS: TestIsInvalidInput (0.00s)
=== RUN   TestWrap
=== RUN   TestWrap/nil_error
=== RUN   TestWrap/standard_error
=== RUN   TestWrap/already_wrapped
--- PASS: TestWrap (0.00s)
    --- PASS: TestWrap/nil_error (0.00s)
    --- PASS: TestWrap/standard_error (0.00s)
    --- PASS: TestWrap/already_wrapped (0.00s)
=== RUN   TestWrapf
--- PASS: TestWrapf (0.00s)
=== RUN   TestJoin
=== RUN   TestJoin/no_errors
=== RUN   TestJoin/single_error
=== RUN   TestJoin/multiple_errors
=== RUN   TestJoin/with_nil_errors
--- PASS: TestJoin (0.00s)
    --- PASS: TestJoin/no_errors (0.00s)
    --- PASS: TestJoin/single_error (0.00s)
    --- PASS: TestJoin/multiple_errors (0.00s)
    --- PASS: TestJoin/with_nil_errors (0.00s)
=== RUN   TestMultiError
--- PASS: TestMultiError (0.00s)
=== RUN   TestMultiError_Error
=== RUN   TestMultiError_Error/no_errors
=== RUN   TestMultiError_Error/single_error
=== RUN   TestMultiError_Error/multiple_errors
--- PASS: TestMultiError_Error (0.00s)
    --- PASS: TestMultiError_Error/no_errors (0.00s)
    --- PASS: TestMultiError_Error/single_error (0.00s)
    --- PASS: TestMultiError_Error/multiple_errors (0.00s)
=== RUN   TestMultiError_Unwrap
--- PASS: TestMultiError_Unwrap (0.00s)
=== RUN   TestCommonErrors
--- PASS: TestCommonErrors (0.00s)
=== RUN   TestError_ChainedOperations
--- PASS: TestError_ChainedOperations (0.00s)
=== RUN   TestError_NestedWrapping
--- PASS: TestError_NestedWrapping (0.00s)
=== RUN   TestError_ErrorsAs
--- PASS: TestError_ErrorsAs (0.00s)
=== RUN   TestClassifyStandardError
=== RUN   TestClassifyStandardError/timeout
=== RUN   TestClassifyStandardError/temporary_failure
=== RUN   TestClassifyStandardError/not_found
=== RUN   TestClassifyStandardError/already_exists
=== RUN   TestClassifyStandardError/not_leader
=== RUN   TestClassifyStandardError/no_leader
=== RUN   TestClassifyStandardError/unknown
--- PASS: TestClassifyStandardError (0.00s)
    --- PASS: TestClassifyStandardError/timeout (0.00s)
    --- PASS: TestClassifyStandardError/temporary_failure (0.00s)
    --- PASS: TestClassifyStandardError/not_found (0.00s)
    --- PASS: TestClassifyStandardError/already_exists (0.00s)
    --- PASS: TestClassifyStandardError/not_leader (0.00s)
    --- PASS: TestClassifyStandardError/no_leader (0.00s)
    --- PASS: TestClassifyStandardError/unknown (0.00s)
=== RUN   ExampleRetriable
--- PASS: ExampleRetriable (0.00s)
=== RUN   ExampleMultiError
--- PASS: ExampleMultiError (0.00s)
PASS
coverage: 97.5% of statements
ok  	github.com/gstreamio/streambus/pkg/errors	1.934s	coverage: 97.5% of statements
=== RUN   TestNewRaftNodeHealthChecker
--- PASS: TestNewRaftNodeHealthChecker (0.00s)
=== RUN   TestRaftNodeHealthChecker_Check_Leader
--- PASS: TestRaftNodeHealthChecker_Check_Leader (0.00s)
=== RUN   TestRaftNodeHealthChecker_Check_Follower
--- PASS: TestRaftNodeHealthChecker_Check_Follower (0.00s)
=== RUN   TestRaftNodeHealthChecker_Check_NoLeader
--- PASS: TestRaftNodeHealthChecker_Check_NoLeader (0.00s)
=== RUN   TestRaftNodeHealthChecker_Check_NilNode
--- PASS: TestRaftNodeHealthChecker_Check_NilNode (0.00s)
=== RUN   TestNewMetadataStoreHealthChecker
--- PASS: TestNewMetadataStoreHealthChecker (0.00s)
=== RUN   TestMetadataStoreHealthChecker_Check
--- PASS: TestMetadataStoreHealthChecker_Check (0.00s)
=== RUN   TestMetadataStoreHealthChecker_Check_NilStore
--- PASS: TestMetadataStoreHealthChecker_Check_NilStore (0.00s)
=== RUN   TestNewBrokerRegistryHealthChecker
--- PASS: TestNewBrokerRegistryHealthChecker (0.00s)
=== RUN   TestBrokerRegistryHealthChecker_Check_AllActive
--- PASS: TestBrokerRegistryHealthChecker_Check_AllActive (0.00s)
=== RUN   TestBrokerRegistryHealthChecker_Check_NoActiveBrokers
--- PASS: TestBrokerRegistryHealthChecker_Check_NoActiveBrokers (0.00s)
=== RUN   TestBrokerRegistryHealthChecker_Check_NoBrokers
--- PASS: TestBrokerRegistryHealthChecker_Check_NoBrokers (0.00s)
=== RUN   TestBrokerRegistryHealthChecker_Check_NilRegistry
--- PASS: TestBrokerRegistryHealthChecker_Check_NilRegistry (0.00s)
=== RUN   TestNewCoordinatorHealthChecker
--- PASS: TestNewCoordinatorHealthChecker (0.00s)
=== RUN   TestCoordinatorHealthChecker_Check_Healthy
--- PASS: TestCoordinatorHealthChecker_Check_Healthy (0.00s)
=== RUN   TestCoordinatorHealthChecker_Check_Rebalancing
--- PASS: TestCoordinatorHealthChecker_Check_Rebalancing (0.00s)
=== RUN   TestCoordinatorHealthChecker_Check_HighFailureRate
--- PASS: TestCoordinatorHealthChecker_Check_HighFailureRate (0.00s)
=== RUN   TestCoordinatorHealthChecker_Check_NilCoordinator
--- PASS: TestCoordinatorHealthChecker_Check_NilCoordinator (0.00s)
=== RUN   TestNewComponentHealthChecker
--- PASS: TestNewComponentHealthChecker (0.00s)
=== RUN   TestComponentHealthChecker_Check_AllHealthy
--- PASS: TestComponentHealthChecker_Check_AllHealthy (0.00s)
=== RUN   TestComponentHealthChecker_Check_OneDegraded
--- PASS: TestComponentHealthChecker_Check_OneDegraded (0.00s)
=== RUN   TestComponentHealthChecker_Check_OneUnhealthy
--- PASS: TestComponentHealthChecker_Check_OneUnhealthy (0.00s)
=== RUN   TestComponentHealthChecker_Check_NoCheckers
--- PASS: TestComponentHealthChecker_Check_NoCheckers (0.00s)
=== RUN   TestRegistry_RegisterAndCheckAll
--- PASS: TestRegistry_RegisterAndCheckAll (0.00s)
=== RUN   TestRegistry_CheckOne
--- PASS: TestRegistry_CheckOne (0.00s)
=== RUN   TestRegistry_CheckOne_NotFound
--- PASS: TestRegistry_CheckOne_NotFound (0.00s)
=== RUN   TestRegistry_Unregister
--- PASS: TestRegistry_Unregister (0.00s)
=== RUN   TestRegistry_AggregateStatus
=== RUN   TestRegistry_AggregateStatus/empty
=== RUN   TestRegistry_AggregateStatus/all_healthy
=== RUN   TestRegistry_AggregateStatus/one_degraded
=== RUN   TestRegistry_AggregateStatus/one_unhealthy
=== RUN   TestRegistry_AggregateStatus/unknown_status
--- PASS: TestRegistry_AggregateStatus (0.00s)
    --- PASS: TestRegistry_AggregateStatus/empty (0.00s)
    --- PASS: TestRegistry_AggregateStatus/all_healthy (0.00s)
    --- PASS: TestRegistry_AggregateStatus/one_degraded (0.00s)
    --- PASS: TestRegistry_AggregateStatus/one_unhealthy (0.00s)
    --- PASS: TestRegistry_AggregateStatus/unknown_status (0.00s)
=== RUN   TestRegistry_Timeout
--- PASS: TestRegistry_Timeout (0.10s)
=== RUN   TestLivenessCheck
--- PASS: TestLivenessCheck (0.00s)
=== RUN   TestRegistry_ReadinessCheck
--- PASS: TestRegistry_ReadinessCheck (0.00s)
=== RUN   TestSimpleChecker
--- PASS: TestSimpleChecker (0.00s)
=== RUN   TestPeriodicChecker
--- PASS: TestPeriodicChecker (0.15s)
=== RUN   TestPeriodicChecker_BeforeFirstRun
--- PASS: TestPeriodicChecker_BeforeFirstRun (0.00s)
=== RUN   TestHTTPHandler_Liveness
--- PASS: TestHTTPHandler_Liveness (0.00s)
=== RUN   TestHTTPHandler_Readiness
--- PASS: TestHTTPHandler_Readiness (0.00s)
=== RUN   TestHTTPHandler_Health
--- PASS: TestHTTPHandler_Health (0.00s)
=== RUN   TestHTTPHandler_MethodNotAllowed
--- PASS: TestHTTPHandler_MethodNotAllowed (0.00s)
=== RUN   TestHTTPHandler_StatusCodes
=== RUN   TestHTTPHandler_StatusCodes/healthy
=== RUN   TestHTTPHandler_StatusCodes/degraded
=== RUN   TestHTTPHandler_StatusCodes/unhealthy
=== RUN   TestHTTPHandler_StatusCodes/unknown
--- PASS: TestHTTPHandler_StatusCodes (0.00s)
    --- PASS: TestHTTPHandler_StatusCodes/healthy (0.00s)
    --- PASS: TestHTTPHandler_StatusCodes/degraded (0.00s)
    --- PASS: TestHTTPHandler_StatusCodes/unhealthy (0.00s)
    --- PASS: TestHTTPHandler_StatusCodes/unknown (0.00s)
=== RUN   TestStatus_String
--- PASS: TestStatus_String (0.00s)
=== RUN   TestResponse_JSON
--- PASS: TestResponse_JSON (0.00s)
PASS
coverage: 91.4% of statements
ok  	github.com/gstreamio/streambus/pkg/health	2.470s	coverage: 91.4% of statements
=== RUN   TestInit
=== RUN   TestInit/Initialize_with_DEBUG_level
=== RUN   TestInit/Initialize_with_INFO_level
=== RUN   TestInit/Initialize_with_WARN_level
=== RUN   TestInit/Initialize_with_ERROR_level
--- PASS: TestInit (0.00s)
    --- PASS: TestInit/Initialize_with_DEBUG_level (0.00s)
    --- PASS: TestInit/Initialize_with_INFO_level (0.00s)
    --- PASS: TestInit/Initialize_with_WARN_level (0.00s)
    --- PASS: TestInit/Initialize_with_ERROR_level (0.00s)
=== RUN   TestInitFromEnv
=== RUN   TestInitFromEnv/Parse_DEBUG_from_env
=== RUN   TestInitFromEnv/Parse_INFO_from_env
=== RUN   TestInitFromEnv/Parse_WARN_from_env
=== RUN   TestInitFromEnv/Parse_ERROR_from_env
=== RUN   TestInitFromEnv/Default_to_INFO_for_invalid_value
=== RUN   TestInitFromEnv/Default_to_INFO_for_empty_value
--- PASS: TestInitFromEnv (0.00s)
    --- PASS: TestInitFromEnv/Parse_DEBUG_from_env (0.00s)
    --- PASS: TestInitFromEnv/Parse_INFO_from_env (0.00s)
    --- PASS: TestInitFromEnv/Parse_WARN_from_env (0.00s)
    --- PASS: TestInitFromEnv/Parse_ERROR_from_env (0.00s)
    --- PASS: TestInitFromEnv/Default_to_INFO_for_invalid_value (0.00s)
    --- PASS: TestInitFromEnv/Default_to_INFO_for_empty_value (0.00s)
=== RUN   TestParseLogLevel
=== RUN   TestParseLogLevel/Parse_DEBUG
=== RUN   TestParseLogLevel/Parse_INFO
=== RUN   TestParseLogLevel/Parse_WARN
=== RUN   TestParseLogLevel/Parse_ERROR
=== RUN   TestParseLogLevel/Parse_FATAL
=== RUN   TestParseLogLevel/Default_to_INFO_for_invalid
--- PASS: TestParseLogLevel (0.00s)
    --- PASS: TestParseLogLevel/Parse_DEBUG (0.00s)
    --- PASS: TestParseLogLevel/Parse_INFO (0.00s)
    --- PASS: TestParseLogLevel/Parse_WARN (0.00s)
    --- PASS: TestParseLogLevel/Parse_ERROR (0.00s)
    --- PASS: TestParseLogLevel/Parse_FATAL (0.00s)
    --- PASS: TestParseLogLevel/Default_to_INFO_for_invalid (0.00s)
=== RUN   TestLoggingFunctions
=== RUN   TestLoggingFunctions/Debug_logging
=== RUN   TestLoggingFunctions/Info_logging
=== RUN   TestLoggingFunctions/Warn_logging
=== RUN   TestLoggingFunctions/Error_logging
--- PASS: TestLoggingFunctions (0.00s)
    --- PASS: TestLoggingFunctions/Debug_logging (0.00s)
    --- PASS: TestLoggingFunctions/Info_logging (0.00s)
    --- PASS: TestLoggingFunctions/Warn_logging (0.00s)
    --- PASS: TestLoggingFunctions/Error_logging (0.00s)
=== RUN   TestWithFields
--- PASS: TestWithFields (0.00s)
=== RUN   TestSync
    logger_test.go:266: Sync() returned error (may be expected): sync /dev/stderr: bad file descriptor
--- PASS: TestSync (0.00s)
=== RUN   TestLoggerBeforeInit
{"level":"info","ts":1763839383.364696,"msg":"test"}
{"level":"warn","ts":1763839383.364733,"msg":"test"}
{"level":"error","ts":1763839383.364745,"msg":"test"}
--- PASS: TestLoggerBeforeInit (0.00s)
=== RUN   TestConcurrentLogging
{"level":"info","ts":1763839383.3651211,"msg":"concurrent log","goroutine":0}
{"level":"info","ts":1763839383.36512,"msg":"concurrent log","goroutine":2}
{"level":"info","ts":1763839383.365223,"msg":"concurrent log","goroutine":7}
{"level":"info","ts":1763839383.365238,"msg":"concurrent log","goroutine":8}
{"level":"info","ts":1763839383.3651252,"msg":"concurrent log","goroutine":5}
{"level":"info","ts":1763839383.3652291,"msg":"concurrent log","goroutine":6}
{"level":"info","ts":1763839383.365226,"msg":"concurrent log","goroutine":4}
{"level":"info","ts":1763839383.365108,"msg":"concurrent log","goroutine":1}
{"level":"info","ts":1763839383.365281,"msg":"concurrent log","goroutine":9}
{"level":"info","ts":1763839383.3652968,"msg":"concurrent log","goroutine":3}
--- PASS: TestConcurrentLogging (0.00s)
=== RUN   TestLogLevelEnvironmentVariable
=== RUN   TestLogLevelEnvironmentVariable/Uppercase_DEBUG
=== RUN   TestLogLevelEnvironmentVariable/Lowercase_debug
=== RUN   TestLogLevelEnvironmentVariable/Mixed_case_Debug
=== RUN   TestLogLevelEnvironmentVariable/Uppercase_INFO
=== RUN   TestLogLevelEnvironmentVariable/Uppercase_WARN
=== RUN   TestLogLevelEnvironmentVariable/Uppercase_ERROR
--- PASS: TestLogLevelEnvironmentVariable (0.00s)
    --- PASS: TestLogLevelEnvironmentVariable/Uppercase_DEBUG (0.00s)
    --- PASS: TestLogLevelEnvironmentVariable/Lowercase_debug (0.00s)
    --- PASS: TestLogLevelEnvironmentVariable/Mixed_case_Debug (0.00s)
    --- PASS: TestLogLevelEnvironmentVariable/Uppercase_INFO (0.00s)
    --- PASS: TestLogLevelEnvironmentVariable/Uppercase_WARN (0.00s)
    --- PASS: TestLogLevelEnvironmentVariable/Uppercase_ERROR (0.00s)
=== RUN   TestLogger
--- PASS: TestLogger (0.00s)
=== RUN   TestSugar
--- PASS: TestSugar (0.00s)
PASS
coverage: 86.1% of statements
ok  	github.com/gstreamio/streambus/pkg/logger	2.064s	coverage: 86.1% of statements
=== RUN   TestLevel_String
=== RUN   TestLevel_String/DEBUG
=== RUN   TestLevel_String/INFO
=== RUN   TestLevel_String/WARN
=== RUN   TestLevel_String/ERROR
=== RUN   TestLevel_String/FATAL
=== RUN   TestLevel_String/UNKNOWN
--- PASS: TestLevel_String (0.00s)
    --- PASS: TestLevel_String/DEBUG (0.00s)
    --- PASS: TestLevel_String/INFO (0.00s)
    --- PASS: TestLevel_String/WARN (0.00s)
    --- PASS: TestLevel_String/ERROR (0.00s)
    --- PASS: TestLevel_String/FATAL (0.00s)
    --- PASS: TestLevel_String/UNKNOWN (0.00s)
=== RUN   TestParseLevel
=== RUN   TestParseLevel/DEBUG
=== RUN   TestParseLevel/debug
=== RUN   TestParseLevel/INFO
=== RUN   TestParseLevel/info
=== RUN   TestParseLevel/WARN
=== RUN   TestParseLevel/WARNING
=== RUN   TestParseLevel/warn
=== RUN   TestParseLevel/ERROR
=== RUN   TestParseLevel/error
=== RUN   TestParseLevel/FATAL
=== RUN   TestParseLevel/fatal
=== RUN   TestParseLevel/INVALID
--- PASS: TestParseLevel (0.00s)
    --- PASS: TestParseLevel/DEBUG (0.00s)
    --- PASS: TestParseLevel/debug (0.00s)
    --- PASS: TestParseLevel/INFO (0.00s)
    --- PASS: TestParseLevel/info (0.00s)
    --- PASS: TestParseLevel/WARN (0.00s)
    --- PASS: TestParseLevel/WARNING (0.00s)
    --- PASS: TestParseLevel/warn (0.00s)
    --- PASS: TestParseLevel/ERROR (0.00s)
    --- PASS: TestParseLevel/error (0.00s)
    --- PASS: TestParseLevel/FATAL (0.00s)
    --- PASS: TestParseLevel/fatal (0.00s)
    --- PASS: TestParseLevel/INVALID (0.00s)
=== RUN   TestDefaultConfig
--- PASS: TestDefaultConfig (0.00s)
=== RUN   TestNew
--- PASS: TestNew (0.00s)
=== RUN   TestNew_NilConfig
--- PASS: TestNew_NilConfig (0.00s)
=== RUN   TestLogger_SetLevel
--- PASS: TestLogger_SetLevel (0.00s)
=== RUN   TestLogger_WithComponent
--- PASS: TestLogger_WithComponent (0.00s)
=== RUN   TestLogger_WithFields
--- PASS: TestLogger_WithFields (0.00s)
=== RUN   TestLogger_Debug
--- PASS: TestLogger_Debug (0.00s)
=== RUN   TestLogger_Info
--- PASS: TestLogger_Info (0.00s)
=== RUN   TestLogger_Warn
--- PASS: TestLogger_Warn (0.00s)
=== RUN   TestLogger_Error
--- PASS: TestLogger_Error (0.00s)
=== RUN   TestLogger_ErrorWithStackTrace
--- PASS: TestLogger_ErrorWithStackTrace (0.00s)
=== RUN   TestLogger_WithOperation
--- PASS: TestLogger_WithOperation (0.00s)
=== RUN   TestLogger_ComponentField
--- PASS: TestLogger_ComponentField (0.00s)
=== RUN   TestLogger_LevelFiltering
--- PASS: TestLogger_LevelFiltering (0.00s)
=== RUN   TestLogger_MultipleFields
--- PASS: TestLogger_MultipleFields (0.00s)
=== RUN   TestLogger_DefaultFieldsInherited
--- PASS: TestLogger_DefaultFieldsInherited (0.00s)
=== RUN   TestLogger_FileAndLine
--- PASS: TestLogger_FileAndLine (0.00s)
=== RUN   TestLogger_NoFileAndLine
--- PASS: TestLogger_NoFileAndLine (0.00s)
=== RUN   TestDefaultLogger
--- PASS: TestDefaultLogger (0.00s)
=== RUN   TestGlobalFunctions
--- PASS: TestGlobalFunctions (0.00s)
=== RUN   TestLogger_JSONFormatting
--- PASS: TestLogger_JSONFormatting (0.00s)
=== RUN   TestLogger_ErrorOperationMethods
--- PASS: TestLogger_ErrorOperationMethods (0.00s)
PASS
coverage: 92.9% of statements
ok  	github.com/gstreamio/streambus/pkg/logging	2.407s	coverage: 92.9% of statements
=== RUN   TestClusterMetadataStore_StoreBrokerMetadata_NewBroker
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.890492 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
--- PASS: TestClusterMetadataStore_StoreBrokerMetadata_NewBroker (0.00s)
=== RUN   TestClusterMetadataStore_StoreBrokerMetadata_UpdateExisting
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.890929 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=update_broker, timestamp=2025-11-22 14:23:03.891141 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=update_broker, new version=2
--- PASS: TestClusterMetadataStore_StoreBrokerMetadata_UpdateExisting (0.00s)
=== RUN   TestClusterMetadataStore_GetBrokerMetadata_NotFound
--- PASS: TestClusterMetadataStore_GetBrokerMetadata_NotFound (0.00s)
=== RUN   TestClusterMetadataStore_ListBrokers
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.891416 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.891565 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=2
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.891714 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=3
--- PASS: TestClusterMetadataStore_ListBrokers (0.00s)
=== RUN   TestClusterMetadataStore_DeleteBroker
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.891914 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=unregister_broker, timestamp=2025-11-22 14:23:03.89205 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=unregister_broker, new version=2
--- PASS: TestClusterMetadataStore_DeleteBroker (0.00s)
=== RUN   TestClusterMetadataStore_StatusConversion
=== RUN   TestClusterMetadataStore_StatusConversion/new_broker_always_alive
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.892198 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
=== RUN   TestClusterMetadataStore_StatusConversion/update_to_failed
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.892392 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=2
2025/11/22 14:23:03 [FSM] Applying operation: type=update_broker, timestamp=2025-11-22 14:23:03.892542 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=update_broker, new version=3
2025/11/22 14:23:03 [FSM] Applying operation: type=unregister_broker, timestamp=2025-11-22 14:23:03.892655 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=unregister_broker, new version=4
=== RUN   TestClusterMetadataStore_StatusConversion/update_to_draining
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.892778 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=5
2025/11/22 14:23:03 [FSM] Applying operation: type=update_broker, timestamp=2025-11-22 14:23:03.892912 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=update_broker, new version=6
2025/11/22 14:23:03 [FSM] Applying operation: type=unregister_broker, timestamp=2025-11-22 14:23:03.893021 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=unregister_broker, new version=7
--- PASS: TestClusterMetadataStore_StatusConversion (0.00s)
    --- PASS: TestClusterMetadataStore_StatusConversion/new_broker_always_alive (0.00s)
    --- PASS: TestClusterMetadataStore_StatusConversion/update_to_failed (0.00s)
    --- PASS: TestClusterMetadataStore_StatusConversion/update_to_draining (0.00s)
=== RUN   TestClusterMetadataStore_StorePartitionAssignment
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.893176 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.893336 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=2
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.893471 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=3
2025/11/22 14:23:03 [FSM] Applying operation: type=batch_create_partitions, timestamp=2025-11-22 14:23:03.893672 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=batch_create_partitions, new version=4
--- PASS: TestClusterMetadataStore_StorePartitionAssignment (0.00s)
=== RUN   TestClusterMetadataStore_GetPartitionAssignment
2025/11/22 14:23:03 [FSM] Applying operation: type=batch_create_partitions, timestamp=2025-11-22 14:23:03.893968 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=batch_create_partitions, new version=1
--- PASS: TestClusterMetadataStore_GetPartitionAssignment (0.00s)
=== RUN   TestClusterMetadataStore_ParsePartitionKey
=== RUN   TestClusterMetadataStore_ParsePartitionKey/test-topic:0
=== RUN   TestClusterMetadataStore_ParsePartitionKey/test-topic:5
=== RUN   TestClusterMetadataStore_ParsePartitionKey/my-topic:123
=== RUN   TestClusterMetadataStore_ParsePartitionKey/topic-with-dashes:42
--- PASS: TestClusterMetadataStore_ParsePartitionKey (0.00s)
    --- PASS: TestClusterMetadataStore_ParsePartitionKey/test-topic:0 (0.00s)
    --- PASS: TestClusterMetadataStore_ParsePartitionKey/test-topic:5 (0.00s)
    --- PASS: TestClusterMetadataStore_ParsePartitionKey/my-topic:123 (0.00s)
    --- PASS: TestClusterMetadataStore_ParsePartitionKey/topic-with-dashes:42 (0.00s)
=== RUN   TestClusterMetadataStore_ParseAddress
=== RUN   TestClusterMetadataStore_ParseAddress/localhost:9092
=== RUN   TestClusterMetadataStore_ParseAddress/192.168.1.1:8080
=== RUN   TestClusterMetadataStore_ParseAddress/broker1.example.com:19092
=== RUN   TestClusterMetadataStore_ParseAddress/invalid
=== RUN   TestClusterMetadataStore_ParseAddress/host:abc
--- PASS: TestClusterMetadataStore_ParseAddress (0.00s)
    --- PASS: TestClusterMetadataStore_ParseAddress/localhost:9092 (0.00s)
    --- PASS: TestClusterMetadataStore_ParseAddress/192.168.1.1:8080 (0.00s)
    --- PASS: TestClusterMetadataStore_ParseAddress/broker1.example.com:19092 (0.00s)
    --- PASS: TestClusterMetadataStore_ParseAddress/invalid (0.00s)
    --- PASS: TestClusterMetadataStore_ParseAddress/host:abc (0.00s)
=== RUN   TestClusterMetadataStore_TypeConversions
--- PASS: TestClusterMetadataStore_TypeConversions (0.00s)
=== RUN   TestClusterMetadataStore_BrokerResourceTracking
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.894672 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
--- PASS: TestClusterMetadataStore_BrokerResourceTracking (0.00s)
=== RUN   TestClusterMetadataStore_BrokerTimestampHandling
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.894856 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
--- PASS: TestClusterMetadataStore_BrokerTimestampHandling (0.00s)
=== RUN   TestClusterMetadataStore_EmptyAssignment
--- PASS: TestClusterMetadataStore_EmptyAssignment (0.00s)
=== RUN   TestClusterMetadataStore_ConcurrentOperations
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895114 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895159 -0500 EST
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895199 -0500 EST
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895255 -0500 EST
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895271 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=2
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895308 -0500 EST
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895344 -0500 EST
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895425 -0500 EST
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895437 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=3
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.895495 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=4
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=5
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=6
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=7
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=8
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=9
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=10
--- PASS: TestClusterMetadataStore_ConcurrentOperations (0.00s)
=== RUN   TestNewFSM
--- PASS: TestNewFSM (0.00s)
=== RUN   TestFSM_RegisterBroker
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.896574 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
--- PASS: TestFSM_RegisterBroker (0.00s)
=== RUN   TestFSM_RegisterBrokerDuplicate
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.896882 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.896882 -0500 EST
2025/11/22 14:23:03 [FSM] Operation failed: type=register_broker, error=broker 1 already exists
--- PASS: TestFSM_RegisterBrokerDuplicate (0.00s)
=== RUN   TestFSM_UnregisterBroker
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.897311 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=unregister_broker, timestamp=2025-11-22 14:23:03.897496 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=unregister_broker, new version=2
--- PASS: TestFSM_UnregisterBroker (0.00s)
=== RUN   TestFSM_CreateTopic
2025/11/22 14:23:03 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:03.897755 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_topic, new version=1
--- PASS: TestFSM_CreateTopic (0.00s)
=== RUN   TestFSM_DeleteTopic
2025/11/22 14:23:03 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:03.898051 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_topic, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=create_partition, timestamp=2025-11-22 14:23:03.898278 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_partition, new version=2
2025/11/22 14:23:03 [FSM] Applying operation: type=create_partition, timestamp=2025-11-22 14:23:03.898474 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_partition, new version=3
2025/11/22 14:23:03 [FSM] Applying operation: type=create_partition, timestamp=2025-11-22 14:23:03.898655 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_partition, new version=4
2025/11/22 14:23:03 [FSM] Applying operation: type=delete_topic, timestamp=2025-11-22 14:23:03.89883 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=delete_topic, new version=5
--- PASS: TestFSM_DeleteTopic (0.00s)
=== RUN   TestFSM_CreatePartition
2025/11/22 14:23:03 [FSM] Applying operation: type=create_partition, timestamp=2025-11-22 14:23:03.899004 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_partition, new version=1
--- PASS: TestFSM_CreatePartition (0.00s)
=== RUN   TestFSM_UpdateLeader
2025/11/22 14:23:03 [FSM] Applying operation: type=create_partition, timestamp=2025-11-22 14:23:03.899283 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_partition, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=update_leader, timestamp=2025-11-22 14:23:03.899491 -0500 EST
2025/11/22 14:23:03 [FSM] Applied UpdateLeader operation, error=<nil>
2025/11/22 14:23:03 [FSM] Operation succeeded: type=update_leader, new version=2
--- PASS: TestFSM_UpdateLeader (0.00s)
=== RUN   TestFSM_UpdateISR
2025/11/22 14:23:03 [FSM] Applying operation: type=create_partition, timestamp=2025-11-22 14:23:03.89971 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_partition, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=update_isr, timestamp=2025-11-22 14:23:03.899904 -0500 EST
2025/11/22 14:23:03 [FSM] Applied UpdateISR operation, error=<nil>
2025/11/22 14:23:03 [FSM] Operation succeeded: type=update_isr, new version=2
--- PASS: TestFSM_UpdateISR (0.00s)
=== RUN   TestFSM_Snapshot
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.900117 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:03.900309 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_topic, new version=2
--- PASS: TestFSM_Snapshot (0.00s)
=== RUN   TestFSM_ListOperations
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.900979 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=1
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.90118 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=2
2025/11/22 14:23:03 [FSM] Applying operation: type=register_broker, timestamp=2025-11-22 14:23:03.901373 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=register_broker, new version=3
2025/11/22 14:23:03 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:03.901554 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_topic, new version=4
2025/11/22 14:23:03 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:03.901706 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_topic, new version=5
2025/11/22 14:23:03 [FSM] Applying operation: type=create_topic, timestamp=2025-11-22 14:23:03.901859 -0500 EST
2025/11/22 14:23:03 [FSM] Operation succeeded: type=create_topic, new version=6
--- PASS: TestFSM_ListOperations (0.00s)
=== RUN   TestPartitionID
=== RUN   TestPartitionID/test-topic:0
=== RUN   TestPartitionID/test-topic:1
=== RUN   TestPartitionID/events:42
--- PASS: TestPartitionID (0.00s)
    --- PASS: TestPartitionID/test-topic:0 (0.00s)
    --- PASS: TestPartitionID/test-topic:1 (0.00s)
    --- PASS: TestPartitionID/events:42 (0.00s)
=== RUN   TestBrokerInfo_IsAlive
--- PASS: TestBrokerInfo_IsAlive (0.00s)
=== RUN   TestPartitionInfo_IsLeader
--- PASS: TestPartitionInfo_IsLeader (0.00s)
=== RUN   TestPartitionInfo_IsInISR
--- PASS: TestPartitionInfo_IsInISR (0.00s)
=== RUN   TestMetadataReplication
    integration_test.go:158: skipping integration test in short mode
--- SKIP: TestMetadataReplication (0.00s)
=== RUN   TestMetadataSnapshot
    integration_test.go:496: skipping integration test in short mode
--- SKIP: TestMetadataSnapshot (0.00s)
PASS
coverage: 71.0% of statements
ok  	github.com/gstreamio/streambus/pkg/metadata	2.475s	coverage: 71.0% of statements
=== RUN   TestMetricType_String
=== RUN   TestMetricType_String/counter
=== RUN   TestMetricType_String/gauge
=== RUN   TestMetricType_String/histogram
=== RUN   TestMetricType_String/summary
=== RUN   TestMetricType_String/unknown
--- PASS: TestMetricType_String (0.00s)
    --- PASS: TestMetricType_String/counter (0.00s)
    --- PASS: TestMetricType_String/gauge (0.00s)
    --- PASS: TestMetricType_String/histogram (0.00s)
    --- PASS: TestMetricType_String/summary (0.00s)
    --- PASS: TestMetricType_String/unknown (0.00s)
=== RUN   TestCounter
--- PASS: TestCounter (0.00s)
=== RUN   TestCounter_WithLabels
--- PASS: TestCounter_WithLabels (0.00s)
=== RUN   TestCounter_Concurrent
--- PASS: TestCounter_Concurrent (0.01s)
=== RUN   TestGauge
--- PASS: TestGauge (0.00s)
=== RUN   TestGauge_NegativeValues
--- PASS: TestGauge_NegativeValues (0.00s)
=== RUN   TestHistogram
--- PASS: TestHistogram (0.00s)
=== RUN   TestHistogram_DefaultBuckets
--- PASS: TestHistogram_DefaultBuckets (0.00s)
=== RUN   TestHistogram_ObserveDuration
--- PASS: TestHistogram_ObserveDuration (0.00s)
=== RUN   TestHistogram_Reset
--- PASS: TestHistogram_Reset (0.00s)
=== RUN   TestRegistry_Register
--- PASS: TestRegistry_Register (0.00s)
=== RUN   TestRegistry_Get
--- PASS: TestRegistry_Get (0.00s)
=== RUN   TestRegistry_Unregister
--- PASS: TestRegistry_Unregister (0.00s)
=== RUN   TestRegistry_GetOrCreate
--- PASS: TestRegistry_GetOrCreate (0.00s)
=== RUN   TestRegistry_All
--- PASS: TestRegistry_All (0.00s)
=== RUN   TestRegistry_Reset
--- PASS: TestRegistry_Reset (0.00s)
=== RUN   TestRegistry_Clear
--- PASS: TestRegistry_Clear (0.00s)
=== RUN   TestMetricKey
=== RUN   TestMetricKey/no_labels
=== RUN   TestMetricKey/single_label
=== RUN   TestMetricKey/multiple_labels
--- PASS: TestMetricKey (0.00s)
    --- PASS: TestMetricKey/no_labels (0.00s)
    --- PASS: TestMetricKey/single_label (0.00s)
    --- PASS: TestMetricKey/multiple_labels (0.00s)
=== RUN   TestDefaultRegistry
--- PASS: TestDefaultRegistry (0.00s)
=== RUN   TestHTTPHandler_Counter
--- PASS: TestHTTPHandler_Counter (0.00s)
=== RUN   TestHTTPHandler_Gauge
--- PASS: TestHTTPHandler_Gauge (0.00s)
=== RUN   TestHTTPHandler_Histogram
--- PASS: TestHTTPHandler_Histogram (0.00s)
=== RUN   TestHTTPHandler_MethodNotAllowed
--- PASS: TestHTTPHandler_MethodNotAllowed (0.00s)
=== RUN   TestFormatLabels
=== RUN   TestFormatLabels/no_labels
=== RUN   TestFormatLabels/single_label
=== RUN   TestFormatLabels/multiple_labels_sorted
=== RUN   TestFormatLabels/label_with_special_characters
--- PASS: TestFormatLabels (0.00s)
    --- PASS: TestFormatLabels/no_labels (0.00s)
    --- PASS: TestFormatLabels/single_label (0.00s)
    --- PASS: TestFormatLabels/multiple_labels_sorted (0.00s)
    --- PASS: TestFormatLabels/label_with_special_characters (0.00s)
=== RUN   TestEscapeString
=== RUN   TestEscapeString/simple
=== RUN   TestEscapeString/with\backslash
=== RUN   TestEscapeString/with"quote
=== RUN   TestEscapeString/with_newline
=== RUN   TestEscapeString/all\three"types_
--- PASS: TestEscapeString (0.00s)
    --- PASS: TestEscapeString/simple (0.00s)
    --- PASS: TestEscapeString/with\backslash (0.00s)
    --- PASS: TestEscapeString/with"quote (0.00s)
    --- PASS: TestEscapeString/with_newline (0.00s)
    --- PASS: TestEscapeString/all\three"types_ (0.00s)
=== RUN   TestPrometheusExporter_Export
--- PASS: TestPrometheusExporter_Export (0.00s)
=== RUN   TestPrometheusExporter_ExportWithLabels
--- PASS: TestPrometheusExporter_ExportWithLabels (0.00s)
=== RUN   TestPrometheusExporter_SanitizeMetricName
--- PASS: TestPrometheusExporter_SanitizeMetricName (0.00s)
=== RUN   TestPrometheusExporter_EmptyRegistry
--- PASS: TestPrometheusExporter_EmptyRegistry (0.00s)
=== RUN   TestPrometheusExporter_HistogramBuckets
--- PASS: TestPrometheusExporter_HistogramBuckets (0.00s)
=== RUN   TestStreamBusMetrics_Creation
--- PASS: TestStreamBusMetrics_Creation (0.00s)
=== RUN   TestStreamBusMetrics_Usage
--- PASS: TestStreamBusMetrics_Usage (0.00s)
=== RUN   TestStreamBusMetrics_BrokerUptime
--- PASS: TestStreamBusMetrics_BrokerUptime (0.01s)
=== RUN   TestStreamBusMetrics_TransactionMetrics
--- PASS: TestStreamBusMetrics_TransactionMetrics (0.00s)
=== RUN   TestStreamBusMetrics_StorageMetrics
--- PASS: TestStreamBusMetrics_StorageMetrics (0.00s)
=== RUN   TestStreamBusMetrics_ConsumerGroupMetrics
--- PASS: TestStreamBusMetrics_ConsumerGroupMetrics (0.00s)
=== RUN   TestStreamBusMetrics_SecurityMetrics
--- PASS: TestStreamBusMetrics_SecurityMetrics (0.00s)
=== RUN   TestStreamBusMetrics_ClusterMetrics
--- PASS: TestStreamBusMetrics_ClusterMetrics (0.00s)
=== RUN   TestStreamBusMetrics_SchemaMetrics
--- PASS: TestStreamBusMetrics_SchemaMetrics (0.00s)
=== RUN   ExampleCounter
--- PASS: ExampleCounter (0.00s)
=== RUN   ExampleGauge
--- PASS: ExampleGauge (0.00s)
=== RUN   ExampleHistogram
--- PASS: ExampleHistogram (0.00s)
=== RUN   ExampleRegistry
--- PASS: ExampleRegistry (0.00s)
PASS
coverage: 94.7% of statements
ok  	github.com/gstreamio/streambus/pkg/metrics	2.657s	coverage: 94.7% of statements
=== RUN   TestNew
=== RUN   TestNew/default_listen_addr
=== RUN   TestNew/custom_listen_addr
--- PASS: TestNew (0.00s)
    --- PASS: TestNew/default_listen_addr (0.00s)
    --- PASS: TestNew/custom_listen_addr (0.00s)
=== RUN   TestProfiler_StartStop
Profiling server started on :16060
--- PASS: TestProfiler_StartStop (0.11s)
=== RUN   TestProfiler_DisabledDoesNotStart
--- PASS: TestProfiler_DisabledDoesNotStart (0.00s)
=== RUN   TestGetMemStats
--- PASS: TestGetMemStats (0.00s)
=== RUN   TestGetGoroutineCount
--- PASS: TestGetGoroutineCount (0.00s)
=== RUN   TestTriggerGC
--- PASS: TestTriggerGC (0.00s)
=== RUN   TestFreeOSMemory
--- PASS: TestFreeOSMemory (0.00s)
=== RUN   TestProfiler_StatsEndpoint
Profiling server started on :16062
--- PASS: TestProfiler_StatsEndpoint (0.10s)
=== RUN   TestProfiler_GCEndpoint
Profiling server started on :16063
--- PASS: TestProfiler_GCEndpoint (0.10s)
=== RUN   TestProfiler_ProfilingRates
--- PASS: TestProfiler_ProfilingRates (0.00s)
PASS
coverage: 91.3% of statements
ok  	github.com/gstreamio/streambus/pkg/profiling	3.100s	coverage: 91.3% of statements
=== RUN   TestBufferPool_GetPut
--- PASS: TestBufferPool_GetPut (0.00s)
=== RUN   TestBufferPool_GetExact
--- PASS: TestBufferPool_GetExact (0.00s)
=== RUN   TestZeroCopySlice
--- PASS: TestZeroCopySlice (0.00s)
=== RUN   TestSharedBufferWrapper
--- PASS: TestSharedBufferWrapper (0.00s)
=== RUN   TestMessageBuffer
--- PASS: TestMessageBuffer (0.00s)
=== RUN   TestMessageBuffer_Growth
--- PASS: TestMessageBuffer_Growth (0.00s)
=== RUN   TestWithBuffer
--- PASS: TestWithBuffer (0.00s)
=== RUN   TestCodec_ProduceRequest
--- PASS: TestCodec_ProduceRequest (0.00s)
=== RUN   TestCodec_FetchRequest
--- PASS: TestCodec_FetchRequest (0.00s)
=== RUN   TestCodec_GetOffsetRequest
--- PASS: TestCodec_GetOffsetRequest (0.00s)
=== RUN   TestCodec_CreateTopicRequest
--- PASS: TestCodec_CreateTopicRequest (0.00s)
=== RUN   TestCodec_DeleteTopicRequest
--- PASS: TestCodec_DeleteTopicRequest (0.00s)
=== RUN   TestCodec_ListTopicsRequest
--- PASS: TestCodec_ListTopicsRequest (0.00s)
=== RUN   TestCodec_HealthCheckRequest
--- PASS: TestCodec_HealthCheckRequest (0.00s)
=== RUN   TestCodec_ErrorResponse
--- PASS: TestCodec_ErrorResponse (0.00s)
=== RUN   TestCodec_ChecksumMismatch
--- PASS: TestCodec_ChecksumMismatch (0.00s)
=== RUN   TestCodec_MessageTooLarge
--- PASS: TestCodec_MessageTooLarge (0.00s)
=== RUN   TestCodec_EmptyMessage
--- PASS: TestCodec_EmptyMessage (0.00s)
=== RUN   TestCodec_MessageWithHeaders
--- PASS: TestCodec_MessageWithHeaders (0.00s)
=== RUN   TestCodec_ProduceResponse
--- PASS: TestCodec_ProduceResponse (0.00s)
=== RUN   TestCodec_FetchResponse
--- PASS: TestCodec_FetchResponse (0.00s)
=== RUN   TestCodec_GetOffsetResponse
--- PASS: TestCodec_GetOffsetResponse (0.00s)
=== RUN   TestCodec_CreateTopicResponse
--- PASS: TestCodec_CreateTopicResponse (0.00s)
=== RUN   TestCodec_DeleteTopicResponse
--- PASS: TestCodec_DeleteTopicResponse (0.00s)
=== RUN   TestCodec_ListTopicsResponse
--- PASS: TestCodec_ListTopicsResponse (0.00s)
=== RUN   TestCodec_HealthCheckResponse
--- PASS: TestCodec_HealthCheckResponse (0.00s)
=== RUN   TestRequestType_String
=== RUN   TestRequestType_String/Produce
=== RUN   TestRequestType_String/Fetch
=== RUN   TestRequestType_String/GetOffset
=== RUN   TestRequestType_String/CreateTopic
=== RUN   TestRequestType_String/DeleteTopic
=== RUN   TestRequestType_String/ListTopics
=== RUN   TestRequestType_String/HealthCheck
=== RUN   TestRequestType_String/JoinGroup
=== RUN   TestRequestType_String/SyncGroup
=== RUN   TestRequestType_String/Heartbeat
=== RUN   TestRequestType_String/LeaveGroup
=== RUN   TestRequestType_String/OffsetCommit
=== RUN   TestRequestType_String/OffsetFetch
=== RUN   TestRequestType_String/InitProducerID
=== RUN   TestRequestType_String/AddPartitionsToTxn
=== RUN   TestRequestType_String/AddOffsetsToTxn
=== RUN   TestRequestType_String/EndTxn
=== RUN   TestRequestType_String/TxnOffsetCommit
=== RUN   TestRequestType_String/Unknown
--- PASS: TestRequestType_String (0.00s)
    --- PASS: TestRequestType_String/Produce (0.00s)
    --- PASS: TestRequestType_String/Fetch (0.00s)
    --- PASS: TestRequestType_String/GetOffset (0.00s)
    --- PASS: TestRequestType_String/CreateTopic (0.00s)
    --- PASS: TestRequestType_String/DeleteTopic (0.00s)
    --- PASS: TestRequestType_String/ListTopics (0.00s)
    --- PASS: TestRequestType_String/HealthCheck (0.00s)
    --- PASS: TestRequestType_String/JoinGroup (0.00s)
    --- PASS: TestRequestType_String/SyncGroup (0.00s)
    --- PASS: TestRequestType_String/Heartbeat (0.00s)
    --- PASS: TestRequestType_String/LeaveGroup (0.00s)
    --- PASS: TestRequestType_String/OffsetCommit (0.00s)
    --- PASS: TestRequestType_String/OffsetFetch (0.00s)
    --- PASS: TestRequestType_String/InitProducerID (0.00s)
    --- PASS: TestRequestType_String/AddPartitionsToTxn (0.00s)
    --- PASS: TestRequestType_String/AddOffsetsToTxn (0.00s)
    --- PASS: TestRequestType_String/EndTxn (0.00s)
    --- PASS: TestRequestType_String/TxnOffsetCommit (0.00s)
    --- PASS: TestRequestType_String/Unknown (0.00s)
=== RUN   TestStatusCode_String
=== RUN   TestStatusCode_String/OK
=== RUN   TestStatusCode_String/Error
=== RUN   TestStatusCode_String/PartialSuccess
=== RUN   TestStatusCode_String/Unknown
--- PASS: TestStatusCode_String (0.00s)
    --- PASS: TestStatusCode_String/OK (0.00s)
    --- PASS: TestStatusCode_String/Error (0.00s)
    --- PASS: TestStatusCode_String/PartialSuccess (0.00s)
    --- PASS: TestStatusCode_String/Unknown (0.00s)
=== RUN   TestErrorCode_String
=== RUN   TestErrorCode_String/None
=== RUN   TestErrorCode_String/UnknownRequest
=== RUN   TestErrorCode_String/InvalidRequest
=== RUN   TestErrorCode_String/OffsetOutOfRange
=== RUN   TestErrorCode_String/CorruptMessage
=== RUN   TestErrorCode_String/PartitionNotFound
=== RUN   TestErrorCode_String/RequestTimeout
=== RUN   TestErrorCode_String/StorageError
=== RUN   TestErrorCode_String/TopicNotFound
=== RUN   TestErrorCode_String/TopicExists
=== RUN   TestErrorCode_String/ChecksumMismatch
=== RUN   TestErrorCode_String/InvalidProtocol
=== RUN   TestErrorCode_String/MessageTooLarge
=== RUN   TestErrorCode_String/UnknownMemberID
=== RUN   TestErrorCode_String/InvalidSessionTimeout
=== RUN   TestErrorCode_String/RebalanceInProgress
=== RUN   TestErrorCode_String/InvalidGenerationID
=== RUN   TestErrorCode_String/UnknownConsumerGroupID
=== RUN   TestErrorCode_String/NotCoordinator
=== RUN   TestErrorCode_String/InvalidCommitOffsetSize
=== RUN   TestErrorCode_String/GroupAuthorizationFailed
=== RUN   TestErrorCode_String/IllegalGeneration
=== RUN   TestErrorCode_String/InconsistentGroupProtocol
=== RUN   TestErrorCode_String/InvalidProducerEpoch
=== RUN   TestErrorCode_String/InvalidTransactionState
=== RUN   TestErrorCode_String/InvalidProducerIDMapping
=== RUN   TestErrorCode_String/TransactionCoordinatorNotAvailable
=== RUN   TestErrorCode_String/TransactionCoordinatorFenced
=== RUN   TestErrorCode_String/ProducerFenced
=== RUN   TestErrorCode_String/InvalidTransactionTimeout
=== RUN   TestErrorCode_String/ConcurrentTransactions
=== RUN   TestErrorCode_String/TransactionAborted
=== RUN   TestErrorCode_String/InvalidPartitionList
=== RUN   TestErrorCode_String/AuthenticationFailed
=== RUN   TestErrorCode_String/AuthorizationFailed
=== RUN   TestErrorCode_String/InvalidCredentials
=== RUN   TestErrorCode_String/AccountDisabled
=== RUN   TestErrorCode_String/Unknown
--- PASS: TestErrorCode_String (0.00s)
    --- PASS: TestErrorCode_String/None (0.00s)
    --- PASS: TestErrorCode_String/UnknownRequest (0.00s)
    --- PASS: TestErrorCode_String/InvalidRequest (0.00s)
    --- PASS: TestErrorCode_String/OffsetOutOfRange (0.00s)
    --- PASS: TestErrorCode_String/CorruptMessage (0.00s)
    --- PASS: TestErrorCode_String/PartitionNotFound (0.00s)
    --- PASS: TestErrorCode_String/RequestTimeout (0.00s)
    --- PASS: TestErrorCode_String/StorageError (0.00s)
    --- PASS: TestErrorCode_String/TopicNotFound (0.00s)
    --- PASS: TestErrorCode_String/TopicExists (0.00s)
    --- PASS: TestErrorCode_String/ChecksumMismatch (0.00s)
    --- PASS: TestErrorCode_String/InvalidProtocol (0.00s)
    --- PASS: TestErrorCode_String/MessageTooLarge (0.00s)
    --- PASS: TestErrorCode_String/UnknownMemberID (0.00s)
    --- PASS: TestErrorCode_String/InvalidSessionTimeout (0.00s)
    --- PASS: TestErrorCode_String/RebalanceInProgress (0.00s)
    --- PASS: TestErrorCode_String/InvalidGenerationID (0.00s)
    --- PASS: TestErrorCode_String/UnknownConsumerGroupID (0.00s)
    --- PASS: TestErrorCode_String/NotCoordinator (0.00s)
    --- PASS: TestErrorCode_String/InvalidCommitOffsetSize (0.00s)
    --- PASS: TestErrorCode_String/GroupAuthorizationFailed (0.00s)
    --- PASS: TestErrorCode_String/IllegalGeneration (0.00s)
    --- PASS: TestErrorCode_String/InconsistentGroupProtocol (0.00s)
    --- PASS: TestErrorCode_String/InvalidProducerEpoch (0.00s)
    --- PASS: TestErrorCode_String/InvalidTransactionState (0.00s)
    --- PASS: TestErrorCode_String/InvalidProducerIDMapping (0.00s)
    --- PASS: TestErrorCode_String/TransactionCoordinatorNotAvailable (0.00s)
    --- PASS: TestErrorCode_String/TransactionCoordinatorFenced (0.00s)
    --- PASS: TestErrorCode_String/ProducerFenced (0.00s)
    --- PASS: TestErrorCode_String/InvalidTransactionTimeout (0.00s)
    --- PASS: TestErrorCode_String/ConcurrentTransactions (0.00s)
    --- PASS: TestErrorCode_String/TransactionAborted (0.00s)
    --- PASS: TestErrorCode_String/InvalidPartitionList (0.00s)
    --- PASS: TestErrorCode_String/AuthenticationFailed (0.00s)
    --- PASS: TestErrorCode_String/AuthorizationFailed (0.00s)
    --- PASS: TestErrorCode_String/InvalidCredentials (0.00s)
    --- PASS: TestErrorCode_String/AccountDisabled (0.00s)
    --- PASS: TestErrorCode_String/Unknown (0.00s)
=== RUN   TestErrorCode_Error
=== RUN   TestErrorCode_Error/None
=== RUN   TestErrorCode_Error/TopicNotFound
=== RUN   TestErrorCode_Error/AuthenticationFailed
--- PASS: TestErrorCode_Error (0.00s)
    --- PASS: TestErrorCode_Error/None (0.00s)
    --- PASS: TestErrorCode_Error/TopicNotFound (0.00s)
    --- PASS: TestErrorCode_Error/AuthenticationFailed (0.00s)
PASS
coverage: 93.7% of statements
ok  	github.com/gstreamio/streambus/pkg/protocol	2.939s	coverage: 93.7% of statements
=== RUN   TestDefaultConfig
--- PASS: TestDefaultConfig (0.00s)
=== RUN   TestConfigValidate
=== RUN   TestConfigValidate/valid_config
=== RUN   TestConfigValidate/negative_FetchMinBytes
=== RUN   TestConfigValidate/zero_FetchMaxBytes
=== RUN   TestConfigValidate/FetchMaxBytes_<_FetchMinBytes
=== RUN   TestConfigValidate/negative_FetchMaxWaitMs
=== RUN   TestConfigValidate/zero_FetcherInterval
=== RUN   TestConfigValidate/zero_ReplicaLagMaxMessages
=== RUN   TestConfigValidate/zero_ReplicaLagTimeMaxMs
=== RUN   TestConfigValidate/zero_NumFetcherThreads
=== RUN   TestConfigValidate/zero_MaxInflightFetches
--- PASS: TestConfigValidate (0.00s)
    --- PASS: TestConfigValidate/valid_config (0.00s)
    --- PASS: TestConfigValidate/negative_FetchMinBytes (0.00s)
    --- PASS: TestConfigValidate/zero_FetchMaxBytes (0.00s)
    --- PASS: TestConfigValidate/FetchMaxBytes_<_FetchMinBytes (0.00s)
    --- PASS: TestConfigValidate/negative_FetchMaxWaitMs (0.00s)
    --- PASS: TestConfigValidate/zero_FetcherInterval (0.00s)
    --- PASS: TestConfigValidate/zero_ReplicaLagMaxMessages (0.00s)
    --- PASS: TestConfigValidate/zero_ReplicaLagTimeMaxMs (0.00s)
    --- PASS: TestConfigValidate/zero_NumFetcherThreads (0.00s)
    --- PASS: TestConfigValidate/zero_MaxInflightFetches (0.00s)
=== RUN   TestConfigClone
--- PASS: TestConfigClone (0.00s)
=== RUN   TestConfigCloneNil
--- PASS: TestConfigCloneNil (0.00s)
=== RUN   TestFailureDetector_HasFailed
--- PASS: TestFailureDetector_HasFailed (0.00s)
=== RUN   TestFailoverCoordinator_RegisterPartition
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
--- PASS: TestFailoverCoordinator_RegisterPartition (0.00s)
=== RUN   TestFailoverCoordinator_TriggerFailover
2025/11/22 14:23:04 [FailoverCoordinator 2] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
2025/11/22 14:23:04 [FailoverCoordinator 2] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 2] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 2] Failover complete for test-topic:0: new leader=2, epoch=2
--- PASS: TestFailoverCoordinator_TriggerFailover (0.00s)
=== RUN   TestFailoverCoordinator_ElectNewLeader
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
--- PASS: TestFailoverCoordinator_ElectNewLeader (0.00s)
=== RUN   TestFailoverCoordinator_NoAliveISR
--- PASS: TestFailoverCoordinator_NoAliveISR (0.00s)
=== RUN   TestFailoverCoordinator_DuplicateRegistration
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
--- PASS: TestFailoverCoordinator_DuplicateRegistration (0.00s)
=== RUN   TestFailoverCoordinator_StartStop
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Started
2025/11/22 14:23:04 [FailoverCoordinator 1] Stopped
2025/11/22 14:23:04 [FailoverCoordinator 1] Stopped
--- PASS: TestFailoverCoordinator_StartStop (0.05s)
=== RUN   TestFailoverCoordinator_MonitorLeadersLoop
2025/11/22 14:23:04 [FailoverCoordinator 2] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
2025/11/22 14:23:04 [FailoverCoordinator 2] Started
2025/11/22 14:23:04 [FailoverCoordinator 2] Detected leader failure for test-topic:0, leader=1
2025/11/22 14:23:04 [FailoverCoordinator 2] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 2] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 2] Failover complete for test-topic:0: new leader=2, epoch=2
2025/11/22 14:23:04 [FailoverCoordinator 2] Stopped
--- PASS: TestFailoverCoordinator_MonitorLeadersLoop (0.05s)
=== RUN   TestFailoverCoordinator_CheckLeaderHealth
2025/11/22 14:23:04 [FailoverCoordinator 2] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
2025/11/22 14:23:04 [FailoverCoordinator 2] Detected leader failure for test-topic:0, leader=1
2025/11/22 14:23:04 [FailoverCoordinator 2] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 2] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 2] Failover complete for test-topic:0: new leader=2, epoch=2
--- PASS: TestFailoverCoordinator_CheckLeaderHealth (0.00s)
=== RUN   TestFailureDetector_RecordHeartbeat
--- PASS: TestFailureDetector_RecordHeartbeat (0.01s)
=== RUN   TestFailoverCoordinator_HeartbeatLoop
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1]
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:1, leader=2, epoch=1, ISR=[2]
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:2, leader=3, epoch=1, ISR=[3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Started
2025/11/22 14:23:04 [FailoverCoordinator 1] Stopped
    failover_test.go:542: Note: No heartbeats sent (heartbeat interval may be longer than test duration)
--- PASS: TestFailoverCoordinator_HeartbeatLoop (0.10s)
=== RUN   TestFailoverCoordinator_GetMetrics
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
--- PASS: TestFailoverCoordinator_GetMetrics (0.00s)
=== RUN   TestFailoverCoordinator_GetMetrics_ThreadSafety
2025/11/22 14:23:04 [FailoverCoordinator 1] Registered partition test-topic:0, leader=1, epoch=1, ISR=[1 2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=2
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=3
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=4
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=5
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=6
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=7
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=8
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=9
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=10
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=11
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=12
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=13
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=14
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=15
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=16
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=17
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=18
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=19
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=20
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=21
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=22
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=23
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=24
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=25
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=26
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=27
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=28
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=29
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=30
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=31
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=32
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=33
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=34
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=35
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=36
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=37
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=38
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=39
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=40
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=41
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=42
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=43
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=44
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=45
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=46
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=47
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=48
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=49
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=50
2025/11/22 14:23:04 [FailoverCoordinator 1] Starting failover for test-topic:0
2025/11/22 14:23:04 [FailoverCoordinator 1] Elected new leader: 2 from ISR: [2 3]
2025/11/22 14:23:04 [FailoverCoordinator 1] Failover complete for test-topic:0: new leader=2, epoch=51
--- PASS: TestFailoverCoordinator_GetMetrics_ThreadSafety (0.11s)
=== RUN   TestNewFetcher
--- PASS: TestNewFetcher (0.00s)
=== RUN   TestFetcher_StartStop
2025/11/22 14:23:04 [Fetcher 1] Started
2025/11/22 14:23:04 [Fetcher 1] Stopped
--- PASS: TestFetcher_StartStop (0.00s)
=== RUN   TestFetcher_AddPartition
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:0 (leader=2, epoch=1)
--- PASS: TestFetcher_AddPartition (0.00s)
=== RUN   TestFetcher_RemovePartition
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:0 (leader=2, epoch=1)
2025/11/22 14:23:04 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Removed partition test-topic:0
--- PASS: TestFetcher_RemovePartition (0.00s)
=== RUN   TestFetcher_UpdateLeader
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:0 (leader=2, epoch=1)
2025/11/22 14:23:04 [Follower 1] Updated leader to 3, epoch 2
--- PASS: TestFetcher_UpdateLeader (0.00s)
=== RUN   TestFetcher_GetReplicationLag
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:0 (leader=2, epoch=1)
--- PASS: TestFetcher_GetReplicationLag (0.00s)
=== RUN   TestFetcher_GetAllMetrics
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:0 (leader=2, epoch=1)
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:1, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:1
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:1 (leader=2, epoch=1)
--- PASS: TestFetcher_GetAllMetrics (0.00s)
=== RUN   TestFetcher_GetPartitionCount
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:0 (leader=2, epoch=1)
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:1, leader=2, epoch=1, LEO=0
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:1
2025/11/22 14:23:04 [Fetcher 1] Added partition test-topic:1 (leader=2, epoch=1)
2025/11/22 14:23:04 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [Fetcher 1] Removed partition test-topic:0
--- PASS: TestFetcher_GetPartitionCount (0.00s)
=== RUN   TestPartitionKey
=== RUN   TestPartitionKey/test-topic:0
=== RUN   TestPartitionKey/my-topic:5
=== RUN   TestPartitionKey/topic-123:100
--- PASS: TestPartitionKey (0.00s)
    --- PASS: TestPartitionKey/test-topic:0 (0.00s)
    --- PASS: TestPartitionKey/my-topic:5 (0.00s)
    --- PASS: TestPartitionKey/topic-123:100 (0.00s)
=== RUN   TestFollowerReplicator_handleFetchResponse_Success
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Fetched 2 messages, LEO: 100 -> 102, HW: 95, lag: 3
--- PASS: TestFollowerReplicator_handleFetchResponse_Success (0.00s)
=== RUN   TestFollowerReplicator_handleFetchResponse_EpochChange
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Leader epoch changed: 1 -> 5
--- PASS: TestFollowerReplicator_handleFetchResponse_EpochChange (0.00s)
=== RUN   TestFollowerReplicator_handleFetchResponse_HWUpdate
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
--- PASS: TestFollowerReplicator_handleFetchResponse_HWUpdate (0.00s)
=== RUN   TestFollowerReplicator_handleFetchResponse_EmptyMessages
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
--- PASS: TestFollowerReplicator_handleFetchResponse_EmptyMessages (0.00s)
=== RUN   TestFollowerReplicator_handleFetchResponse_WithError
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Stale epoch detected, updating to 5
--- PASS: TestFollowerReplicator_handleFetchResponse_WithError (0.00s)
=== RUN   TestFollowerReplicator_handleFetchError_StaleEpoch
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Stale epoch detected, updating to 5
--- PASS: TestFollowerReplicator_handleFetchError_StaleEpoch (0.00s)
=== RUN   TestFollowerReplicator_handleFetchError_OffsetOutOfRange
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Offset out of range, resetting LEO to 0
--- PASS: TestFollowerReplicator_handleFetchError_OffsetOutOfRange (0.00s)
=== RUN   TestFollowerReplicator_handleFetchError_NotLeader
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Current node is not leader
--- PASS: TestFollowerReplicator_handleFetchError_NotLeader (0.00s)
=== RUN   TestFollowerReplicator_handleFetchError_Unknown
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
--- PASS: TestFollowerReplicator_handleFetchError_Unknown (0.00s)
=== RUN   TestFollowerReplicator_UpdateLeader_Success
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Updated leader to 3, epoch 5
--- PASS: TestFollowerReplicator_UpdateLeader_Success (0.00s)
=== RUN   TestFollowerReplicator_UpdateLeader_StaleEpoch
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=5, LEO=100
--- PASS: TestFollowerReplicator_UpdateLeader_StaleEpoch (0.00s)
=== RUN   TestFollowerReplicator_GetLogEndOffset
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
--- PASS: TestFollowerReplicator_GetLogEndOffset (0.00s)
=== RUN   TestFollowerReplicator_GetHighWaterMark
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
--- PASS: TestFollowerReplicator_GetHighWaterMark (0.00s)
=== RUN   TestCalculateMessageBytes
=== RUN   TestCalculateMessageBytes/empty_messages
=== RUN   TestCalculateMessageBytes/single_message
=== RUN   TestCalculateMessageBytes/multiple_messages
=== RUN   TestCalculateMessageBytes/message_with_no_key
=== RUN   TestCalculateMessageBytes/message_with_no_value
--- PASS: TestCalculateMessageBytes (0.00s)
    --- PASS: TestCalculateMessageBytes/empty_messages (0.00s)
    --- PASS: TestCalculateMessageBytes/single_message (0.00s)
    --- PASS: TestCalculateMessageBytes/multiple_messages (0.00s)
    --- PASS: TestCalculateMessageBytes/message_with_no_key (0.00s)
    --- PASS: TestCalculateMessageBytes/message_with_no_value (0.00s)
=== RUN   TestLeaderReplicator_UpdateLogEndOffset
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Updated LEO to 200
--- PASS: TestLeaderReplicator_UpdateLogEndOffset (0.00s)
=== RUN   TestLeaderReplicator_GetHighWaterMark
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_GetHighWaterMark (0.00s)
=== RUN   TestLeaderReplicator_GetISR
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_GetISR (0.00s)
=== RUN   TestReplicationManager_UpdateLogEndOffset
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Updated LEO to 200
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_UpdateLogEndOffset (0.00s)
=== RUN   TestReplicationManager_GetMetrics
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetMetrics (0.00s)
=== RUN   TestMetricsCollector_GetGlobalMetrics
--- PASS: TestMetricsCollector_GetGlobalMetrics (0.00s)
=== RUN   TestLeaderReplicator_HandleFetchRequest_WrongPartition
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_HandleFetchRequest_WrongPartition (0.00s)
=== RUN   TestLeaderReplicator_HandleFetchRequest_ReplicaNotInSet
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_HandleFetchRequest_ReplicaNotInSet (0.00s)
=== RUN   TestLeaderReplicator_HandleFetchRequest_StaleEpoch
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_HandleFetchRequest_StaleEpoch (0.00s)
=== RUN   TestLeaderReplicator_HandleFetchRequest_OffsetOutOfRange
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_HandleFetchRequest_OffsetOutOfRange (0.00s)
=== RUN   TestLeaderReplicator_HandleFetchRequest_CaughtUp
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_HandleFetchRequest_CaughtUp (0.00s)
=== RUN   TestLeaderReplicator_HandleFetchRequest_Success
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Served fetch from replica 2: offset=10, count=1, bytes=10
--- PASS: TestLeaderReplicator_HandleFetchRequest_Success (0.00s)
=== RUN   TestLeaderReplicator_GetMetrics
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_GetMetrics (0.00s)
=== RUN   TestLeaderReplicator_GetPartitionState
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_GetPartitionState (0.00s)
=== RUN   TestLeaderReplicator_ISRChangeChannel
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
--- PASS: TestLeaderReplicator_ISRChangeChannel (0.00s)
=== RUN   TestManagerHandleFetchRequest
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Served fetch from replica 2: offset=0, count=0, bytes=0
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestManagerHandleFetchRequest (0.00s)
=== RUN   TestReplicationManager_BecomeLeader_FromFollower
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became follower for test-topic:0, leader=2, epoch=1
2025/11/22 14:23:04 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=2, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=2, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_BecomeLeader_FromFollower (0.00s)
=== RUN   TestReplicationManager_UpdateLogEndOffset_NotLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_UpdateLogEndOffset_NotLeader (0.00s)
=== RUN   TestReplicationManager_NotifyReplication_NotLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_NotifyReplication_NotLeader (0.00s)
=== RUN   TestReplicationManager_GetISR_NotLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetISR_NotLeader (0.00s)
=== RUN   TestReplicationManager_GetHighWaterMark_NotLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetHighWaterMark_NotLeader (0.00s)
=== RUN   TestReplicationManager_HandleFetchRequest_NotLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_HandleFetchRequest_NotLeader (0.00s)
=== RUN   TestReplicationManager_Create
--- PASS: TestReplicationManager_Create (0.00s)
=== RUN   TestReplicationManager_BecomeLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_BecomeLeader (0.00s)
=== RUN   TestReplicationManager_BecomeFollower
2025/11/22 14:23:04 [ReplicationManager 2] Started for test-topic:0
2025/11/22 14:23:04 [Follower 2] Initialized replicator for test-topic:0, leader=1, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 2] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 2] Became follower for test-topic:0, leader=1, epoch=1
2025/11/22 14:23:04 [Follower 2] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 2] Stopped for test-topic:0
--- PASS: TestReplicationManager_BecomeFollower (0.00s)
=== RUN   TestReplicationManager_LeaderFollowerTransition
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:04 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became follower for test-topic:0, leader=2, epoch=1
2025/11/22 14:23:04 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=2, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=2, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_LeaderFollowerTransition (0.00s)
=== RUN   TestReplicationManager_WaitForISR
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_WaitForISR (0.10s)
=== RUN   TestReplicationManager_NotifyReplication
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_NotifyReplication (0.05s)
=== RUN   TestReplicationManager_GetHighWaterMark
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetHighWaterMark (0.00s)
=== RUN   TestReplicationManager_GetISR
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:04 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetISR (0.00s)
=== RUN   TestReplicationManager_BecomeFollower_FromLeader
2025/11/22 14:23:04 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:04 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:04 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:04 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:05 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=2, LEO=100
2025/11/22 14:23:05 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became follower for test-topic:0, leader=2, epoch=2
2025/11/22 14:23:05 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_BecomeFollower_FromLeader (0.05s)
=== RUN   TestReplicationManager_GetHighWaterMark_AsFollower
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:05 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became follower for test-topic:0, leader=2, epoch=1
2025/11/22 14:23:05 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetHighWaterMark_AsFollower (0.00s)
=== RUN   TestReplicationManager_GetMetrics_AsFollower
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [Follower 1] Initialized replicator for test-topic:0, leader=2, epoch=1, LEO=100
2025/11/22 14:23:05 [Follower 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became follower for test-topic:0, leader=2, epoch=1
2025/11/22 14:23:05 [Follower 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetMetrics_AsFollower (0.00s)
=== RUN   TestReplicationManager_GetMetrics_NoRole
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_GetMetrics_NoRole (0.00s)
=== RUN   TestReplicationManager_WaitForISR_NotLeader
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_WaitForISR_NotLeader (0.00s)
=== RUN   TestReplicationManager_WaitForISR_AlreadyReplicated
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:05 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:05 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_WaitForISR_AlreadyReplicated (0.00s)
=== RUN   TestReplicationManager_WaitForISR_Timeout
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:05 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:05 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_WaitForISR_Timeout (0.10s)
=== RUN   TestReplicationManager_WaitForISR_ContextCancelled
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:05 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:05 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_WaitForISR_ContextCancelled (0.05s)
=== RUN   TestReplicationManager_WaitForISR_DefaultTimeout
2025/11/22 14:23:05 [ReplicationManager 1] Started for test-topic:0
2025/11/22 14:23:05 [Leader 1] Initialized replicator for test-topic:0, epoch=1, replicas=[1 2 3], LEO=100, HW=90
2025/11/22 14:23:05 [Leader 1] Started replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Became leader for test-topic:0, epoch=1, replicas=[1 2 3]
2025/11/22 14:23:05 [Leader 1] Stopped replication for test-topic:0
2025/11/22 14:23:05 [ReplicationManager 1] Stopped for test-topic:0
--- PASS: TestReplicationManager_WaitForISR_DefaultTimeout (0.20s)
=== RUN   TestPartitionMetrics_UpdateFromReplicationMetrics
--- PASS: TestPartitionMetrics_UpdateFromReplicationMetrics (0.00s)
=== RUN   TestMetricsCollector_RegisterPartition
--- PASS: TestMetricsCollector_RegisterPartition (0.00s)
=== RUN   TestMetricsCollector_UnregisterPartition
--- PASS: TestMetricsCollector_UnregisterPartition (0.00s)
=== RUN   TestPartitionMetrics_RecordFetch
--- PASS: TestPartitionMetrics_RecordFetch (0.00s)
=== RUN   TestPartitionMetrics_RecordISRChange
--- PASS: TestPartitionMetrics_RecordISRChange (0.00s)
=== RUN   TestPartitionMetrics_RecordFailover
--- PASS: TestPartitionMetrics_RecordFailover (0.00s)
=== RUN   TestPartitionMetrics_UpdateOffsets
--- PASS: TestPartitionMetrics_UpdateOffsets (0.00s)
=== RUN   TestPartitionMetrics_GetSnapshot
--- PASS: TestPartitionMetrics_GetSnapshot (0.00s)
=== RUN   TestMetricsCollector_GetAllPartitionMetrics
--- PASS: TestMetricsCollector_GetAllPartitionMetrics (0.00s)
=== RUN   TestMetricsCollector_ComputeGlobalMetrics
--- PASS: TestMetricsCollector_ComputeGlobalMetrics (0.00s)
=== RUN   TestMetricsCollector_GetGlobalSnapshot
--- PASS: TestMetricsCollector_GetGlobalSnapshot (0.00s)
=== RUN   TestPartitionMetrics_ConcurrentUpdates
--- PASS: TestPartitionMetrics_ConcurrentUpdates (0.00s)
=== RUN   TestNewLogReconciliation
--- PASS: TestNewLogReconciliation (0.00s)
=== RUN   TestLogReconciliation_ReconcileAsNewLeader_NoTruncation
2025/11/22 14:23:05 [Reconciliation 1] Starting reconciliation for test-topic:0 as new leader, epoch=5
2025/11/22 14:23:05 [Reconciliation 1] Current state: LEO=100, HW=100
2025/11/22 14:23:05 [Reconciliation 1] Reconciliation complete for new leader
--- PASS: TestLogReconciliation_ReconcileAsNewLeader_NoTruncation (0.00s)
=== RUN   TestLogReconciliation_ReconcileAsNewLeader_WithTruncation
2025/11/22 14:23:05 [Reconciliation 1] Starting reconciliation for test-topic:0 as new leader, epoch=5
2025/11/22 14:23:05 [Reconciliation 1] Current state: LEO=120, HW=100
2025/11/22 14:23:05 [Reconciliation 1] Truncating uncommitted entries: LEO=120 -> HW=100
2025/11/22 14:23:05 [Reconciliation 1] Truncation complete
2025/11/22 14:23:05 [Reconciliation 1] Reconciliation complete for new leader
--- PASS: TestLogReconciliation_ReconcileAsNewLeader_WithTruncation (0.00s)
=== RUN   TestLogReconciliation_ReconcileAsFollower_NoTruncation
2025/11/22 14:23:05 [Reconciliation 1] Starting reconciliation for test-topic:0 as follower, leader_epoch=6
2025/11/22 14:23:05 [Reconciliation 1] Current state: LEO=100, HW=100
2025/11/22 14:23:05 [Reconciliation 1] Reconciliation complete for follower
--- PASS: TestLogReconciliation_ReconcileAsFollower_NoTruncation (0.00s)
=== RUN   TestLogReconciliation_ReconcileAsFollower_WithTruncation
2025/11/22 14:23:05 [Reconciliation 1] Starting reconciliation for test-topic:0 as follower, leader_epoch=6
2025/11/22 14:23:05 [Reconciliation 1] Current state: LEO=120, HW=100
2025/11/22 14:23:05 [Reconciliation 1] Truncating to HW: LEO=120 -> HW=100
2025/11/22 14:23:05 [Reconciliation 1] Truncation complete
2025/11/22 14:23:05 [Reconciliation 1] Reconciliation complete for follower
--- PASS: TestLogReconciliation_ReconcileAsFollower_WithTruncation (0.00s)
=== RUN   TestLogReconciliation_ValidateConsistency_Valid
--- PASS: TestLogReconciliation_ValidateConsistency_Valid (0.00s)
=== RUN   TestLogReconciliation_ValidateConsistency_HWGreaterThanLEO
--- PASS: TestLogReconciliation_ValidateConsistency_HWGreaterThanLEO (0.00s)
=== RUN   TestLogReconciliation_ValidateConsistency_NegativeLEO
--- PASS: TestLogReconciliation_ValidateConsistency_NegativeLEO (0.00s)
=== RUN   TestLogReconciliation_ValidateConsistency_NegativeHW
--- PASS: TestLogReconciliation_ValidateConsistency_NegativeHW (0.00s)
=== RUN   TestLogReconciliation_GetDivergencePoint_NoDivergence
--- PASS: TestLogReconciliation_GetDivergencePoint_NoDivergence (0.00s)
=== RUN   TestLogReconciliation_GetDivergencePoint_WithDivergence
--- PASS: TestLogReconciliation_GetDivergencePoint_WithDivergence (0.00s)
=== RUN   TestLogReconciliation_ResetToOffset
2025/11/22 14:23:05 [Reconciliation 1] Resetting log to offset 80
2025/11/22 14:23:05 [Reconciliation 1] Log reset complete
--- PASS: TestLogReconciliation_ResetToOffset (0.00s)
=== RUN   TestLogReconciliation_ResetToOffset_NoHWUpdate
2025/11/22 14:23:05 [Reconciliation 1] Resetting log to offset 80
2025/11/22 14:23:05 [Reconciliation 1] Log reset complete
--- PASS: TestLogReconciliation_ResetToOffset_NoHWUpdate (0.00s)
=== RUN   TestErrorCode_String
=== RUN   TestErrorCode_String/None
=== RUN   TestErrorCode_String/NotLeader
=== RUN   TestErrorCode_String/OffsetOutOfRange
=== RUN   TestErrorCode_String/StaleEpoch
=== RUN   TestErrorCode_String/PartitionNotFound
=== RUN   TestErrorCode_String/ReplicaNotInReplicas
=== RUN   TestErrorCode_String/Unknown
=== RUN   TestErrorCode_String/Unknown#01
--- PASS: TestErrorCode_String (0.00s)
    --- PASS: TestErrorCode_String/None (0.00s)
    --- PASS: TestErrorCode_String/NotLeader (0.00s)
    --- PASS: TestErrorCode_String/OffsetOutOfRange (0.00s)
    --- PASS: TestErrorCode_String/StaleEpoch (0.00s)
    --- PASS: TestErrorCode_String/PartitionNotFound (0.00s)
    --- PASS: TestErrorCode_String/ReplicaNotInReplicas (0.00s)
    --- PASS: TestErrorCode_String/Unknown (0.00s)
    --- PASS: TestErrorCode_String/Unknown#01 (0.00s)
=== RUN   TestReplicationState
--- PASS: TestReplicationState (0.00s)
=== RUN   TestPartitionReplicationState
--- PASS: TestPartitionReplicationState (0.00s)
=== RUN   TestFetchRequest
--- PASS: TestFetchRequest (0.00s)
=== RUN   TestFetchResponse
--- PASS: TestFetchResponse (0.00s)
=== RUN   TestMessage
--- PASS: TestMessage (0.00s)
=== RUN   TestISRChangeNotification
--- PASS: TestISRChangeNotification (0.00s)
=== RUN   TestReplicationMetrics
--- PASS: TestReplicationMetrics (0.00s)
PASS
coverage: 86.8% of statements
ok  	github.com/gstreamio/streambus/pkg/replication	3.956s	coverage: 86.8% of statements
=== RUN   TestDefaultReplicationConfig
--- PASS: TestDefaultReplicationConfig (0.00s)
=== RUN   TestDefaultClusterConfig
--- PASS: TestDefaultClusterConfig (0.00s)
=== RUN   TestDefaultFailoverConfig
--- PASS: TestDefaultFailoverConfig (0.00s)
=== RUN   TestReplicationLink_Validate
=== RUN   TestReplicationLink_Validate/valid_link
=== RUN   TestReplicationLink_Validate/missing_ID
=== RUN   TestReplicationLink_Validate/missing_name
=== RUN   TestReplicationLink_Validate/invalid_type
=== RUN   TestReplicationLink_Validate/same_cluster_IDs
--- PASS: TestReplicationLink_Validate (0.00s)
    --- PASS: TestReplicationLink_Validate/valid_link (0.00s)
    --- PASS: TestReplicationLink_Validate/missing_ID (0.00s)
    --- PASS: TestReplicationLink_Validate/missing_name (0.00s)
    --- PASS: TestReplicationLink_Validate/invalid_type (0.00s)
    --- PASS: TestReplicationLink_Validate/same_cluster_IDs (0.00s)
=== RUN   TestClusterConfig_Validate
=== RUN   TestClusterConfig_Validate/valid_config
=== RUN   TestClusterConfig_Validate/missing_cluster_ID
=== RUN   TestClusterConfig_Validate/missing_brokers_and_bootstrap_servers
=== RUN   TestClusterConfig_Validate/negative_connection_timeout
=== RUN   TestClusterConfig_Validate/negative_request_timeout
=== RUN   TestClusterConfig_Validate/negative_max_retries
--- PASS: TestClusterConfig_Validate (0.00s)
    --- PASS: TestClusterConfig_Validate/valid_config (0.00s)
    --- PASS: TestClusterConfig_Validate/missing_cluster_ID (0.00s)
    --- PASS: TestClusterConfig_Validate/missing_brokers_and_bootstrap_servers (0.00s)
    --- PASS: TestClusterConfig_Validate/negative_connection_timeout (0.00s)
    --- PASS: TestClusterConfig_Validate/negative_request_timeout (0.00s)
    --- PASS: TestClusterConfig_Validate/negative_max_retries (0.00s)
=== RUN   TestSecurityConfig_Validate
=== RUN   TestSecurityConfig_Validate/valid_TLS_config
=== RUN   TestSecurityConfig_Validate/TLS_enabled_without_cert
=== RUN   TestSecurityConfig_Validate/TLS_enabled_without_key
=== RUN   TestSecurityConfig_Validate/valid_SASL_config
=== RUN   TestSecurityConfig_Validate/unsupported_SASL_mechanism
=== RUN   TestSecurityConfig_Validate/SASL_without_username
=== RUN   TestSecurityConfig_Validate/SASL_without_password
--- PASS: TestSecurityConfig_Validate (0.00s)
    --- PASS: TestSecurityConfig_Validate/valid_TLS_config (0.00s)
    --- PASS: TestSecurityConfig_Validate/TLS_enabled_without_cert (0.00s)
    --- PASS: TestSecurityConfig_Validate/TLS_enabled_without_key (0.00s)
    --- PASS: TestSecurityConfig_Validate/valid_SASL_config (0.00s)
    --- PASS: TestSecurityConfig_Validate/unsupported_SASL_mechanism (0.00s)
    --- PASS: TestSecurityConfig_Validate/SASL_without_username (0.00s)
    --- PASS: TestSecurityConfig_Validate/SASL_without_password (0.00s)
=== RUN   TestReplicationConfig_Validate
=== RUN   TestReplicationConfig_Validate/valid_config
=== RUN   TestReplicationConfig_Validate/negative_max_bytes
=== RUN   TestReplicationConfig_Validate/negative_max_messages
=== RUN   TestReplicationConfig_Validate/negative_batch_size
=== RUN   TestReplicationConfig_Validate/unsupported_compression_type
=== RUN   TestReplicationConfig_Validate/negative_throttle_rate
--- PASS: TestReplicationConfig_Validate (0.00s)
    --- PASS: TestReplicationConfig_Validate/valid_config (0.00s)
    --- PASS: TestReplicationConfig_Validate/negative_max_bytes (0.00s)
    --- PASS: TestReplicationConfig_Validate/negative_max_messages (0.00s)
    --- PASS: TestReplicationConfig_Validate/negative_batch_size (0.00s)
    --- PASS: TestReplicationConfig_Validate/unsupported_compression_type (0.00s)
    --- PASS: TestReplicationConfig_Validate/negative_throttle_rate (0.00s)
=== RUN   TestClusterConfig_Clone
--- PASS: TestClusterConfig_Clone (0.00s)
=== RUN   TestManager_CreateLink
--- PASS: TestManager_CreateLink (0.00s)
=== RUN   TestManager_CreateLink_DuplicateID
--- PASS: TestManager_CreateLink_DuplicateID (0.00s)
=== RUN   TestManager_DeleteLink
--- PASS: TestManager_DeleteLink (0.00s)
=== RUN   TestManager_UpdateLink
--- PASS: TestManager_UpdateLink (0.00s)
=== RUN   TestManager_ListLinks
--- PASS: TestManager_ListLinks (0.00s)
=== RUN   TestManager_StartStopLink
    manager_test.go:171: StartLink expected to fail without actual brokers: failed to start stream handler: failed to connect to source cluster: failed to create client: invalid config: invalid max connections value
--- PASS: TestManager_StartStopLink (0.00s)
=== RUN   TestManager_PauseResumeLink
    manager_test.go:192: PauseLink: can only pause active replication links
    manager_test.go:196: ResumeLink: can only resume paused replication links
--- PASS: TestManager_PauseResumeLink (0.00s)
=== RUN   TestManager_GetMetrics
    manager_test.go:217: Metrics retrieved successfully
--- PASS: TestManager_GetMetrics (0.00s)
=== RUN   TestManager_GetHealth
    manager_test.go:238: Health status retrieved successfully
--- PASS: TestManager_GetHealth (0.00s)
=== RUN   TestManager_Checkpoints
--- PASS: TestManager_Checkpoints (0.00s)
=== RUN   TestManager_GetLink_NotFound
--- PASS: TestManager_GetLink_NotFound (0.00s)
=== RUN   TestManager_DeleteLink_NotFound
--- PASS: TestManager_DeleteLink_NotFound (0.00s)
=== RUN   TestManager_UpdateLink_NotFound
--- PASS: TestManager_UpdateLink_NotFound (0.00s)
=== RUN   TestManager_Failover
    manager_test.go:332: Failover event created successfully
--- PASS: TestManager_Failover (0.00s)
=== RUN   TestManager_Failback
    manager_test.go:353: Failback event created successfully
--- PASS: TestManager_Failback (0.00s)
=== RUN   TestManager_Close
--- PASS: TestManager_Close (0.00s)
=== RUN   TestManager_checkAllLinksHealth
--- PASS: TestManager_checkAllLinksHealth (0.00s)
=== RUN   TestManager_checkLinkHealth_NoLink
--- PASS: TestManager_checkLinkHealth_NoLink (0.00s)
=== RUN   TestManager_checkLinkHealth_NoHandler
--- PASS: TestManager_checkLinkHealth_NoHandler (0.00s)
=== RUN   TestManager_checkAutomaticFailover_NilMetrics
--- PASS: TestManager_checkAutomaticFailover_NilMetrics (0.00s)
=== RUN   TestManager_checkAutomaticFailover_NilHealth
--- PASS: TestManager_checkAutomaticFailover_NilHealth (0.00s)
=== RUN   TestManager_checkAutomaticFailover_NilConfig
--- PASS: TestManager_checkAutomaticFailover_NilConfig (0.00s)
=== RUN   TestManager_checkAutomaticFailover_NoTrigger
--- PASS: TestManager_checkAutomaticFailover_NoTrigger (0.00s)
=== RUN   TestManager_scheduleAutoFailback
--- PASS: TestManager_scheduleAutoFailback (0.00s)
=== RUN   TestManager_scheduleAutoFailback_NonExistentLink
--- PASS: TestManager_scheduleAutoFailback_NonExistentLink (0.00s)
=== RUN   TestMemoryStorage_LoadLink
--- PASS: TestMemoryStorage_LoadLink (0.00s)
=== RUN   TestMemoryStorage_LoadLink_NotFound
--- PASS: TestMemoryStorage_LoadLink_NotFound (0.00s)
=== RUN   TestMemoryStorage_LoadCheckpoint
--- PASS: TestMemoryStorage_LoadCheckpoint (0.00s)
=== RUN   TestMemoryStorage_LoadCheckpoint_NotFound
--- PASS: TestMemoryStorage_LoadCheckpoint_NotFound (0.00s)
=== RUN   TestMemoryStorage_SaveOffsetMapping
--- PASS: TestMemoryStorage_SaveOffsetMapping (0.00s)
=== RUN   TestMemoryStorage_SaveOffsetMapping_Nil
--- PASS: TestMemoryStorage_SaveOffsetMapping_Nil (0.00s)
=== RUN   TestMemoryStorage_LoadOffsetMapping
--- PASS: TestMemoryStorage_LoadOffsetMapping (0.00s)
=== RUN   TestMemoryStorage_LoadOffsetMapping_NotFound
--- PASS: TestMemoryStorage_LoadOffsetMapping_NotFound (0.00s)
=== RUN   TestMemoryStorage_DeleteLink_CleansUpAll
--- PASS: TestMemoryStorage_DeleteLink_CleansUpAll (0.00s)
=== RUN   TestMemoryStorage_SaveLink_Nil
--- PASS: TestMemoryStorage_SaveLink_Nil (0.00s)
=== RUN   TestMemoryStorage_SaveCheckpoint_Nil
--- PASS: TestMemoryStorage_SaveCheckpoint_Nil (0.00s)
=== RUN   TestMemoryStorage_ConcurrentAccess
    storage_memory_test.go:355: Concurrent access test passed
--- PASS: TestMemoryStorage_ConcurrentAccess (0.00s)
=== RUN   TestNewStreamHandler
--- PASS: TestNewStreamHandler (0.00s)
=== RUN   TestNewStreamHandler_InvalidLink
--- PASS: TestNewStreamHandler_InvalidLink (0.00s)
=== RUN   TestNewStreamHandler_WithFilter
--- PASS: TestNewStreamHandler_WithFilter (0.00s)
=== RUN   TestNewStreamHandler_InvalidFilterPattern
--- PASS: TestNewStreamHandler_InvalidFilterPattern (0.00s)
=== RUN   TestStreamHandler_Stop_NotStarted
--- PASS: TestStreamHandler_Stop_NotStarted (0.00s)
=== RUN   TestStreamHandler_GetTopicsToReplicate_SpecificTopics
--- PASS: TestStreamHandler_GetTopicsToReplicate_SpecificTopics (0.00s)
=== RUN   TestStreamHandler_StartTopicReplication
--- PASS: TestStreamHandler_StartTopicReplication (0.00s)
=== RUN   TestStreamHandler_StartTopicReplication_WithCheckpoint
--- PASS: TestStreamHandler_StartTopicReplication_WithCheckpoint (0.00s)
=== RUN   TestPartitionWorker_SaveCheckpoint
--- PASS: TestPartitionWorker_SaveCheckpoint (0.00s)
=== RUN   TestPartitionWorker_SaveCheckpoint_NoStorage
--- PASS: TestPartitionWorker_SaveCheckpoint_NoStorage (0.00s)
=== RUN   TestStreamHandler_PerformHealthCheck
--- PASS: TestStreamHandler_PerformHealthCheck (0.00s)
=== RUN   TestStreamHandler_PerformHealthCheck_HighReplicationLag
--- PASS: TestStreamHandler_PerformHealthCheck_HighReplicationLag (0.00s)
=== RUN   TestStreamHandler_PerformHealthCheck_HighErrorRate
--- PASS: TestStreamHandler_PerformHealthCheck_HighErrorRate (0.00s)
=== RUN   TestStreamHandler_PerformHealthCheck_NoRecentCheckpoint
--- PASS: TestStreamHandler_PerformHealthCheck_NoRecentCheckpoint (0.00s)
=== RUN   TestStreamHandler_CompileFilterPatterns
--- PASS: TestStreamHandler_CompileFilterPatterns (0.00s)
=== RUN   TestStreamHandler_CompileFilterPatterns_NoFilter
--- PASS: TestStreamHandler_CompileFilterPatterns_NoFilter (0.00s)
=== RUN   TestStreamHandler_ShouldFilterMessage_NoFilter
--- PASS: TestStreamHandler_ShouldFilterMessage_NoFilter (0.00s)
=== RUN   TestStreamHandler_ShouldFilterMessage_TimestampFilter
--- PASS: TestStreamHandler_ShouldFilterMessage_TimestampFilter (0.00s)
=== RUN   TestStreamHandler_ShouldFilterMessage_IncludePattern
--- PASS: TestStreamHandler_ShouldFilterMessage_IncludePattern (0.00s)
=== RUN   TestStreamHandler_ShouldFilterMessage_ExcludePattern
--- PASS: TestStreamHandler_ShouldFilterMessage_ExcludePattern (0.00s)
=== RUN   TestStreamHandler_ShouldFilterMessage_HeaderFilter
--- PASS: TestStreamHandler_ShouldFilterMessage_HeaderFilter (0.00s)
=== RUN   TestPartitionWorker_ReplicateBatch
--- PASS: TestPartitionWorker_ReplicateBatch (0.10s)
PASS
coverage: 65.5% of statements
ok  	github.com/gstreamio/streambus/pkg/replication/link	3.283s	coverage: 65.5% of statements
=== RUN   TestCircuitBreaker_InitialState
--- PASS: TestCircuitBreaker_InitialState (0.00s)
=== RUN   TestCircuitBreaker_SuccessfulCalls
--- PASS: TestCircuitBreaker_SuccessfulCalls (0.00s)
=== RUN   TestCircuitBreaker_OpensAfterFailures
--- PASS: TestCircuitBreaker_OpensAfterFailures (0.00s)
=== RUN   TestCircuitBreaker_TransitionsToHalfOpen
--- PASS: TestCircuitBreaker_TransitionsToHalfOpen (0.15s)
=== RUN   TestCircuitBreaker_HalfOpenToClosedOnSuccess
--- PASS: TestCircuitBreaker_HalfOpenToClosedOnSuccess (0.10s)
=== RUN   TestCircuitBreaker_HalfOpenToOpenOnFailure
--- PASS: TestCircuitBreaker_HalfOpenToOpenOnFailure (0.10s)
=== RUN   TestCircuitBreaker_StateChangeCallback
--- PASS: TestCircuitBreaker_StateChangeCallback (0.01s)
=== RUN   TestCircuitBreaker_Reset
--- PASS: TestCircuitBreaker_Reset (0.00s)
=== RUN   TestCircuitBreaker_ContextCancellation
--- PASS: TestCircuitBreaker_ContextCancellation (0.00s)
=== RUN   TestCircuitBreaker_Stats
--- PASS: TestCircuitBreaker_Stats (0.00s)
=== RUN   TestCircuitBreaker_ConcurrentCalls
--- PASS: TestCircuitBreaker_ConcurrentCalls (0.02s)
=== RUN   TestCircuitBreaker_StateString
--- PASS: TestCircuitBreaker_StateString (0.00s)
=== RUN   TestCircuitBreaker_Name
--- PASS: TestCircuitBreaker_Name (0.00s)
=== RUN   TestCircuitBreaker_OpenCircuitResetsTimeoutOnFailure
--- PASS: TestCircuitBreaker_OpenCircuitResetsTimeoutOnFailure (0.25s)
PASS
coverage: 91.5% of statements
ok  	github.com/gstreamio/streambus/pkg/resilience	3.639s	coverage: 91.5% of statements
=== RUN   TestNewSchemaRegistry
--- PASS: TestNewSchemaRegistry (0.00s)
=== RUN   TestRegisterSchema
{"timestamp":"2025-11-22T14:23:04.984024-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"user-value","version":1}}
--- PASS: TestRegisterSchema (0.00s)
=== RUN   TestRegisterSchema_Duplicate
{"timestamp":"2025-11-22T14:23:04.984425-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
--- PASS: TestRegisterSchema_Duplicate (0.00s)
=== RUN   TestRegisterSchema_Evolution
{"timestamp":"2025-11-22T14:23:04.98454-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"user-value","version":1}}
{"timestamp":"2025-11-22T14:23:04.984668-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"user-value","version":2}}
--- PASS: TestRegisterSchema_Evolution (0.00s)
=== RUN   TestRegisterSchema_InvalidSubject
--- PASS: TestRegisterSchema_InvalidSubject (0.00s)
=== RUN   TestRegisterSchema_InvalidSchema
{"timestamp":"2025-11-22T14:23:04.984789-05:00","level":"WARN","message":"Schema validation failed","fields":{"error":"invalid JSON schema: invalid character 'o' in literal null (expecting 'u')","subject":"test-subject"}}
--- PASS: TestRegisterSchema_InvalidSchema (0.00s)
=== RUN   TestGetSchema
{"timestamp":"2025-11-22T14:23:04.984858-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
--- PASS: TestGetSchema (0.00s)
=== RUN   TestGetSchema_NotFound
--- PASS: TestGetSchema_NotFound (0.00s)
=== RUN   TestGetSchemaBySubjectVersion
{"timestamp":"2025-11-22T14:23:04.984967-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
--- PASS: TestGetSchemaBySubjectVersion (0.00s)
=== RUN   TestGetLatestSchema
{"timestamp":"2025-11-22T14:23:04.985041-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
{"timestamp":"2025-11-22T14:23:04.985122-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"test-subject","version":2}}
{"timestamp":"2025-11-22T14:23:04.985186-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":4,"subject":"test-subject","version":3}}
--- PASS: TestGetLatestSchema (0.00s)
=== RUN   TestListSubjects
{"timestamp":"2025-11-22T14:23:04.98526-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"user-value","version":1}}
{"timestamp":"2025-11-22T14:23:04.985293-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"order-value","version":1}}
{"timestamp":"2025-11-22T14:23:04.985324-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":4,"subject":"product-value","version":1}}
--- PASS: TestListSubjects (0.00s)
=== RUN   TestListSubjects_WithPrefix
{"timestamp":"2025-11-22T14:23:04.985397-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"user-value","version":1}}
{"timestamp":"2025-11-22T14:23:04.985428-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"user-key","version":1}}
{"timestamp":"2025-11-22T14:23:04.985462-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":4,"subject":"order-value","version":1}}
--- PASS: TestListSubjects_WithPrefix (0.00s)
=== RUN   TestListVersions
{"timestamp":"2025-11-22T14:23:04.985538-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
{"timestamp":"2025-11-22T14:23:04.98561-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"test-subject","version":2}}
{"timestamp":"2025-11-22T14:23:04.98567-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":4,"subject":"test-subject","version":3}}
--- PASS: TestListVersions (0.00s)
=== RUN   TestDeleteSchema
{"timestamp":"2025-11-22T14:23:04.985743-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
{"timestamp":"2025-11-22T14:23:04.98577-05:00","level":"INFO","message":"Schema version deleted","fields":{"subject":"test-subject","version":1}}
--- PASS: TestDeleteSchema (0.00s)
=== RUN   TestDeleteSubject
{"timestamp":"2025-11-22T14:23:04.985839-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
{"timestamp":"2025-11-22T14:23:04.985908-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"test-subject","version":2}}
{"timestamp":"2025-11-22T14:23:04.985969-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":4,"subject":"test-subject","version":3}}
{"timestamp":"2025-11-22T14:23:04.985993-05:00","level":"INFO","message":"Subject deleted","fields":{"subject":"test-subject","versions":3}}
--- PASS: TestDeleteSubject (0.00s)
=== RUN   TestUpdateCompatibility
{"timestamp":"2025-11-22T14:23:04.986048-05:00","level":"INFO","message":"Compatibility mode updated","fields":{"compatibility":"FULL","subject":"test-subject"}}
--- PASS: TestUpdateCompatibility (0.00s)
=== RUN   TestGetCompatibility_UsesGlobal
--- PASS: TestGetCompatibility_UsesGlobal (0.00s)
=== RUN   TestTestCompatibility
{"timestamp":"2025-11-22T14:23:04.986195-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"test-subject","version":1}}
--- PASS: TestTestCompatibility (0.00s)
=== RUN   TestSetGlobalCompatibility
--- PASS: TestSetGlobalCompatibility (0.00s)
=== RUN   TestStats
{"timestamp":"2025-11-22T14:23:04.986381-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":2,"subject":"subject-0","version":1}}
{"timestamp":"2025-11-22T14:23:04.986415-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":3,"subject":"subject-1","version":1}}
{"timestamp":"2025-11-22T14:23:04.986447-05:00","level":"INFO","message":"Schema registered","fields":{"format":"JSON","id":4,"subject":"subject-2","version":1}}
--- PASS: TestStats (0.00s)
=== RUN   TestDefaultValidator_ValidateJSON
=== RUN   TestDefaultValidator_ValidateJSON/valid_JSON_schema
=== RUN   TestDefaultValidator_ValidateJSON/invalid_JSON
=== RUN   TestDefaultValidator_ValidateJSON/empty_schema
=== RUN   TestDefaultValidator_ValidateJSON/simple_type
--- PASS: TestDefaultValidator_ValidateJSON (0.00s)
    --- PASS: TestDefaultValidator_ValidateJSON/valid_JSON_schema (0.00s)
    --- PASS: TestDefaultValidator_ValidateJSON/invalid_JSON (0.00s)
    --- PASS: TestDefaultValidator_ValidateJSON/empty_schema (0.00s)
    --- PASS: TestDefaultValidator_ValidateJSON/simple_type (0.00s)
=== RUN   TestDefaultValidator_ValidateAvro
=== RUN   TestDefaultValidator_ValidateAvro/valid_Avro_record
=== RUN   TestDefaultValidator_ValidateAvro/valid_Avro_primitive
=== RUN   TestDefaultValidator_ValidateAvro/record_without_name
=== RUN   TestDefaultValidator_ValidateAvro/record_without_fields
=== RUN   TestDefaultValidator_ValidateAvro/invalid_type
=== RUN   TestDefaultValidator_ValidateAvro/empty_schema
--- PASS: TestDefaultValidator_ValidateAvro (0.00s)
    --- PASS: TestDefaultValidator_ValidateAvro/valid_Avro_record (0.00s)
    --- PASS: TestDefaultValidator_ValidateAvro/valid_Avro_primitive (0.00s)
    --- PASS: TestDefaultValidator_ValidateAvro/record_without_name (0.00s)
    --- PASS: TestDefaultValidator_ValidateAvro/record_without_fields (0.00s)
    --- PASS: TestDefaultValidator_ValidateAvro/invalid_type (0.00s)
    --- PASS: TestDefaultValidator_ValidateAvro/empty_schema (0.00s)
=== RUN   TestDefaultValidator_ValidateProtobuf
=== RUN   TestDefaultValidator_ValidateProtobuf/valid_protobuf_with_syntax
=== RUN   TestDefaultValidator_ValidateProtobuf/valid_protobuf_without_syntax
=== RUN   TestDefaultValidator_ValidateProtobuf/valid_protobuf_with_enum
=== RUN   TestDefaultValidator_ValidateProtobuf/empty_schema
=== RUN   TestDefaultValidator_ValidateProtobuf/no_message_or_enum
--- PASS: TestDefaultValidator_ValidateProtobuf (0.00s)
    --- PASS: TestDefaultValidator_ValidateProtobuf/valid_protobuf_with_syntax (0.00s)
    --- PASS: TestDefaultValidator_ValidateProtobuf/valid_protobuf_without_syntax (0.00s)
    --- PASS: TestDefaultValidator_ValidateProtobuf/valid_protobuf_with_enum (0.00s)
    --- PASS: TestDefaultValidator_ValidateProtobuf/empty_schema (0.00s)
    --- PASS: TestDefaultValidator_ValidateProtobuf/no_message_or_enum (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_JSON_Backward
=== RUN   TestDefaultValidator_CheckCompatibility_JSON_Backward/add_optional_field
=== RUN   TestDefaultValidator_CheckCompatibility_JSON_Backward/remove_required_field
--- PASS: TestDefaultValidator_CheckCompatibility_JSON_Backward (0.00s)
    --- PASS: TestDefaultValidator_CheckCompatibility_JSON_Backward/add_optional_field (0.00s)
    --- PASS: TestDefaultValidator_CheckCompatibility_JSON_Backward/remove_required_field (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_JSON_Forward
=== RUN   TestDefaultValidator_CheckCompatibility_JSON_Forward/add_required_field_with_default
--- PASS: TestDefaultValidator_CheckCompatibility_JSON_Forward (0.00s)
    --- PASS: TestDefaultValidator_CheckCompatibility_JSON_Forward/add_required_field_with_default (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_JSON_Full
--- PASS: TestDefaultValidator_CheckCompatibility_JSON_Full (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_Avro
=== RUN   TestDefaultValidator_CheckCompatibility_Avro/add_field_-_backward_compatible
=== RUN   TestDefaultValidator_CheckCompatibility_Avro/change_type_-_incompatible
=== RUN   TestDefaultValidator_CheckCompatibility_Avro/remove_field_-_backward_incompatible
--- PASS: TestDefaultValidator_CheckCompatibility_Avro (0.00s)
    --- PASS: TestDefaultValidator_CheckCompatibility_Avro/add_field_-_backward_compatible (0.00s)
    --- PASS: TestDefaultValidator_CheckCompatibility_Avro/change_type_-_incompatible (0.00s)
    --- PASS: TestDefaultValidator_CheckCompatibility_Avro/remove_field_-_backward_incompatible (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_Protobuf
--- PASS: TestDefaultValidator_CheckCompatibility_Protobuf (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_None
--- PASS: TestDefaultValidator_CheckCompatibility_None (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_InvalidOldSchema
--- PASS: TestDefaultValidator_CheckCompatibility_InvalidOldSchema (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_InvalidNewSchema
--- PASS: TestDefaultValidator_CheckCompatibility_InvalidNewSchema (0.00s)
=== RUN   TestDefaultValidator_CheckCompatibility_UnsupportedFormat
--- PASS: TestDefaultValidator_CheckCompatibility_UnsupportedFormat (0.00s)
PASS
coverage: 78.6% of statements
ok  	github.com/gstreamio/streambus/pkg/schema	1.565s	coverage: 78.6% of statements
=== RUN   TestNewACLAuthorizer
--- PASS: TestNewACLAuthorizer (0.00s)
=== RUN   TestACLAuthorizer_Authorize_Disabled
--- PASS: TestACLAuthorizer_Authorize_Disabled (0.00s)
=== RUN   TestACLAuthorizer_Authorize_SuperUser
--- PASS: TestACLAuthorizer_Authorize_SuperUser (0.00s)
=== RUN   TestACLAuthorizer_Authorize_SystemInternal
--- PASS: TestACLAuthorizer_Authorize_SystemInternal (0.00s)
=== RUN   TestACLAuthorizer_Authorize_DenyTakesPrecedence
--- PASS: TestACLAuthorizer_Authorize_DenyTakesPrecedence (0.00s)
=== RUN   TestACLAuthorizer_Authorize_DefaultDeny
--- PASS: TestACLAuthorizer_Authorize_DefaultDeny (0.00s)
=== RUN   TestACLAuthorizer_Authorize_LiteralMatch
--- PASS: TestACLAuthorizer_Authorize_LiteralMatch (0.00s)
=== RUN   TestACLAuthorizer_Authorize_PrefixMatch
=== RUN   TestACLAuthorizer_Authorize_PrefixMatch/exact_prefix
=== RUN   TestACLAuthorizer_Authorize_PrefixMatch/with_suffix
=== RUN   TestACLAuthorizer_Authorize_PrefixMatch/nested
=== RUN   TestACLAuthorizer_Authorize_PrefixMatch/no_match
=== RUN   TestACLAuthorizer_Authorize_PrefixMatch/partial_match
--- PASS: TestACLAuthorizer_Authorize_PrefixMatch (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_PrefixMatch/exact_prefix (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_PrefixMatch/with_suffix (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_PrefixMatch/nested (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_PrefixMatch/no_match (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_PrefixMatch/partial_match (0.00s)
=== RUN   TestACLAuthorizer_Authorize_WildcardMatch
=== RUN   TestACLAuthorizer_Authorize_WildcardMatch/match_wildcard
=== RUN   TestACLAuthorizer_Authorize_WildcardMatch/match_wildcard_2
=== RUN   TestACLAuthorizer_Authorize_WildcardMatch/no_match
=== RUN   TestACLAuthorizer_Authorize_WildcardMatch/no_match_prefix
--- PASS: TestACLAuthorizer_Authorize_WildcardMatch (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardMatch/match_wildcard (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardMatch/match_wildcard_2 (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardMatch/no_match (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardMatch/no_match_prefix (0.00s)
=== RUN   TestACLAuthorizer_Authorize_WildcardPrincipal
=== RUN   TestACLAuthorizer_Authorize_WildcardPrincipal/user1
=== RUN   TestACLAuthorizer_Authorize_WildcardPrincipal/user2
=== RUN   TestACLAuthorizer_Authorize_WildcardPrincipal/service-1
--- PASS: TestACLAuthorizer_Authorize_WildcardPrincipal (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardPrincipal/user1 (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardPrincipal/user2 (0.00s)
    --- PASS: TestACLAuthorizer_Authorize_WildcardPrincipal/service-1 (0.00s)
=== RUN   TestACLAuthorizer_Authorize_GroupMatch
--- PASS: TestACLAuthorizer_Authorize_GroupMatch (0.00s)
=== RUN   TestACLAuthorizer_Authorize_TypeMatch
--- PASS: TestACLAuthorizer_Authorize_TypeMatch (0.00s)
=== RUN   TestACLAuthorizer_AddACL
--- PASS: TestACLAuthorizer_AddACL (0.00s)
=== RUN   TestACLAuthorizer_RemoveACL
--- PASS: TestACLAuthorizer_RemoveACL (0.00s)
=== RUN   TestACLAuthorizer_ListACLs
--- PASS: TestACLAuthorizer_ListACLs (0.00s)
=== RUN   TestACLAuthorizer_FindACLs
--- PASS: TestACLAuthorizer_FindACLs (0.00s)
=== RUN   TestACLAuthorizer_ClearACLs
--- PASS: TestACLAuthorizer_ClearACLs (0.00s)
=== RUN   TestACLBuilder
--- PASS: TestACLBuilder (0.00s)
=== RUN   TestACLBuilder_Deny
--- PASS: TestACLBuilder_Deny (0.00s)
=== RUN   TestACLBuilder_DefaultPatternType
--- PASS: TestACLBuilder_DefaultPatternType (0.00s)
=== RUN   TestDefaultACLs
--- PASS: TestDefaultACLs (0.00s)
=== RUN   TestRestrictiveACLs
--- PASS: TestRestrictiveACLs (0.00s)
=== RUN   TestPrincipal_IsSuperUser
--- PASS: TestPrincipal_IsSuperUser (0.00s)
=== RUN   TestPrincipal_HasGroup
--- PASS: TestPrincipal_HasGroup (0.00s)
=== RUN   TestPrincipal_IsExpired
--- PASS: TestPrincipal_IsExpired (0.00s)
=== RUN   TestNewFileAuditLogger
--- PASS: TestNewFileAuditLogger (0.00s)
=== RUN   TestNewFileAuditLogger_InvalidPath
--- PASS: TestNewFileAuditLogger_InvalidPath (0.00s)
=== RUN   TestFileAuditLogger_LogEvent
--- PASS: TestFileAuditLogger_LogEvent (0.01s)
=== RUN   TestFileAuditLogger_LogEvent_SetTimestamp
--- PASS: TestFileAuditLogger_LogEvent_SetTimestamp (0.01s)
=== RUN   TestFileAuditLogger_Close
--- PASS: TestFileAuditLogger_Close (0.00s)
=== RUN   TestNewMemoryAuditLogger
--- PASS: TestNewMemoryAuditLogger (0.00s)
=== RUN   TestMemoryAuditLogger_LogEvent
--- PASS: TestMemoryAuditLogger_LogEvent (0.00s)
=== RUN   TestMemoryAuditLogger_GetEvents_Copy
--- PASS: TestMemoryAuditLogger_GetEvents_Copy (0.00s)
=== RUN   TestMemoryAuditLogger_Clear
--- PASS: TestMemoryAuditLogger_Clear (0.00s)
=== RUN   TestNewMultiAuditLogger
--- PASS: TestNewMultiAuditLogger (0.00s)
=== RUN   TestMultiAuditLogger_LogEvent
--- PASS: TestMultiAuditLogger_LogEvent (0.00s)
=== RUN   TestMultiAuditLogger_AddLogger
--- PASS: TestMultiAuditLogger_AddLogger (0.00s)
=== RUN   TestNewStructuredAuditLogger
--- PASS: TestNewStructuredAuditLogger (0.00s)
=== RUN   TestStructuredAuditLogger_LogEvent
=== RUN   TestStructuredAuditLogger_LogEvent/success_event
{"timestamp":"2025-11-22T14:23:05.162866-05:00","level":"INFO","message":"Security audit: TOPIC_WRITE on TOPIC.orders - SUCCESS","fields":{"action":"TOPIC_WRITE","audit_event":true,"auth_method":"SASL_PLAIN","client_ip":"192.168.1.100","meta_partition":"0","principal_id":"user1","principal_type":"USER","resource":{"Type":"TOPIC","Name":"orders","PatternType":""},"result":"SUCCESS","timestamp":"2025-11-22T14:23:05.162794-05:00"}}
=== RUN   TestStructuredAuditLogger_LogEvent/failure_event
{"timestamp":"2025-11-22T14:23:05.163076-05:00","level":"WARN","message":"Security audit: TOPIC_READ on TOPIC.sensitive - FAILURE","fields":{"action":"TOPIC_READ","audit_event":true,"auth_method":"","client_ip":"","error":"insufficient permissions","principal_id":"user2","principal_type":"USER","resource":{"Type":"TOPIC","Name":"sensitive","PatternType":""},"result":"FAILURE","timestamp":"2025-11-22T14:23:05.162794-05:00"}}
=== RUN   TestStructuredAuditLogger_LogEvent/denied_event
{"timestamp":"2025-11-22T14:23:05.163161-05:00","level":"WARN","message":"Security audit: TOPIC_DELETE on TOPIC.protected - DENIED","fields":{"action":"TOPIC_DELETE","audit_event":true,"auth_method":"","client_ip":"","error":"access denied","principal_id":"user3","principal_type":"USER","resource":{"Type":"TOPIC","Name":"protected","PatternType":""},"result":"DENIED","timestamp":"2025-11-22T14:23:05.162794-05:00"}}
--- PASS: TestStructuredAuditLogger_LogEvent (0.00s)
    --- PASS: TestStructuredAuditLogger_LogEvent/success_event (0.00s)
    --- PASS: TestStructuredAuditLogger_LogEvent/failure_event (0.00s)
    --- PASS: TestStructuredAuditLogger_LogEvent/denied_event (0.00s)
=== RUN   TestNewAuditEventBuilder
--- PASS: TestNewAuditEventBuilder (0.00s)
=== RUN   TestAuditEventBuilder
--- PASS: TestAuditEventBuilder (0.00s)
=== RUN   TestAuditEventBuilder_WithError
--- PASS: TestAuditEventBuilder_WithError (0.00s)
=== RUN   TestAuditEventBuilder_WithNilError
--- PASS: TestAuditEventBuilder_WithNilError (0.00s)
=== RUN   TestAuditEventBuilder_WithPrincipal_ClientIP
--- PASS: TestAuditEventBuilder_WithPrincipal_ClientIP (0.00s)
=== RUN   TestAuditEventBuilder_WithNilPrincipal
--- PASS: TestAuditEventBuilder_WithNilPrincipal (0.00s)
=== RUN   TestAuditEvent_CompleteWorkflow
{"timestamp":"2025-11-22T14:23:05.16884-05:00","level":"INFO","message":"Security audit: TOPIC_WRITE on TOPIC.audit-test-topic - SUCCESS","fields":{"action":"TOPIC_WRITE","audit_event":true,"auth_method":"SASL_PLAIN","client_ip":"192.168.1.100","meta_test":"complete-workflow","principal_id":"user1","principal_type":"USER","resource":{"Type":"TOPIC","Name":"audit-test-topic","PatternType":""},"result":"SUCCESS","timestamp":"2025-11-22T14:23:05.163736-05:00"}}
--- PASS: TestAuditEvent_CompleteWorkflow (0.01s)
=== RUN   TestConcurrentAuditLogging
--- PASS: TestConcurrentAuditLogging (0.00s)
=== RUN   TestDefaultEncryptionConfig
--- PASS: TestDefaultEncryptionConfig (0.00s)
=== RUN   TestNewKeyManager_Disabled
--- PASS: TestNewKeyManager_Disabled (0.00s)
=== RUN   TestNewKeyManager_Enabled
--- PASS: TestNewKeyManager_Enabled (0.00s)
=== RUN   TestKeyManager_LoadExistingMasterKey
--- PASS: TestKeyManager_LoadExistingMasterKey (0.00s)
=== RUN   TestKeyManager_GetActiveKey
--- PASS: TestKeyManager_GetActiveKey (0.00s)
=== RUN   TestKeyManager_RotateDataKey
--- PASS: TestKeyManager_RotateDataKey (0.00s)
=== RUN   TestKeyManager_GetKey_NotFound
--- PASS: TestKeyManager_GetKey_NotFound (0.00s)
=== RUN   TestNewEncryptionService
--- PASS: TestNewEncryptionService (0.00s)
=== RUN   TestEncryptionService_Encrypt_Decrypt
--- PASS: TestEncryptionService_Encrypt_Decrypt (0.00s)
=== RUN   TestEncryptionService_Disabled
--- PASS: TestEncryptionService_Disabled (0.00s)
=== RUN   TestEncryptionService_EncryptToBase64_DecryptFromBase64
--- PASS: TestEncryptionService_EncryptToBase64_DecryptFromBase64 (0.00s)
=== RUN   TestEncryptionService_MultipleEncryptions
--- PASS: TestEncryptionService_MultipleEncryptions (0.00s)
=== RUN   TestEncryptionService_DecryptWithOldKey
--- PASS: TestEncryptionService_DecryptWithOldKey (0.00s)
=== RUN   TestEncryptionService_LargeData
--- PASS: TestEncryptionService_LargeData (0.01s)
=== RUN   TestDeriveKeyFromPassword
--- PASS: TestDeriveKeyFromPassword (0.60s)
=== RUN   TestGenerateSalt
--- PASS: TestGenerateSalt (0.00s)
=== RUN   TestEncryptionService_EmptyData
--- PASS: TestEncryptionService_EmptyData (0.00s)
=== RUN   TestEncryptedData_Tampering
--- PASS: TestEncryptedData_Tampering (0.00s)
=== RUN   TestKeyManager_ConcurrentAccess
--- PASS: TestKeyManager_ConcurrentAccess (0.00s)
=== RUN   TestNewManager
=== RUN   TestNewManager/nil_config_uses_defaults
{"timestamp":"2025-11-22T14:23:05.785684-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestNewManager/with_TLS_enabled
{"timestamp":"2025-11-22T14:23:05.78578-05:00","level":"INFO","message":"TLS/mTLS authenticator initialized"}
{"timestamp":"2025-11-22T14:23:05.785809-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestNewManager/with_SASL_enabled
{"timestamp":"2025-11-22T14:23:05.785863-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN","SASL_SCRAM_SHA256"]}}
{"timestamp":"2025-11-22T14:23:05.78591-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestNewManager/with_authorization_enabled
{"timestamp":"2025-11-22T14:23:05.785979-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestNewManager/with_audit_enabled
{"timestamp":"2025-11-22T14:23:05.786032-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestNewManager/with_API_key_authentication
{"timestamp":"2025-11-22T14:23:05.786077-05:00","level":"INFO","message":"API Key authenticator initialized"}
{"timestamp":"2025-11-22T14:23:05.786092-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestNewManager/with_encryption_enabled
{"timestamp":"2025-11-22T14:23:05.786152-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestNewManager (0.00s)
    --- PASS: TestNewManager/nil_config_uses_defaults (0.00s)
    --- PASS: TestNewManager/with_TLS_enabled (0.00s)
    --- PASS: TestNewManager/with_SASL_enabled (0.00s)
    --- PASS: TestNewManager/with_authorization_enabled (0.00s)
    --- PASS: TestNewManager/with_audit_enabled (0.00s)
    --- PASS: TestNewManager/with_API_key_authentication (0.00s)
    --- PASS: TestNewManager/with_encryption_enabled (0.00s)
=== RUN   TestManager_Authenticate
=== RUN   TestManager_Authenticate/authentication_disabled_with_anonymous_allowed
{"timestamp":"2025-11-22T14:23:06.344405-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_Authenticate/authentication_disabled_without_anonymous
{"timestamp":"2025-11-22T14:23:06.344491-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_Authenticate/valid_SASL_PLAIN_authentication
{"timestamp":"2025-11-22T14:23:06.344574-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN"]}}
{"timestamp":"2025-11-22T14:23:06.895299-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_Authenticate/invalid_SASL_credentials
{"timestamp":"2025-11-22T14:23:06.895409-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN"]}}
{"timestamp":"2025-11-22T14:23:07.445793-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_Authenticate/unsupported_authentication_method
{"timestamp":"2025-11-22T14:23:07.445934-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN"]}}
{"timestamp":"2025-11-22T14:23:07.445975-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_Authenticate (1.66s)
    --- PASS: TestManager_Authenticate/authentication_disabled_with_anonymous_allowed (0.00s)
    --- PASS: TestManager_Authenticate/authentication_disabled_without_anonymous (0.00s)
    --- PASS: TestManager_Authenticate/valid_SASL_PLAIN_authentication (0.55s)
    --- PASS: TestManager_Authenticate/invalid_SASL_credentials (0.55s)
    --- PASS: TestManager_Authenticate/unsupported_authentication_method (0.00s)
=== RUN   TestManager_Authorize
=== RUN   TestManager_Authorize/authorization_disabled
{"timestamp":"2025-11-22T14:23:07.446083-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_Authorize/authorization_with_allow_ACL
{"timestamp":"2025-11-22T14:23:07.446161-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_Authorize (0.00s)
    --- PASS: TestManager_Authorize/authorization_disabled (0.00s)
    --- PASS: TestManager_Authorize/authorization_with_allow_ACL (0.00s)
=== RUN   TestManager_EncryptDecrypt
=== RUN   TestManager_EncryptDecrypt/encryption_disabled
{"timestamp":"2025-11-22T14:23:07.446271-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_EncryptDecrypt/encryption_enabled
{"timestamp":"2025-11-22T14:23:07.446373-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_EncryptDecrypt (0.00s)
    --- PASS: TestManager_EncryptDecrypt/encryption_disabled (0.00s)
    --- PASS: TestManager_EncryptDecrypt/encryption_enabled (0.00s)
=== RUN   TestManager_AuditAction
=== RUN   TestManager_AuditAction/audit_disabled
{"timestamp":"2025-11-22T14:23:07.446496-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_AuditAction/audit_enabled
{"timestamp":"2025-11-22T14:23:07.446569-05:00","level":"INFO","message":"Security audit: TOPIC_WRITE on TOPIC.test-topic - SUCCESS","fields":{"action":"TOPIC_WRITE","audit_event":true,"auth_method":"","client_ip":"","meta_key":"value","principal_id":"testuser","principal_type":"USER","resource":{"Type":"TOPIC","Name":"test-topic","PatternType":""},"result":"SUCCESS","timestamp":"0001-01-01T00:00:00Z"}}
{"timestamp":"2025-11-22T14:23:07.446623-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AuditAction (0.00s)
    --- PASS: TestManager_AuditAction/audit_disabled (0.00s)
    --- PASS: TestManager_AuditAction/audit_enabled (0.00s)
=== RUN   TestManager_AuditFailure
=== RUN   TestManager_AuditFailure/audit_disabled
{"timestamp":"2025-11-22T14:23:07.446726-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_AuditFailure/audit_enabled
{"timestamp":"2025-11-22T14:23:07.446787-05:00","level":"WARN","message":"Security audit: TOPIC_WRITE on TOPIC.test-topic - FAILURE","fields":{"action":"TOPIC_WRITE","audit_event":true,"auth_method":"","client_ip":"","error":"authentication failed","principal_id":"testuser","principal_type":"USER","resource":{"Type":"TOPIC","Name":"test-topic","PatternType":""},"result":"FAILURE","timestamp":"0001-01-01T00:00:00Z"}}
{"timestamp":"2025-11-22T14:23:07.446835-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AuditFailure (0.00s)
    --- PASS: TestManager_AuditFailure/audit_disabled (0.00s)
    --- PASS: TestManager_AuditFailure/audit_enabled (0.00s)
=== RUN   TestManager_AddRemoveACL
=== RUN   TestManager_AddRemoveACL/authorization_disabled
{"timestamp":"2025-11-22T14:23:07.446925-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_AddRemoveACL/authorization_enabled
{"timestamp":"2025-11-22T14:23:07.446982-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AddRemoveACL (0.00s)
    --- PASS: TestManager_AddRemoveACL/authorization_disabled (0.00s)
    --- PASS: TestManager_AddRemoveACL/authorization_enabled (0.00s)
=== RUN   TestManager_AddUser
=== RUN   TestManager_AddUser/SASL_disabled
{"timestamp":"2025-11-22T14:23:07.447072-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_AddUser/SASL_enabled
{"timestamp":"2025-11-22T14:23:07.447127-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN"]}}
{"timestamp":"2025-11-22T14:23:08.000065-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AddUser (0.55s)
    --- PASS: TestManager_AddUser/SASL_disabled (0.00s)
    --- PASS: TestManager_AddUser/SASL_enabled (0.55s)
=== RUN   TestManager_AddAPIKey
=== RUN   TestManager_AddAPIKey/API_key_disabled
{"timestamp":"2025-11-22T14:23:08.000234-05:00","level":"INFO","message":"Closing security manager"}
=== RUN   TestManager_AddAPIKey/API_key_enabled
{"timestamp":"2025-11-22T14:23:08.000308-05:00","level":"INFO","message":"API Key authenticator initialized"}
{"timestamp":"2025-11-22T14:23:08.000334-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AddAPIKey (0.00s)
    --- PASS: TestManager_AddAPIKey/API_key_disabled (0.00s)
    --- PASS: TestManager_AddAPIKey/API_key_enabled (0.00s)
=== RUN   TestManager_GettersAndFlags
{"timestamp":"2025-11-22T14:23:08.000418-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN"]}}
{"timestamp":"2025-11-22T14:23:08.000485-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_GettersAndFlags (0.00s)
=== RUN   TestManager_Close
{"timestamp":"2025-11-22T14:23:08.000838-05:00","level":"INFO","message":"File audit logger initialized","fields":{"file":"/var/folders/pw/bsfrymns1gz_vnst278xbw880000gn/T/TestManager_Close2675940995/001/audit.log"}}
{"timestamp":"2025-11-22T14:23:08.004798-05:00","level":"INFO","message":"Security audit: TOPIC_WRITE on TOPIC.test-topic - SUCCESS","fields":{"action":"TOPIC_WRITE","audit_event":true,"auth_method":"","client_ip":"","principal_id":"testuser","principal_type":"USER","resource":{"Type":"TOPIC","Name":"test-topic","PatternType":""},"result":"SUCCESS","timestamp":"2025-11-22T14:23:08.000886-05:00"}}
{"timestamp":"2025-11-22T14:23:08.004855-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_Close (0.00s)
=== RUN   TestManager_AuthenticateWithAudit
{"timestamp":"2025-11-22T14:23:08.558358-05:00","level":"INFO","message":"SASL authenticators initialized","fields":{"mechanisms":["SASL_PLAIN"]}}
{"timestamp":"2025-11-22T14:23:09.113683-05:00","level":"INFO","message":"Security audit: AUTHENTICATE on AUTH.authentication - SUCCESS","fields":{"action":"AUTHENTICATE","audit_event":true,"auth_method":"SASL_PLAIN","client_ip":"","principal_id":"testuser","principal_type":"USER","resource":{"Type":"AUTH","Name":"authentication","PatternType":""},"result":"SUCCESS","timestamp":"0001-01-01T00:00:00Z"}}
{"timestamp":"2025-11-22T14:23:09.674918-05:00","level":"WARN","message":"Security audit: AUTHENTICATE on AUTH.authentication - FAILURE","fields":{"action":"AUTHENTICATE","audit_event":true,"auth_method":"SASL_PLAIN","client_ip":"","error":"invalid password","principal_id":"unknown","principal_type":"ANONYMOUS","resource":{"Type":"AUTH","Name":"authentication","PatternType":""},"result":"FAILURE","timestamp":"0001-01-01T00:00:00Z"}}
{"timestamp":"2025-11-22T14:23:09.674987-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AuthenticateWithAudit (1.67s)
=== RUN   TestManager_AuthorizeWithAudit
{"timestamp":"2025-11-22T14:23:09.675107-05:00","level":"INFO","message":"Security audit: TOPIC_WRITE on TOPIC.test-topic - SUCCESS","fields":{"action":"TOPIC_WRITE","audit_event":true,"auth_method":"","client_ip":"","principal_id":"testuser","principal_type":"USER","resource":{"Type":"TOPIC","Name":"test-topic","PatternType":""},"result":"SUCCESS","timestamp":"0001-01-01T00:00:00Z"}}
{"timestamp":"2025-11-22T14:23:09.675167-05:00","level":"WARN","message":"Security audit: TOPIC_DELETE on TOPIC.test-topic - DENIED","fields":{"action":"TOPIC_DELETE","audit_event":true,"auth_method":"","client_ip":"","principal_id":"testuser","principal_type":"USER","resource":{"Type":"TOPIC","Name":"test-topic","PatternType":""},"result":"DENIED","timestamp":"0001-01-01T00:00:00Z"}}
{"timestamp":"2025-11-22T14:23:09.675263-05:00","level":"INFO","message":"Closing security manager"}
--- PASS: TestManager_AuthorizeWithAudit (0.00s)
=== RUN   TestDefaultSecurityConfig
--- PASS: TestDefaultSecurityConfig (0.00s)
=== RUN   TestNewSASLAuthenticator
=== RUN   TestNewSASLAuthenticator/with_users
=== RUN   TestNewSASLAuthenticator/nil_users_map
--- PASS: TestNewSASLAuthenticator (0.00s)
    --- PASS: TestNewSASLAuthenticator/with_users (0.00s)
    --- PASS: TestNewSASLAuthenticator/nil_users_map (0.00s)
=== RUN   TestSASLAuthenticator_Authenticate_PLAIN
=== RUN   TestSASLAuthenticator_Authenticate_PLAIN/valid_PLAIN_authentication
=== RUN   TestSASLAuthenticator_Authenticate_PLAIN/invalid_password
=== RUN   TestSASLAuthenticator_Authenticate_PLAIN/user_not_found
=== RUN   TestSASLAuthenticator_Authenticate_PLAIN/invalid_credentials_type
=== RUN   TestSASLAuthenticator_Authenticate_PLAIN/mechanism_not_allowed
--- PASS: TestSASLAuthenticator_Authenticate_PLAIN (1.66s)
    --- PASS: TestSASLAuthenticator_Authenticate_PLAIN/valid_PLAIN_authentication (0.55s)
    --- PASS: TestSASLAuthenticator_Authenticate_PLAIN/invalid_password (0.55s)
    --- PASS: TestSASLAuthenticator_Authenticate_PLAIN/user_not_found (0.00s)
    --- PASS: TestSASLAuthenticator_Authenticate_PLAIN/invalid_credentials_type (0.00s)
    --- PASS: TestSASLAuthenticator_Authenticate_PLAIN/mechanism_not_allowed (0.00s)
=== RUN   TestSASLAuthenticator_Authenticate_SCRAM256
=== RUN   TestSASLAuthenticator_Authenticate_SCRAM256/valid_SCRAM-SHA-256_authentication
=== RUN   TestSASLAuthenticator_Authenticate_SCRAM256/invalid_password
--- PASS: TestSASLAuthenticator_Authenticate_SCRAM256 (0.02s)
    --- PASS: TestSASLAuthenticator_Authenticate_SCRAM256/valid_SCRAM-SHA-256_authentication (0.01s)
    --- PASS: TestSASLAuthenticator_Authenticate_SCRAM256/invalid_password (0.01s)
=== RUN   TestSASLAuthenticator_Authenticate_SCRAM512
=== RUN   TestSASLAuthenticator_Authenticate_SCRAM512/valid_SCRAM-SHA-512_authentication
=== RUN   TestSASLAuthenticator_Authenticate_SCRAM512/invalid_password
--- PASS: TestSASLAuthenticator_Authenticate_SCRAM512 (0.03s)
    --- PASS: TestSASLAuthenticator_Authenticate_SCRAM512/valid_SCRAM-SHA-512_authentication (0.01s)
    --- PASS: TestSASLAuthenticator_Authenticate_SCRAM512/invalid_password (0.01s)
=== RUN   TestSASLAuthenticator_DisabledUser
--- PASS: TestSASLAuthenticator_DisabledUser (0.56s)
=== RUN   TestCreateUser
=== RUN   TestCreateUser/PLAIN_user
=== RUN   TestCreateUser/SCRAM-SHA-256_user
=== RUN   TestCreateUser/SCRAM-SHA-512_user
=== RUN   TestCreateUser/no_groups
--- PASS: TestCreateUser (1.69s)
    --- PASS: TestCreateUser/PLAIN_user (1.12s)
    --- PASS: TestCreateUser/SCRAM-SHA-256_user (0.01s)
    --- PASS: TestCreateUser/SCRAM-SHA-512_user (0.01s)
    --- PASS: TestCreateUser/no_groups (0.56s)
=== RUN   TestCreateUser_UnsupportedMethod
--- PASS: TestCreateUser_UnsupportedMethod (0.00s)
=== RUN   TestVerifyPassword
=== RUN   TestVerifyPassword/PLAIN
=== RUN   TestVerifyPassword/SCRAM-SHA-256
=== RUN   TestVerifyPassword/SCRAM-SHA-512
--- PASS: TestVerifyPassword (1.71s)
    --- PASS: TestVerifyPassword/PLAIN (1.67s)
    --- PASS: TestVerifyPassword/SCRAM-SHA-256 (0.02s)
    --- PASS: TestVerifyPassword/SCRAM-SHA-512 (0.03s)
=== RUN   TestGenerateAPIKey
--- PASS: TestGenerateAPIKey (0.00s)
=== RUN   TestAPIKeyAuthenticator
=== RUN   TestAPIKeyAuthenticator/valid_API_key
=== RUN   TestAPIKeyAuthenticator/invalid_API_key
=== RUN   TestAPIKeyAuthenticator/invalid_API_secret
=== RUN   TestAPIKeyAuthenticator/invalid_credentials_type
--- PASS: TestAPIKeyAuthenticator (0.00s)
    --- PASS: TestAPIKeyAuthenticator/valid_API_key (0.00s)
    --- PASS: TestAPIKeyAuthenticator/invalid_API_key (0.00s)
    --- PASS: TestAPIKeyAuthenticator/invalid_API_secret (0.00s)
    --- PASS: TestAPIKeyAuthenticator/invalid_credentials_type (0.00s)
=== RUN   TestAPIKeyAuthenticator_DisabledKey
--- PASS: TestAPIKeyAuthenticator_DisabledKey (0.00s)
=== RUN   TestAPIKeyAuthenticator_ExpiredKey
--- PASS: TestAPIKeyAuthenticator_ExpiredKey (0.00s)
=== RUN   TestAPIKeyAuthenticator_Method
--- PASS: TestAPIKeyAuthenticator_Method (0.00s)
=== RUN   TestSASLAuthenticator_Method
--- PASS: TestSASLAuthenticator_Method (0.00s)
=== RUN   TestCredentialsType
=== RUN   TestCredentialsType/TLS_credentials
=== RUN   TestCredentialsType/SASL_PLAIN_credentials
=== RUN   TestCredentialsType/SASL_SCRAM_credentials
=== RUN   TestCredentialsType/API_key_credentials
--- PASS: TestCredentialsType (0.00s)
    --- PASS: TestCredentialsType/TLS_credentials (0.00s)
    --- PASS: TestCredentialsType/SASL_PLAIN_credentials (0.00s)
    --- PASS: TestCredentialsType/SASL_SCRAM_credentials (0.00s)
    --- PASS: TestCredentialsType/API_key_credentials (0.00s)
=== RUN   TestNewTLSConfig
=== RUN   TestNewTLSConfig/disabled_TLS
=== RUN   TestNewTLSConfig/basic_TLS_with_cert
=== RUN   TestNewTLSConfig/TLS_with_CA
=== RUN   TestNewTLSConfig/require_and_verify_client_cert
=== RUN   TestNewTLSConfig/require_but_don't_verify_client_cert
=== RUN   TestNewTLSConfig/verify_if_given
=== RUN   TestNewTLSConfig/custom_cipher_suites
=== RUN   TestNewTLSConfig/invalid_cert_file
=== RUN   TestNewTLSConfig/invalid_CA_file
--- PASS: TestNewTLSConfig (0.23s)
    --- PASS: TestNewTLSConfig/disabled_TLS (0.00s)
    --- PASS: TestNewTLSConfig/basic_TLS_with_cert (0.00s)
    --- PASS: TestNewTLSConfig/TLS_with_CA (0.00s)
    --- PASS: TestNewTLSConfig/require_and_verify_client_cert (0.00s)
    --- PASS: TestNewTLSConfig/require_but_don't_verify_client_cert (0.00s)
    --- PASS: TestNewTLSConfig/verify_if_given (0.00s)
    --- PASS: TestNewTLSConfig/custom_cipher_suites (0.00s)
    --- PASS: TestNewTLSConfig/invalid_cert_file (0.00s)
    --- PASS: TestNewTLSConfig/invalid_CA_file (0.00s)
=== RUN   TestTLSConfig_ValidateClientCert
=== RUN   TestTLSConfig_ValidateClientCert/no_CN_restrictions
=== RUN   TestTLSConfig_ValidateClientCert/allowed_CN
=== RUN   TestTLSConfig_ValidateClientCert/not_allowed_CN
=== RUN   TestTLSConfig_ValidateClientCert/nil_certificate
--- PASS: TestTLSConfig_ValidateClientCert (0.14s)
    --- PASS: TestTLSConfig_ValidateClientCert/no_CN_restrictions (0.00s)
    --- PASS: TestTLSConfig_ValidateClientCert/allowed_CN (0.00s)
    --- PASS: TestTLSConfig_ValidateClientCert/not_allowed_CN (0.00s)
    --- PASS: TestTLSConfig_ValidateClientCert/nil_certificate (0.00s)
=== RUN   TestTLSAuthenticator_Authenticate
=== RUN   TestTLSAuthenticator_Authenticate/valid_mTLS_authentication
=== RUN   TestTLSAuthenticator_Authenticate/CN_validation_success
=== RUN   TestTLSAuthenticator_Authenticate/CN_validation_failure
=== RUN   TestTLSAuthenticator_Authenticate/invalid_credentials_type
=== RUN   TestTLSAuthenticator_Authenticate/nil_client_certificate
=== RUN   TestTLSAuthenticator_Authenticate/empty_certificate_chain
--- PASS: TestTLSAuthenticator_Authenticate (0.18s)
    --- PASS: TestTLSAuthenticator_Authenticate/valid_mTLS_authentication (0.00s)
    --- PASS: TestTLSAuthenticator_Authenticate/CN_validation_success (0.00s)
    --- PASS: TestTLSAuthenticator_Authenticate/CN_validation_failure (0.00s)
    --- PASS: TestTLSAuthenticator_Authenticate/invalid_credentials_type (0.00s)
    --- PASS: TestTLSAuthenticator_Authenticate/nil_client_certificate (0.00s)
    --- PASS: TestTLSAuthenticator_Authenticate/empty_certificate_chain (0.00s)
=== RUN   TestGetRecommendedCipherSuites
--- PASS: TestGetRecommendedCipherSuites (0.00s)
=== RUN   TestDefaultTLSConfig
--- PASS: TestDefaultTLSConfig (0.00s)
=== RUN   TestTLSAuthenticator_Method
--- PASS: TestTLSAuthenticator_Method (0.00s)
PASS
coverage: 88.9% of statements
ok  	github.com/gstreamio/streambus/pkg/security	12.061s	coverage: 88.9% of statements
=== RUN   TestHandler_handleGetOffset
{"level":"info","ts":1763839385.317148,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.317641,"msg":"starting recovery","nextOffset":0}
--- PASS: TestHandler_handleGetOffset (0.00s)
=== RUN   TestHandler_handleGetOffset_TopicNotFound
{"level":"info","ts":1763839385.3185139,"msg":"topic loading complete","totalTopics":0}
--- PASS: TestHandler_handleGetOffset_TopicNotFound (0.00s)
=== RUN   TestHandler_handleDeleteTopic
{"level":"info","ts":1763839385.318989,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.319309,"msg":"starting recovery","nextOffset":0}
--- PASS: TestHandler_handleDeleteTopic (0.00s)
=== RUN   TestHandler_handleDeleteTopic_NotFound
{"level":"info","ts":1763839385.320013,"msg":"topic loading complete","totalTopics":0}
--- PASS: TestHandler_handleDeleteTopic_NotFound (0.00s)
=== RUN   TestHandler_handleListTopics
{"level":"info","ts":1763839385.320502,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.320818,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.321141,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.3214169,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.321725,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.32198,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839385.322248,"msg":"starting recovery","nextOffset":0}
--- PASS: TestHandler_handleListTopics (0.00s)
=== RUN   TestHandler_errorResponse
{"level":"info","ts":1763839385.323888,"msg":"topic loading complete","totalTopics":0}
--- PASS: TestHandler_errorResponse (0.00s)
=== RUN   TestHandler_Close
{"level":"info","ts":1763839385.324367,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.324668,"msg":"starting recovery","nextOffset":0}
--- PASS: TestHandler_Close (0.00s)
=== RUN   TestHandler_Stats
{"level":"info","ts":1763839385.325547,"msg":"topic loading complete","totalTopics":0}
--- PASS: TestHandler_Stats (0.05s)
=== RUN   TestNewHandlerWithDataDir
{"level":"info","ts":1763839385.377407,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839385.3777878,"msg":"starting recovery","nextOffset":0}
--- PASS: TestNewHandlerWithDataDir (0.00s)
=== RUN   TestNewSecurityHandler
--- PASS: TestNewSecurityHandler (0.00s)
=== RUN   TestSecurityHandler_Handle_Disabled
--- PASS: TestSecurityHandler_Handle_Disabled (0.00s)
=== RUN   TestSecurityHandler_Handle_NilSecurityManager
--- PASS: TestSecurityHandler_Handle_NilSecurityManager (0.00s)
=== RUN   TestSecurityHandler_authenticate
--- PASS: TestSecurityHandler_authenticate (0.00s)
=== RUN   TestSecurityHandler_authenticate_Enabled
--- PASS: TestSecurityHandler_authenticate_Enabled (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_Produce
--- PASS: TestSecurityHandler_getActionAndResource_Produce (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_Fetch
--- PASS: TestSecurityHandler_getActionAndResource_Fetch (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_GetOffset
--- PASS: TestSecurityHandler_getActionAndResource_GetOffset (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_CreateTopic
--- PASS: TestSecurityHandler_getActionAndResource_CreateTopic (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_DeleteTopic
--- PASS: TestSecurityHandler_getActionAndResource_DeleteTopic (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_ListTopics
--- PASS: TestSecurityHandler_getActionAndResource_ListTopics (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_HealthCheck
--- PASS: TestSecurityHandler_getActionAndResource_HealthCheck (0.00s)
=== RUN   TestSecurityHandler_getActionAndResource_Unknown
--- PASS: TestSecurityHandler_getActionAndResource_Unknown (0.00s)
=== RUN   TestSecurityHandler_GetStats
--- PASS: TestSecurityHandler_GetStats (0.00s)
=== RUN   TestServer_StartStop
{"level":"info","ts":1763839385.379421,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839385.379442,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839385.379511,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839385.379533,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839385.3795462,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839385.379828,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.481308,"msg":"stopping server"}
{"level":"info","ts":1763839385.4813812,"msg":"server stopped"}
--- PASS: TestServer_StartStop (0.20s)
=== RUN   TestServer_HealthCheck
{"level":"info","ts":1763839385.5828412,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839385.5828748,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839385.582929,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839385.582954,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839385.582966,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839385.5830212,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.6845381,"msg":"stopping server"}
{"level":"info","ts":1763839385.684591,"msg":"server stopped"}
--- PASS: TestServer_HealthCheck (0.10s)
=== RUN   TestServer_ProduceRequest
{"level":"info","ts":1763839385.684972,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839385.684989,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839385.685042,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839385.685059,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839385.685071,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839385.685125,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.790015,"msg":"stopping server"}
{"level":"info","ts":1763839385.790316,"msg":"server stopped"}
--- PASS: TestServer_ProduceRequest (0.11s)
=== RUN   TestServer_FetchRequest
{"level":"info","ts":1763839385.790797,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839385.790817,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839385.790874,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839385.790894,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839385.7909062,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839385.791015,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839385.892658,"msg":"stopping server"}
{"level":"info","ts":1763839385.892709,"msg":"server stopped"}
--- PASS: TestServer_FetchRequest (0.10s)
=== RUN   TestServer_MultipleConnections
{"level":"info","ts":1763839385.8930528,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839385.893069,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839385.8931289,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839385.893146,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839385.893157,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839385.8932102,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.2980611,"msg":"stopping server"}
{"level":"info","ts":1763839386.298191,"msg":"server stopped"}
--- PASS: TestServer_MultipleConnections (0.41s)
=== RUN   TestServer_ConnectionLimit
{"level":"info","ts":1763839386.298555,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839386.2985759,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839386.29866,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839386.298675,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839386.298688,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839386.2987761,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.5017002,"msg":"stopping server"}
{"level":"warn","ts":1763839386.501686,"msg":"max connections reached, rejecting connection","remoteAddr":"[::1]:50185","maxConnections":2}
{"level":"info","ts":1763839386.501778,"msg":"server stopped"}
--- PASS: TestServer_ConnectionLimit (0.20s)
=== RUN   TestServer_Stats
{"level":"info","ts":1763839386.5021608,"msg":"starting recovery","nextOffset":5}
{"level":"info","ts":1763839386.502182,"msg":"recovering messages from WAL","startOffset":0,"endOffset":5,"memTableSize":67108864}
{"level":"info","ts":1763839386.502239,"msg":"recovery complete","recovered":5,"skipped":0,"totalSize":90,"activeMemtables":1,"immutableMemtables":0}
{"level":"info","ts":1763839386.502259,"msg":"registered topic","topic":"test-topic","partitions":1}
{"level":"info","ts":1763839386.502271,"msg":"topic loading complete","totalTopics":1}
{"level":"info","ts":1763839386.502341,"msg":"server listening","address":":0"}
{"level":"info","ts":1763839386.6548429,"msg":"stopping server"}
{"level":"info","ts":1763839386.6549199,"msg":"server stopped"}
--- PASS: TestServer_Stats (0.15s)
=== RUN   TestTopicManager_DeleteTopic
{"level":"info","ts":1763839386.65721,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.657689,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.6624498,"msg":"starting recovery","nextOffset":0}
--- PASS: TestTopicManager_DeleteTopic (0.02s)
=== RUN   TestTopicManager_DeleteTopic_NotFound
{"level":"info","ts":1763839386.677061,"msg":"topic loading complete","totalTopics":0}
--- PASS: TestTopicManager_DeleteTopic_NotFound (0.01s)
=== RUN   TestTopicManager_ListTopics
{"level":"info","ts":1763839386.677794,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.682734,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.691529,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.701477,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.705559,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.709481,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.714349,"msg":"starting recovery","nextOffset":0}
--- PASS: TestTopicManager_ListTopics (0.06s)
=== RUN   TestTopicManager_TopicExists
{"level":"info","ts":1763839386.7392352,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.7399611,"msg":"starting recovery","nextOffset":0}
--- PASS: TestTopicManager_TopicExists (0.01s)
=== RUN   TestTopicManager_Close
{"level":"info","ts":1763839386.748462,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.753088,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.753664,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.758392,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.7623239,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.767515,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.76785,"msg":"starting recovery","nextOffset":0}
--- PASS: TestTopicManager_Close (0.04s)
=== RUN   TestTopicManager_CreateTopic_DuplicateError
{"level":"info","ts":1763839386.785912,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.786703,"msg":"starting recovery","nextOffset":0}
--- PASS: TestTopicManager_CreateTopic_DuplicateError (0.01s)
=== RUN   TestTopicManager_MultiplePartitions
{"level":"info","ts":1763839386.7992058,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.807019,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.811414,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.815155,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.819391,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.823203,"msg":"starting recovery","nextOffset":0}
--- PASS: TestTopicManager_MultiplePartitions (0.04s)
=== RUN   TestTopicManager_ConcurrentOperations
{"level":"info","ts":1763839386.832688,"msg":"topic loading complete","totalTopics":0}
{"level":"info","ts":1763839386.837793,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.838092,"msg":"starting recovery","nextOffset":0}
    topics_test.go:257: Concurrent operations completed successfully
--- PASS: TestTopicManager_ConcurrentOperations (0.01s)
PASS
coverage: 72.7% of statements
ok  	github.com/gstreamio/streambus/pkg/server	2.983s	coverage: 72.7% of statements
=== RUN   TestIndex_AddAndLookup
--- PASS: TestIndex_AddAndLookup (0.01s)
=== RUN   TestIndex_Sync
--- PASS: TestIndex_Sync (0.01s)
=== RUN   TestIndex_Truncate
--- PASS: TestIndex_Truncate (0.01s)
=== RUN   TestIndex_EmptyLookup
--- PASS: TestIndex_EmptyLookup (0.00s)
=== RUN   TestIndex_OutOfRange
--- PASS: TestIndex_OutOfRange (0.01s)
=== RUN   TestIndex_Persistence
--- PASS: TestIndex_Persistence (0.01s)
=== RUN   TestLog_AppendAndRead
{"level":"info","ts":1763839385.828535,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_AppendAndRead (0.01s)
=== RUN   TestLog_ReadRange
{"level":"info","ts":1763839385.835684,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_ReadRange (0.01s)
=== RUN   TestLog_MemTableRotation
{"level":"info","ts":1763839385.840637,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_MemTableRotation (0.19s)
=== RUN   TestLog_HighWaterMark
{"level":"info","ts":1763839386.030627,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_HighWaterMark (0.01s)
=== RUN   TestLog_Offsets
{"level":"info","ts":1763839386.036897,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_Offsets (0.01s)
=== RUN   TestLog_Flush
{"level":"info","ts":1763839386.04273,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_Flush (0.01s)
=== RUN   TestLog_Delete
{"level":"info","ts":1763839386.053946,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_Delete (0.01s)
=== RUN   TestLog_Close
{"level":"info","ts":1763839386.060411,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_Close (0.01s)
=== RUN   TestLog_Reopen
{"level":"info","ts":1763839386.06692,"msg":"starting recovery","nextOffset":0}
{"level":"info","ts":1763839386.0971122,"msg":"starting recovery","nextOffset":3}
{"level":"info","ts":1763839386.097138,"msg":"recovering messages from WAL","startOffset":0,"endOffset":3,"memTableSize":1048576}
{"level":"info","ts":1763839386.097195,"msg":"recovery complete","recovered":3,"skipped":0,"totalSize":54,"activeMemtables":1,"immutableMemtables":0}
--- PASS: TestLog_Reopen (0.03s)
=== RUN   TestLog_Compact
{"level":"info","ts":1763839386.09801,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_Compact (0.00s)
=== RUN   TestLog_Compact_Closed
{"level":"info","ts":1763839386.0987399,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLog_Compact_Closed (0.00s)
=== RUN   TestLogImpl_SerializeBatch
{"level":"info","ts":1763839386.099435,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLogImpl_SerializeBatch (0.00s)
=== RUN   TestLogImpl_DeserializeBatch
{"level":"info","ts":1763839386.1000352,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLogImpl_DeserializeBatch (0.00s)
=== RUN   TestLogImpl_DeserializeBatch_InvalidData
{"level":"info","ts":1763839386.100605,"msg":"starting recovery","nextOffset":0}
--- PASS: TestLogImpl_DeserializeBatch_InvalidData (0.00s)
=== RUN   TestMemTable_PutAndGet
--- PASS: TestMemTable_PutAndGet (0.00s)
=== RUN   TestMemTable_Update
--- PASS: TestMemTable_Update (0.00s)
=== RUN   TestMemTable_Delete
--- PASS: TestMemTable_Delete (0.00s)
=== RUN   TestMemTable_Size
--- PASS: TestMemTable_Size (0.00s)
=== RUN   TestMemTable_Iterator
--- PASS: TestMemTable_Iterator (0.00s)
=== RUN   TestMemTable_Clear
--- PASS: TestMemTable_Clear (0.00s)
=== RUN   TestWAL_AppendAndRead
--- PASS: TestWAL_AppendAndRead (0.03s)
=== RUN   TestWAL_Sync
--- PASS: TestWAL_Sync (0.01s)
=== RUN   TestWAL_SegmentRoll
--- PASS: TestWAL_SegmentRoll (0.12s)
=== RUN   TestWAL_Truncate
    wal_test.go:159: Segments before truncate: 25
    wal_test.go:168: Segments after truncate: 12
--- PASS: TestWAL_Truncate (1.06s)
=== RUN   TestWAL_Reopen
--- PASS: TestWAL_Reopen (0.04s)
PASS
coverage: 81.5% of statements
ok  	github.com/gstreamio/streambus/pkg/storage	3.283s	coverage: 81.5% of statements
=== RUN   TestManager_CreateTenant
--- PASS: TestManager_CreateTenant (0.00s)
=== RUN   TestManager_EnforceProduceQuota
--- PASS: TestManager_EnforceProduceQuota (0.00s)
=== RUN   TestManager_EnforceConsumeQuota
--- PASS: TestManager_EnforceConsumeQuota (0.00s)
=== RUN   TestManager_EnforceConnectionQuota
--- PASS: TestManager_EnforceConnectionQuota (0.00s)
=== RUN   TestManager_EnforceTopicQuota
--- PASS: TestManager_EnforceTopicQuota (0.00s)
=== RUN   TestManager_EnforceStorageQuota
--- PASS: TestManager_EnforceStorageQuota (0.00s)
=== RUN   TestManager_SuspendedTenant
--- PASS: TestManager_SuspendedTenant (0.00s)
=== RUN   TestManager_UpdateTenant
--- PASS: TestManager_UpdateTenant (0.00s)
=== RUN   TestManager_DeleteTenant
--- PASS: TestManager_DeleteTenant (0.00s)
=== RUN   TestManager_GetUsage
--- PASS: TestManager_GetUsage (0.00s)
=== RUN   TestManager_GetAllUsage
--- PASS: TestManager_GetAllUsage (0.00s)
=== RUN   TestManager_GetUtilization
--- PASS: TestManager_GetUtilization (0.00s)
=== RUN   TestManager_GetTenantStats
--- PASS: TestManager_GetTenantStats (0.00s)
=== RUN   TestManager_ListTenants
--- PASS: TestManager_ListTenants (0.00s)
=== RUN   TestManager_NonexistentTenant
--- PASS: TestManager_NonexistentTenant (0.00s)
=== RUN   TestQuotaTracker_CheckThroughput
--- PASS: TestQuotaTracker_CheckThroughput (0.00s)
=== RUN   TestQuotaTracker_CheckThroughputMessages
--- PASS: TestQuotaTracker_CheckThroughputMessages (0.00s)
=== RUN   TestQuotaTracker_CheckConnection
--- PASS: TestQuotaTracker_CheckConnection (0.00s)
=== RUN   TestQuotaTracker_CheckProducer
--- PASS: TestQuotaTracker_CheckProducer (0.00s)
=== RUN   TestQuotaTracker_CheckStorage
--- PASS: TestQuotaTracker_CheckStorage (0.00s)
=== RUN   TestQuotaTracker_CheckTopic
--- PASS: TestQuotaTracker_CheckTopic (0.00s)
=== RUN   TestQuotaTracker_CheckPartitions
--- PASS: TestQuotaTracker_CheckPartitions (0.00s)
=== RUN   TestQuotaTracker_GetUsage
--- PASS: TestQuotaTracker_GetUsage (0.00s)
=== RUN   TestQuotaTracker_UtilizationPercent
    quota_tracker_test.go:295: Connections: 50, Storage: 500, Topics: 3
--- PASS: TestQuotaTracker_UtilizationPercent (0.00s)
=== RUN   TestQuotaTracker_UnlimitedQuotas
--- PASS: TestQuotaTracker_UnlimitedQuotas (0.00s)
=== RUN   TestRateWindow_Basic
--- PASS: TestRateWindow_Basic (0.00s)
=== RUN   TestRateWindow_Expiration
--- PASS: TestRateWindow_Expiration (0.15s)
=== RUN   TestQuotaError_Error
--- PASS: TestQuotaError_Error (0.00s)
=== RUN   TestTenantStore_CreateTenant
--- PASS: TestTenantStore_CreateTenant (0.00s)
=== RUN   TestTenantStore_CreateDuplicateTenant
--- PASS: TestTenantStore_CreateDuplicateTenant (0.00s)
=== RUN   TestTenantStore_GetTenant
--- PASS: TestTenantStore_GetTenant (0.00s)
=== RUN   TestTenantStore_GetNonexistentTenant
--- PASS: TestTenantStore_GetNonexistentTenant (0.00s)
=== RUN   TestTenantStore_UpdateTenant
--- PASS: TestTenantStore_UpdateTenant (0.00s)
=== RUN   TestTenantStore_DeleteTenant
--- PASS: TestTenantStore_DeleteTenant (0.00s)
=== RUN   TestTenantStore_ListTenants
--- PASS: TestTenantStore_ListTenants (0.00s)
=== RUN   TestTenantStore_SuspendAndActivateTenant
--- PASS: TestTenantStore_SuspendAndActivateTenant (0.00s)
=== RUN   TestTenant_IsActive
--- PASS: TestTenant_IsActive (0.00s)
=== RUN   TestTenant_Validate
--- PASS: TestTenant_Validate (0.00s)
=== RUN   TestDefaultQuotas
--- PASS: TestDefaultQuotas (0.00s)
=== RUN   TestUnlimitedQuotas
--- PASS: TestUnlimitedQuotas (0.00s)
=== RUN   TestTenantTimestamps
--- PASS: TestTenantTimestamps (0.01s)
PASS
coverage: 90.8% of statements
ok  	github.com/gstreamio/streambus/pkg/tenancy	1.554s	coverage: 90.8% of statements
=== RUN   TestDefaultConfig
--- PASS: TestDefaultConfig (0.00s)
=== RUN   TestProductionConfig
--- PASS: TestProductionConfig (0.00s)
=== RUN   TestTestConfig
--- PASS: TestTestConfig (0.00s)
=== RUN   TestConfig_Validate
=== RUN   TestConfig_Validate/valid_default_config
=== RUN   TestConfig_Validate/zero_raft_proposal
=== RUN   TestConfig_Validate/election_less_than_heartbeat
=== RUN   TestConfig_Validate/zero_health_check
=== RUN   TestConfig_Validate/zero_graceful_shutdown
--- PASS: TestConfig_Validate (0.00s)
    --- PASS: TestConfig_Validate/valid_default_config (0.00s)
    --- PASS: TestConfig_Validate/zero_raft_proposal (0.00s)
    --- PASS: TestConfig_Validate/election_less_than_heartbeat (0.00s)
    --- PASS: TestConfig_Validate/zero_health_check (0.00s)
    --- PASS: TestConfig_Validate/zero_graceful_shutdown (0.00s)
=== RUN   TestNewManager
--- PASS: TestNewManager (0.00s)
=== RUN   TestNewManager_NilConfig
--- PASS: TestNewManager_NilConfig (0.00s)
=== RUN   TestNewManager_InvalidConfig
--- PASS: TestNewManager_InvalidConfig (0.00s)
=== RUN   TestManager_GetConfig
--- PASS: TestManager_GetConfig (0.00s)
=== RUN   TestManager_UpdateConfig
--- PASS: TestManager_UpdateConfig (0.00s)
=== RUN   TestManager_UpdateConfig_Invalid
--- PASS: TestManager_UpdateConfig_Invalid (0.00s)
=== RUN   TestManager_WithRaftProposal
--- PASS: TestManager_WithRaftProposal (0.00s)
=== RUN   TestManager_WithHealthCheck
--- PASS: TestManager_WithHealthCheck (0.00s)
=== RUN   TestManager_WithRequest
--- PASS: TestManager_WithRequest (0.00s)
=== RUN   TestManager_WithCustom
--- PASS: TestManager_WithCustom (0.00s)
=== RUN   TestOperation_Execute
--- PASS: TestOperation_Execute (0.00s)
=== RUN   TestOperation_Execute_Error
--- PASS: TestOperation_Execute_Error (0.00s)
=== RUN   TestOperation_Execute_Timeout
--- PASS: TestOperation_Execute_Timeout (0.05s)
=== RUN   TestOperation_Execute_ContextCancellation
--- PASS: TestOperation_Execute_ContextCancellation (0.00s)
=== RUN   TestOperation_ExecuteWithRetry_Success
--- PASS: TestOperation_ExecuteWithRetry_Success (0.00s)
=== RUN   TestOperation_ExecuteWithRetry_EventualSuccess
--- PASS: TestOperation_ExecuteWithRetry_EventualSuccess (0.30s)
=== RUN   TestOperation_ExecuteWithRetry_AllFail
--- PASS: TestOperation_ExecuteWithRetry_AllFail (0.30s)
=== RUN   TestOperation_ExecuteWithRetry_ContextCanceled
--- PASS: TestOperation_ExecuteWithRetry_ContextCanceled (0.10s)
=== RUN   TestOperation_ExecuteWithRetry_Backoff
--- PASS: TestOperation_ExecuteWithRetry_Backoff (0.70s)
=== RUN   TestDefaultManager
--- PASS: TestDefaultManager (0.00s)
=== RUN   TestSetDefaultManager
--- PASS: TestSetDefaultManager (0.00s)
=== RUN   TestGlobalWithRaftProposal
--- PASS: TestGlobalWithRaftProposal (0.00s)
=== RUN   TestGlobalWithHealthCheck
--- PASS: TestGlobalWithHealthCheck (0.00s)
=== RUN   TestGlobalWithRequest
--- PASS: TestGlobalWithRequest (0.00s)
=== RUN   TestManager_AllTimeoutMethods
=== RUN   TestManager_AllTimeoutMethods/RaftProposal
=== RUN   TestManager_AllTimeoutMethods/RaftElection
=== RUN   TestManager_AllTimeoutMethods/MetadataUpdate
=== RUN   TestManager_AllTimeoutMethods/MetadataSync
=== RUN   TestManager_AllTimeoutMethods/Rebalance
=== RUN   TestManager_AllTimeoutMethods/HealthCheck
=== RUN   TestManager_AllTimeoutMethods/ReadinessCheck
=== RUN   TestManager_AllTimeoutMethods/Connection
=== RUN   TestManager_AllTimeoutMethods/Request
=== RUN   TestManager_AllTimeoutMethods/GracefulShutdown
--- PASS: TestManager_AllTimeoutMethods (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/RaftProposal (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/RaftElection (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/MetadataUpdate (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/MetadataSync (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/Rebalance (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/HealthCheck (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/ReadinessCheck (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/Connection (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/Request (0.00s)
    --- PASS: TestManager_AllTimeoutMethods/GracefulShutdown (0.00s)
PASS
coverage: 96.7% of statements
ok  	github.com/gstreamio/streambus/pkg/timeout	3.027s	coverage: 96.7% of statements
=== RUN   TestDefaultConfig
--- PASS: TestDefaultConfig (0.00s)
=== RUN   TestConfig_Validate
=== RUN   TestConfig_Validate/valid_config_with_OTLP
=== RUN   TestConfig_Validate/missing_service_name
=== RUN   TestConfig_Validate/invalid_sampling_rate_-_negative
=== RUN   TestConfig_Validate/invalid_sampling_rate_-_too_high
=== RUN   TestConfig_Validate/invalid_exporter_type
=== RUN   TestConfig_Validate/OTLP_without_endpoint
=== RUN   TestConfig_Validate/Jaeger_without_endpoint
=== RUN   TestConfig_Validate/Jaeger_with_agent_endpoint
=== RUN   TestConfig_Validate/Jaeger_with_collector_endpoint
=== RUN   TestConfig_Validate/Zipkin_without_endpoint
=== RUN   TestConfig_Validate/Zipkin_with_endpoint
=== RUN   TestConfig_Validate/Stdout_exporter
=== RUN   TestConfig_Validate/None_exporter
=== RUN   TestConfig_Validate/disabled_config
--- PASS: TestConfig_Validate (0.00s)
    --- PASS: TestConfig_Validate/valid_config_with_OTLP (0.00s)
    --- PASS: TestConfig_Validate/missing_service_name (0.00s)
    --- PASS: TestConfig_Validate/invalid_sampling_rate_-_negative (0.00s)
    --- PASS: TestConfig_Validate/invalid_sampling_rate_-_too_high (0.00s)
    --- PASS: TestConfig_Validate/invalid_exporter_type (0.00s)
    --- PASS: TestConfig_Validate/OTLP_without_endpoint (0.00s)
    --- PASS: TestConfig_Validate/Jaeger_without_endpoint (0.00s)
    --- PASS: TestConfig_Validate/Jaeger_with_agent_endpoint (0.00s)
    --- PASS: TestConfig_Validate/Jaeger_with_collector_endpoint (0.00s)
    --- PASS: TestConfig_Validate/Zipkin_without_endpoint (0.00s)
    --- PASS: TestConfig_Validate/Zipkin_with_endpoint (0.00s)
    --- PASS: TestConfig_Validate/Stdout_exporter (0.00s)
    --- PASS: TestConfig_Validate/None_exporter (0.00s)
    --- PASS: TestConfig_Validate/disabled_config (0.00s)
=== RUN   TestConfig_ToResourceAttributes
--- PASS: TestConfig_ToResourceAttributes (0.00s)
=== RUN   TestConfig_ToResourceAttributes_MinimalConfig
--- PASS: TestConfig_ToResourceAttributes_MinimalConfig (0.00s)
=== RUN   TestWithAttributes
--- PASS: TestWithAttributes (0.00s)
=== RUN   TestWithSpanKind
--- PASS: TestWithSpanKind (0.00s)
=== RUN   TestStartSpan
--- PASS: TestStartSpan (0.00s)
=== RUN   TestStartSpan_WithOptions
--- PASS: TestStartSpan_WithOptions (0.00s)
=== RUN   TestRecordError
--- PASS: TestRecordError (0.00s)
=== RUN   TestRecordError_NilSpan
--- PASS: TestRecordError_NilSpan (0.00s)
=== RUN   TestRecordError_NilError
--- PASS: TestRecordError_NilError (0.00s)
=== RUN   TestSetSpanAttributes
--- PASS: TestSetSpanAttributes (0.00s)
=== RUN   TestSetSpanAttributes_NilSpan
--- PASS: TestSetSpanAttributes_NilSpan (0.00s)
=== RUN   TestAddSpanEvent
--- PASS: TestAddSpanEvent (0.00s)
=== RUN   TestAddSpanEvent_NilSpan
--- PASS: TestAddSpanEvent_NilSpan (0.00s)
=== RUN   TestSetSpanStatus
--- PASS: TestSetSpanStatus (0.00s)
=== RUN   TestSetSpanStatus_NilSpan
--- PASS: TestSetSpanStatus_NilSpan (0.00s)
=== RUN   TestBrokerAttributes
--- PASS: TestBrokerAttributes (0.00s)
=== RUN   TestTopicAttributes
--- PASS: TestTopicAttributes (0.00s)
=== RUN   TestPartitionAttributes
--- PASS: TestPartitionAttributes (0.00s)
=== RUN   TestMessageAttributes
--- PASS: TestMessageAttributes (0.00s)
=== RUN   TestConsumerAttributes
--- PASS: TestConsumerAttributes (0.00s)
=== RUN   TestTransactionAttributes
--- PASS: TestTransactionAttributes (0.00s)
=== RUN   TestRequestAttributes
--- PASS: TestRequestAttributes (0.00s)
=== RUN   TestSchemaAttributes
--- PASS: TestSchemaAttributes (0.00s)
=== RUN   TestErrorAttributes
--- PASS: TestErrorAttributes (0.00s)
=== RUN   TestContextWithSpan
--- PASS: TestContextWithSpan (0.00s)
=== RUN   TestSpanFromContext
--- PASS: TestSpanFromContext (0.00s)
=== RUN   TestSpanContextFromContext
--- PASS: TestSpanContextFromContext (0.00s)
=== RUN   TestTracer_InstrumentedOperation_Success
--- PASS: TestTracer_InstrumentedOperation_Success (0.00s)
=== RUN   TestTracer_InstrumentedOperation_Error
--- PASS: TestTracer_InstrumentedOperation_Error (0.00s)
=== RUN   TestTracer_TraceProduceMessage
--- PASS: TestTracer_TraceProduceMessage (0.00s)
=== RUN   TestTracer_TraceConsumeMessage
--- PASS: TestTracer_TraceConsumeMessage (0.00s)
=== RUN   TestTracer_TraceStorageOperation
--- PASS: TestTracer_TraceStorageOperation (0.00s)
=== RUN   TestTracer_TraceRaftOperation
--- PASS: TestTracer_TraceRaftOperation (0.00s)
=== RUN   TestTracer_TraceNetworkRequest
--- PASS: TestTracer_TraceNetworkRequest (0.00s)
=== RUN   TestTracer_RecordMetric
--- PASS: TestTracer_RecordMetric (0.00s)
=== RUN   TestTracer_MeasureDuration_Success
--- PASS: TestTracer_MeasureDuration_Success (0.00s)
=== RUN   TestTracer_MeasureDuration_Error
--- PASS: TestTracer_MeasureDuration_Error (0.00s)
=== RUN   TestTracer_TraceWithRetry_Success
--- PASS: TestTracer_TraceWithRetry_Success (0.00s)
=== RUN   TestTracer_TraceWithRetry_AllFailed
--- PASS: TestTracer_TraceWithRetry_AllFailed (0.00s)
=== RUN   TestTracer_TraceWithRetry_ImmediateSuccess
--- PASS: TestTracer_TraceWithRetry_ImmediateSuccess (0.00s)
=== RUN   TestHTTPMiddleware
--- PASS: TestHTTPMiddleware (0.00s)
=== RUN   TestHTTPMiddleware_ErrorStatus
--- PASS: TestHTTPMiddleware_ErrorStatus (0.00s)
=== RUN   TestHTTPMiddleware_DisabledTracer
--- PASS: TestHTTPMiddleware_DisabledTracer (0.00s)
=== RUN   TestResponseWriter_WriteHeader
--- PASS: TestResponseWriter_WriteHeader (0.00s)
=== RUN   TestHeaderCarrierFromMap
--- PASS: TestHeaderCarrierFromMap (0.00s)
=== RUN   TestInjectTraceContext
--- PASS: TestInjectTraceContext (0.00s)
=== RUN   TestInjectTraceContext_DisabledTracer
--- PASS: TestInjectTraceContext_DisabledTracer (0.00s)
=== RUN   TestExtractTraceContext
--- PASS: TestExtractTraceContext (0.00s)
=== RUN   TestExtractTraceContext_DisabledTracer
--- PASS: TestExtractTraceContext_DisabledTracer (0.00s)
=== RUN   TestExtractTraceContext_EmptyHeaders
--- PASS: TestExtractTraceContext_EmptyHeaders (0.00s)
=== RUN   TestTracer_Extract_Disabled
--- PASS: TestTracer_Extract_Disabled (0.00s)
=== RUN   TestTracer_Inject_Disabled
--- PASS: TestTracer_Inject_Disabled (0.00s)
=== RUN   TestTracer_SetAttributes
--- PASS: TestTracer_SetAttributes (0.00s)
=== RUN   TestTracer_Shutdown
--- PASS: TestTracer_Shutdown (0.00s)
=== RUN   TestTracer_IsEnabled
--- PASS: TestTracer_IsEnabled (0.00s)
=== RUN   TestConvertAttributes
=== RUN   TestConvertAttributes/string_attribute
=== RUN   TestConvertAttributes/int_attribute
=== RUN   TestConvertAttributes/int64_attribute
=== RUN   TestConvertAttributes/float64_attribute
=== RUN   TestConvertAttributes/bool_attribute
=== RUN   TestConvertAttributes/string_slice_attribute
=== RUN   TestConvertAttributes/mixed_attributes
--- PASS: TestConvertAttributes (0.00s)
    --- PASS: TestConvertAttributes/string_attribute (0.00s)
    --- PASS: TestConvertAttributes/int_attribute (0.00s)
    --- PASS: TestConvertAttributes/int64_attribute (0.00s)
    --- PASS: TestConvertAttributes/float64_attribute (0.00s)
    --- PASS: TestConvertAttributes/bool_attribute (0.00s)
    --- PASS: TestConvertAttributes/string_slice_attribute (0.00s)
    --- PASS: TestConvertAttributes/mixed_attributes (0.00s)
=== RUN   TestNew_Disabled
--- PASS: TestNew_Disabled (0.00s)
=== RUN   TestNew_WithStdoutExporter
--- PASS: TestNew_WithStdoutExporter (0.00s)
=== RUN   TestNew_WithNoneExporter
--- PASS: TestNew_WithNoneExporter (0.00s)
=== RUN   TestNew_WithResourceAttributes
--- PASS: TestNew_WithResourceAttributes (0.00s)
=== RUN   TestNew_UnsupportedExporter
--- PASS: TestNew_UnsupportedExporter (0.00s)
=== RUN   TestNew_JaegerExporter_MissingEndpoint
--- PASS: TestNew_JaegerExporter_MissingEndpoint (0.00s)
=== RUN   TestTracer_Start_Enabled
--- PASS: TestTracer_Start_Enabled (0.00s)
=== RUN   TestTracer_Start_Disabled
--- PASS: TestTracer_Start_Disabled (0.00s)
=== RUN   TestTracer_StartWithAttributes_Enabled
--- PASS: TestTracer_StartWithAttributes_Enabled (0.00s)
=== RUN   TestTracer_AddEvent_Enabled
--- PASS: TestTracer_AddEvent_Enabled (0.00s)
=== RUN   TestTracer_AddEvent_Disabled
--- PASS: TestTracer_AddEvent_Disabled (0.00s)
=== RUN   TestTracer_RecordError_Enabled
--- PASS: TestTracer_RecordError_Enabled (0.00s)
=== RUN   TestTracer_SetAttributes_Enabled
--- PASS: TestTracer_SetAttributes_Enabled (0.00s)
=== RUN   TestTracer_Extract_Enabled
--- PASS: TestTracer_Extract_Enabled (0.00s)
=== RUN   TestTracer_Inject_Enabled
    tracer_test.go:594: Note: Carrier is empty, but that's okay for none exporter
--- PASS: TestTracer_Inject_Enabled (0.00s)
=== RUN   TestTracer_Shutdown_WithProvider
--- PASS: TestTracer_Shutdown_WithProvider (0.00s)
=== RUN   TestTracer_IsEnabled_True
--- PASS: TestTracer_IsEnabled_True (0.00s)
=== RUN   TestHTTPMiddleware_Enabled
--- PASS: TestHTTPMiddleware_Enabled (0.00s)
=== RUN   TestHTTPMiddleware_EnabledWithError
--- PASS: TestHTTPMiddleware_EnabledWithError (0.00s)
=== RUN   TestInjectTraceContext_Enabled
--- PASS: TestInjectTraceContext_Enabled (0.00s)
=== RUN   TestExtractTraceContext_Enabled
--- PASS: TestExtractTraceContext_Enabled (0.00s)
PASS
coverage: 83.0% of statements
ok  	github.com/gstreamio/streambus/pkg/tracing	1.728s	coverage: 83.0% of statements
=== RUN   TestTransactionCoordinator_InitProducerID
{"timestamp":"2025-11-22T14:23:05.942091-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.942569-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":1,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.942598-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1002,"transaction_id":"txn-2"}}
{"timestamp":"2025-11-22T14:23:05.942622-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:05.942647-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_InitProducerID (0.00s)
=== RUN   TestTransactionCoordinator_InvalidTimeout
{"timestamp":"2025-11-22T14:23:05.942802-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:05.942829-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_InvalidTimeout (0.00s)
=== RUN   TestTransactionCoordinator_AddPartitionsToTxn
{"timestamp":"2025-11-22T14:23:05.942898-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.942951-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":3,"total_partitions":3,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.942987-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":2,"total_partitions":4,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943009-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:05.943028-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_AddPartitionsToTxn (0.00s)
=== RUN   TestTransactionCoordinator_CommitTransaction
{"timestamp":"2025-11-22T14:23:05.943081-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943114-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":1,"total_partitions":1,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943145-05:00","level":"INFO","message":"Transaction committed","fields":{"partitions":1,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943174-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:05.943193-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_CommitTransaction (0.00s)
=== RUN   TestTransactionCoordinator_AbortTransaction
{"timestamp":"2025-11-22T14:23:05.943244-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943275-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":1,"total_partitions":1,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943301-05:00","level":"INFO","message":"Transaction aborted","fields":{"partitions":1,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943329-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:05.943345-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_AbortTransaction (0.00s)
=== RUN   TestTransactionCoordinator_ProducerFencing
{"timestamp":"2025-11-22T14:23:05.943397-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943437-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":1,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943467-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:05.943483-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_ProducerFencing (0.00s)
=== RUN   TestTransactionCoordinator_ExpiredTransactions
{"timestamp":"2025-11-22T14:23:05.943542-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:05.943576-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":1,"total_partitions":1,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.143764-05:00","level":"WARN","message":"Transaction expired, aborting","fields":{"age":200186583,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444421-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:06.444475-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_ExpiredTransactions (0.50s)
=== RUN   TestTransactionCoordinator_AddOffsetsToTxn
{"timestamp":"2025-11-22T14:23:06.444613-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444671-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":1,"total_partitions":1,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444701-05:00","level":"DEBUG","message":"Added offsets to transaction","fields":{"group_id":"consumer-group-1","transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444724-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:06.444741-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_AddOffsetsToTxn (0.00s)
=== RUN   TestTransactionCoordinator_Stats
{"timestamp":"2025-11-22T14:23:06.444809-05:00","level":"DEBUG","message":"Initialized producer ID","fields":{"epoch":0,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444847-05:00","level":"DEBUG","message":"Added partitions to transaction","fields":{"partition_count":1,"total_partitions":1,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444883-05:00","level":"INFO","message":"Transaction committed","fields":{"partitions":1,"producer_id":1001,"transaction_id":"txn-1"}}
{"timestamp":"2025-11-22T14:23:06.444914-05:00","level":"INFO","message":"Stopping transaction coordinator"}
{"timestamp":"2025-11-22T14:23:06.444934-05:00","level":"INFO","message":"Transaction coordinator stopped"}
--- PASS: TestTransactionCoordinator_Stats (0.00s)
=== RUN   TestMemoryTransactionLog
--- PASS: TestMemoryTransactionLog (0.00s)
PASS
coverage: 76.5% of statements
ok  	github.com/gstreamio/streambus/pkg/transaction	1.989s	coverage: 76.5% of statements
	github.com/gstreamio/streambus/scripts		coverage: 0.0% of statements
=== RUN   TestBrokerOperations
    broker_operations_test.go:16: Skipping broker operations integration test in short mode
--- SKIP: TestBrokerOperations (0.00s)
=== RUN   TestEndToEndIntegration
    e2e_test.go:20: skipping end-to-end integration test in short mode
--- SKIP: TestEndToEndIntegration (0.00s)
PASS
coverage: [no statements]
ok  	github.com/gstreamio/streambus/test/integration	1.704s	coverage: [no statements]
=== RUN   TestChaos_RandomLatency
    chaos_test.go:33: Skipping chaos test in short mode
--- SKIP: TestChaos_RandomLatency (0.00s)
=== RUN   TestChaos_IntermittentErrors
    chaos_test.go:111: Skipping chaos test in short mode
--- SKIP: TestChaos_IntermittentErrors (0.00s)
=== RUN   TestChaos_SlowNetwork
    chaos_test.go:186: Skipping chaos test in short mode
--- SKIP: TestChaos_SlowNetwork (0.00s)
=== RUN   TestChaos_CombinedFaults
    chaos_test.go:260: Skipping chaos test in short mode
--- SKIP: TestChaos_CombinedFaults (0.00s)
=== RUN   TestChaos_NetworkPartition
    chaos_test.go:390: Skipping chaos test in short mode
--- SKIP: TestChaos_NetworkPartition (0.00s)
PASS
coverage: 0.0% of statements
ok  	github.com/gstreamio/streambus/tests/chaos	1.515s	coverage: 0.0% of statements
=== RUN   TestOffsetManagement
    offset_test.go:17: Skipping integration test in short mode
--- SKIP: TestOffsetManagement (0.00s)
=== RUN   TestOffsetOutOfRange
    offset_test.go:179: Skipping integration test in short mode
--- SKIP: TestOffsetOutOfRange (0.00s)
=== RUN   TestConcurrentOffsetAccess
    offset_test.go:232: Skipping integration test in short mode
--- SKIP: TestConcurrentOffsetAccess (0.00s)
=== RUN   TestE2E_ProducerConsumerLifecycle
    producer_consumer_test.go:14: Skipping integration test in short mode
--- SKIP: TestE2E_ProducerConsumerLifecycle (0.00s)
=== RUN   TestE2E_MultiPartition
    producer_consumer_test.go:91: Skipping integration test in short mode
--- SKIP: TestE2E_MultiPartition (0.00s)
=== RUN   TestE2E_LargeMessages
    producer_consumer_test.go:162: Skipping integration test in short mode
--- SKIP: TestE2E_LargeMessages (0.00s)
=== RUN   TestE2E_HighThroughput
    producer_consumer_test.go:238: Skipping integration test in short mode
--- SKIP: TestE2E_HighThroughput (0.00s)
=== RUN   TestE2E_OrderingGuarantee
    producer_consumer_test.go:328: Skipping integration test in short mode
--- SKIP: TestE2E_OrderingGuarantee (0.00s)
PASS
coverage: [no statements]
ok  	github.com/gstreamio/streambus/tests/integration	1.500s	coverage: [no statements]
	github.com/gstreamio/streambus/tests/load		coverage: 0.0% of statements
	github.com/gstreamio/streambus/tools/loadtest		coverage: 0.0% of statements
